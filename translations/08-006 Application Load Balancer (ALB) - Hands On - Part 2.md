---
source: 08 - High Availability and Scalability ELB & ASG\006 Application Load Balancer (ALB) - Hands On - Part 2_zh.srt
---

老师：那么让我们来看看负载均衡器的一些更高级的概念｡

第一是网络安全｡ 

所以目前我们通过这里的安全组访问这个负载均衡器｡

这是我的负载平衡器安全组｡ 

然后我们通过EC2实例自己的安全组访问它们｡

所以现在, 如果我查看公共IP并访问它,

正如你所看到的, 我可以直接访问我的EC2实例,

当然也可以通过我的负载均衡器访问它｡

但最好只通过我的负载均衡器访问我的EC2实例｡

那我们该怎么做呢

在实例下面, 我们来看看安全组, 就在这里｡

我们将查看launch-wizard-1安全组｡

在这里, 对于入站规则, 我们将编辑它们, 并查看HTTP规则｡

现在我们允许来自任何地方的所有内容都在此安全组上｡

但我们想说的是, 不, 唯一允许进入EC2实例的流量应该是来自负载均衡器的流量｡

那么, 我们如何改变这一点呢？

首先, 让我们删除这条规则｡ 

您必须先删除它, 然后添加新规则｡ 

所以, 我们需要HTTP｡ 

但是这次没有使用CIDR块, 您可以向下滚动,

您可以看到您可以在那里使用安全组｡

所以我们要允许进入的安全组是我的负载均衡器的安全组｡

所以如果你只输入load,

也会过滤列表｡

然后选择负载均衡器的安全组｡ 

这样做的效果是, 如果我们保存这个角色并查看它,

现在如果我们直接查看我们的EC2实例并刷新此页面, 正如您所看到的,

它超时了, 因为它就像无法访问该实例一样, 因为我不允许直接访问该实例｡

但是如果你刷新负载均衡器, 负载均衡器仍然可以访问我的实例,

因为在我们在安全组中创建的规则中, 我们允许来自应用均衡器的安全组的入站, 如果你看这里, 我们允许来自应用均衡器的安全组的入站｡

因此, 我们加强了网络安全｡ 

我想向您展示的第二件事是关于应用程序平衡器规则｡

所以现在如果你进入这个ALB,

我们在监听器下面, 我点击它｡

所以你可以看到我的听众就在这里｡ 

上面有一些细节, 然后我向下滚动, 我们有规则,

侦听器规则｡

在这里, 我们可以添加一些规则｡ 

所以我们现在有了默认的说法,

“嘿, 对于每个请求, 将其发送到我的ALB的演示目标组｡

但我们可以添加规则, 并使其像我们想要的那样复杂｡ 

所以这将是一个DemoRule,

这是我想给它的名字｡

接下来, 我们需要添加条件｡ 

所以条件是我们要根据这个角色的请求来过滤什么？

所以我们要看主机头,

或者, 例如, 看看, 例如, 如果我们在星上｡

例如 com或myapp｡  例如 com或任何你想要的｡

路径是为路径｡ 

所以我们使用/error,

然后说, “好吧, 如果在路径中我们有/error,

那么这个规则应该进来｡ 我们也可以让HTTP请求方法为get或post,

无论你想要什么｡

您可以根据源IP进行过滤和条件, 然后还可以使用查询字符串和HTTP头｡

所以, 有很多不同的可能性, 但现在我将使用path,

路径将是/error｡

好的, 确认｡ 

所以如果我们想的话, 我们可以添加多个条件｡ 

现在, 在规则限制中,

您可以看到您可以拥有的限制类型｡

让我们点击Next｡ 

我们只有一个条件, 够了｡ 

那么行动是什么呢？

所以一旦我们匹配了条件, 我们想怎么处理它？

我们是否要转发给特定的目标群体？

例如, 如果您有多个目标组, 那么我们可以基于路径或基于主机域定义一个或多个应用程序｡

或者我们可以重定向到特定的URL,

例如, 在协议HTTP或HTTPS上使用URI部分或完整URL,

然后使用特定的状态代码｡

然后再自定义主机､ 路径和查询｡

或者我们可以返回一个固定的响应, 这就是我现在要做的｡

所以我们可以说, “嘿, 404, 它没有找到｡ 

未找到, 自定义错误｡  这就是我们在/error中返回的内容｡

你马上就会明白这对你来说更有意义｡ 

那么这个规则的优先级是什么呢？

所以现在还悬而未决｡ 

所以我们有规则, 我们可以有一百条规则｡

所以我们可以定义优先级, 1将是最高优先级,

5将稍微低一点,

最高可达50, 000｡

所以, 当然基于喜欢, 例如,

如果一个条件被多个规则匹配,

则优先级最高的规则将获胜｡

所以我们将使用优先级5作为例子｡

现在我们可以看到我们的两个侦听器规则｡ 

让我们点击Next｡ 

此演示规则的一切看起来都很好,

并且已经创建｡

现在我们有两个规则,

默认规则和演示规则｡

它们就在这里, 如果你愿意,

你可以添加更多的规则｡

现在我们来测试一下｡ 

因此, 如果我进入我的负载均衡器详细信息,

查看DNS名称, 复制它并添加/error,

那么这将触发我的规则, 结果未找到, 自定义错误｡

这意味着是的, 这个请求确实匹配/error的路径模式,

因此返回404和纯文本｡

好吧就这样

希望你们喜欢, 下次课再见｡

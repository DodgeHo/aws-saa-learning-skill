---
source: 11 - Classic Solutions Architecture Discussions\003 MyClothes.com_zh.srt
---

# 架构演进：MyClothes.com

## 学习目标
- 识别有状态 Web 应用的挑战
- 了解会话保持的多种方案
- 掌握缓存与数据库扩展策略

## 重点速览
- 购物车状态导致粘性会话问题
- Cookie/会话存储可提升无状态能力
- RDS 读副本与缓存用于读扩展

## 详细内容
问题：购物车状态在多实例间丢失。

方案 1：ELB 粘性会话
- 请求固定到同一实例
- 实例故障仍会丢失会话

方案 2：客户端 Cookie
- 购物车内容放入 Cookie
- 无状态，但请求变大且有安全风险

方案 3：服务器会话存储
- Cookie 只保存 Session ID
- 会话数据放入 ElastiCache 或 DynamoDB
- 安全性更高，性能更好

数据库与读扩展：
- 用户资料写入 RDS
- 读副本扩展读取
- 缓存（延迟加载）减少 RDS 压力

高可用：
- Multi-AZ ELB + ASG
- Route 53 天生高可用

## 自测问题
- 为什么粘性会话不能彻底解决购物车问题？
- 延迟加载缓存的好处与代价是什么？

然后是RDS, 有一个Multi-az功能｡

另一个将是一个备用副本, 可以在发生灾难时接管｡ 

弹性缓存还具有多az功能｡ 

如果用户读到这个｡ 

真的很酷

现在我们基本上有一个全面的multi-az应用程序, 我们确信我们可以在AWS中的可用性区域中生存下来,

现在对于安全组, 我们希望超级安全, 所以也许我们会从任何地方打开Http https流量对于EC2实例端,

我们只想限制来自负载均衡器的流量, 也许来自弹性缓存｡

我们只想限制来自EC2安全组的流量, 同样, 我们想限制直接来自EC2安全组的流量｡

就这样

现在让我们来讨论一下Web应用程序的架构｡ 

因此, 我们已经讨论了ELB粘性会话, 用于存储cookie并使我们的Web应用程序无状态的Web层Web客户端,

或者使用会话ID和会话缓存来使用弹性缓存｡

作为替代, 我们可以使用DynamoDB｡ 

我们还可以使用弹性大小写来在读取时对RDS中的数据进行大小写, 并且我们可以使用Multi-az来在灾难中幸存下来｡

我们可以使用它来存储用户数据｡ 

因此, 更持久类型的数据读取副本可以用于扩展读取, 或者我们也可以使用弹性缓存｡

然后我们有多个AZ用于灾难恢复｡ 

最重要的是, 我们为相互引用的安全组添加了严格的安全性｡ 

这是一个更复杂的应用程序｡ 

有三层, 因为有Web层, 客户端层, Web层和数据库层｡

但总体来说这是一个非常常见的架构｡ 

是的, 它可能会开始增加成本, 但没关系｡ 

至少我们知道我们在做什么交易｡ 

如果我们想要多AZ, 是的, 我们肯定要付出更多｡ 

如果我们想扩大阅读量, 是的, 我们肯定也要付出更多｡ 

但它给了我们一些很好的权衡和架构决策, 我们必须做出｡ 

我希望你们会喜欢, 我们下次课再见.

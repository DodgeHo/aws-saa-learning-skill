**学习目标**
- 掌握在 ECS 控制台创建集群（包括 Fargate 与 EC2 混合）的关键步骤
- 理解自动伸缩组（ASG）、容量提供者与容器实例的关系

**重点速览**
- 创建集群时可选择 Fargate、EC2 或混合模式；EC2 模式需指定 AMI、实例类型与 ASG 配置
- 容量提供者将 ASG 与 ECS 集群连接，自动按需扩容实例
- 创建完成后，可在集群基础设施中看到容量提供者、ASG 与容器实例注册信息

**详细内容**
在控制台创建 DemoCluster：选择启动类型（Fargate 保持启用，同时为演示也启用 EC2），为 EC2 指定操作系统（如 Amazon Linux 2 / 2023）、实例类型（可选免费层的 t2.micro）、以及 ASG 的最小/期望/最大容量。网络选择默认 VPC、子网与安全组，是否分配公网 IP 也可配置。

集群创建后，ECS 会为 EC2 生成自动伸缩组（ASG），并通过 ECS 代理将启动的实例注册为容器实例。集群中会显示容量提供者（FARGATE、FARGATE_SPOT、ASGProvider），其中 ASGProvider 与自动伸缩组配对，可根据任务需求自动扩展 EC2 实例。

**自测问题**
- 创建 EC2 类型的 ECS 集群时需要配置哪些关键选项？
- 容量提供者在 ECS 集群中扮演什么角色？
- 如何在集群中查看已注册的容器实例？
---
source: 18 - Containers on AWS ECS, Fargate, ECR & EKS\004 Creating ECS Cluster - Hands On_zh.srt
---

指导老师：让我们通过进入ECS控制台服务来练习使用Amazon

ECS, 然后在左上角启用新的ECS体验｡

然后进入集群,

我们将创建第一个集群｡

所以这个将被称为DemoCluster,

我们将保留默认的名称空间｡

因此, 对于基础设施, 我们有三个选择｡ 

第一个是AWS Fargate, 它允许我们向AWS提供容器,

然后AWS将根据需要为我们运行这些容器｡

所以这很好, 因为这是一个无服务器的选项｡ 

我们不提供电脑｡ 

AWS将按需为我们提供计算, 但我们甚至看不到它｡

其他选项是Amazon EC2实例,

我们提供自己的Amazon EC2实例来提供计算以运行我们的容器｡

我们在任何地方都有使用ECS的外部实例,

例如, 使用您自己的数据中心在其上运行ECS容器｡

因此, Fargate将保持启用状态,

我们还将为演示启用Amazon EC2实例｡

所以我们要创建一个新的自动伸缩组,

然后我们必须选择操作系统｡

所以Amazon Linux 2很棒, 或者你可以选择最新的Amazon

Linux 2023, 无论你想要什么｡

对于EC2实例类型, 我将使用t2｡  micro, 符合免费层条件｡

对于所需的容量, 我将选择最小值0和最大值5｡

因此, 不会配置SSH密钥对,

我们将保留根EBS卷大小不变｡

好了, 现在我们已经指定了Amazon EC2实例类型的基础设施,

我们必须为Amazon EC2实例提供网络设置,

这是默认的VPC, 以及我可用的三个VPC｡

对于安全组, 我们将使用现有的安全组作为默认安全组｡

最后, 对于自动分配公共IP,

我们将再次使用默认的子网设置｡

我们不碰监控和标签｡ 

然后我们单击Create来创建我们的集群｡ 

因此, 在此过程中,

让我们来看看在AWS上创建的自动伸缩组｡

然后在左侧, 我将单击此处的自动伸缩组｡

它显示, 正如您所看到的,

有一个为我创建的自动伸缩组,

名为EAS-ECS-Cluster｡

期望容量是0, 最小容量是0,

最大容量是5｡

这是由我的ECS集群直接创建的｡ 

创作正在进行中｡ 

这个集群可能有EC2实例供我启动任务｡

如您所见, 它位于三个可用区域中｡ 

因此, 我们知道ECS任务将在三个AZ上启动｡

我现在要做的就是等待这个集群被创建,

现在就是这样｡

所以我现在能做的就是探索这个DemoCluster｡ 

所以如果我点击它, 我就在DemoCluster中,

我可以转到服务为零, 任务为零, 因为我们还没有启动任何东西｡

然后我们去更有趣的基础设施｡ 

因此, 如果您转到基础架构,

我们在此ECS群集中有三个容量提供商｡

第一个是FARGATE｡ 

这意味着我们可以在ECS集群上启动Fargate任务｡

第二个是FARGATE_SPOT这意味着我们可以在spot模式下启动Fargate任务,

为EC2选择spot实例｡

最后一个是ASGProvider｡ 

这意味着我们可以直接通过这个ASG在这个集群中启动EC2实例｡

所以它现在是受管理的扩展,

当前大小为零, 但如果我想,

我可以改变它｡

我来给你们展示一下它的样子｡ 

我在这里, 我去细节, 我会编辑所需的容量为1,

只是为了向你展示它是什么样的｡

接下来会创建一个EC2实例？

当它被创建时,

它会将自己注册到DemoCluster中,

然后我会在容器实例下看到它｡

这意味着当我们创建ECS任务时,

它可以在FARGATE或FARGATE_SPOT容量提供程序上启动,

也可以在我将作为此ASG的一部分启动的容器实例上启动｡

所以我现在要做的就是等待这个实例进入运行状态并注册到我的ECS集群中｡

现在让我来回顾一下｡ 

我的实例是InService, 它是t2｡  micro.

如果我回到我的Amazon

ECS集群, 它被注册为一个容器实例,

当然, 当前运行的任务为零, 并且有1, 024个可用CPU和982个可用内存｡

这就给了我这个实例的容量,

我可以在它上面启动任务,

直到容量耗尽｡

所以我们可以走了｡ 

所以我们有一个ECS集群｡ 

我们已经看到了两个容量提供商, 我的意思是三个｡ 

我们已经看到了容器实例｡ 

现在让我们运行我们的第一个服务,

我们下节课再见｡

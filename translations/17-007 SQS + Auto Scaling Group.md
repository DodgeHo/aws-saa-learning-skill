---
source: 17 - Decoupling applications SQS, SNS, Kinesis, Active MQ\007 SQS + Auto Scaling Group_zh.srt
---

教师：我已经告诉过您, 我们可以将SQS Q与自动缩放组一起使用｡

但我想向你们展示它是如何打开的,

以及它打开的模式｡

因此, 我们有一个SQS队列和一个自动缩放组｡ 

ASG中的EC-2实例将轮询SQS队列中的消息｡

现在的想法是根据队列大小自动缩放自动缩放组｡

因此, 我们可以看看CloudWatch的指标,

称为队列长度, 称为近似消息数, 它基本上代表了队列中剩余的消息数｡

您可以设置一个警报, 例如, 如果该指标超过1,

000, 则表示队列中有1,

000条消息等待处理,

这意味着我们的处理滞后｡

因此, 我们要创建一个警报, 说, 嘿,

超过1,000将是一个警报｡

此警报将触发自动缩放组中的缩放操作｡

因为, 我们没有足够的EC2实例｡ 

因此, 更多的EC2实例将被添加到您的自动扩展组中,

该组将进行扩展｡

因此, 消息将被更快地处理｡ 

SQS队列大小将减小｡ 

而你将为它扩展｡ 

这两种方式都有效｡ 

您可以按比例放大或缩小｡ 

这是使用自动缩放组和SQS队列的主要思想｡

现在, 它打开时有什么模式？

好吧, 比如说, 你正在进行一次非常大的销售,

这是你一生中做过的最大的营销活动｡

你所有的顾客都会下订单｡ 

并且这些订单可以存储在不同类型的数据库中｡

如果您希望拥有一些OLTP类型的数据库, 则可以将它们存储在Amazon

RDS或Amazon Aurora中;如果您不希望拥有SQL类型的数据库, 则可以将它们存储在Amazon DynamoDB中｡

因此, 这些事务可能会非常快地写入RDS,

也可能会非常突然地写入｡

因此, 如果您的应用程序处理它们, 它们就可以处理请求｡

但是对于不确定的事务, 如果数据库过载,

则可能会出现一些错误｡

而且你会失去一些客户交易,

这对你的业务不利｡

那我们该怎么解决这个问题呢？

我们可以通过使用SQS作为数据库写入的缓冲区来解决这个问题｡

而这是一种非常常见的考试模式｡ 

所以这里有相同的数据库｡ 

同样的前置应用程序也在这里｡ 

但是, 应用程序不是直接写入数据库,

而是将事务请求或事务写入SQS队列｡

从定义上讲, AWS提供了无限可扩展性,

不会遇到任何吞吐量问题｡

因此, 您的请求将进入应用程序, 应用程序将对消息进行排队｡

这意味着所有事务､ 所有请求都将作为消息发送到SQS队列中｡

所以这意味着我们不会失去任何一个｡

它们将永久存储在SQS队列中｡ 

现在, 我们可以创建另一个自动缩放组｡ 

此操作用于使消息出队｡ 

这个自动缩放组的唯一作用是接收消息,

然后将它们插入数据库｡

只有当一个消息被插入到数据库中时,

我们才会从原始SQS队列中删除该消息｡

因此, 我们使用SQS作为缓冲｡ 

我们保证每一笔交易都将写入您的数据库｡

现在, 只有当客户端不需要确认数据库中已经发生了写入时,

此模式才有效｡

但这很好, 因为如果写入已完成到SQS队列中,

我们可以保证它最终将被写入到数据库中｡

所以我们没事了｡ 

因此, 这不仅适用于数据库写入之间的解耦, 而且适用于应用程序层之间的解耦｡

因此, 设想一个应用程序正在获取一个请求,

执行一些处理, 然后发送回一个响应｡

相反, 我们可以将其解耦｡ 

因此, 我们可以让所有请求进入前端Web应用程序｡

将请求发送到SQS队列中｡ 

然后, 后端处理作业将只接收这些消息并在其自己的时间内处理它们｡

我们可以相应地扩展它｡ 

所以SQS将是一种非常, 非常普遍的考试答题方式｡

现在比平常更常见了｡ 

因此, 无论何时, 只要您看到解耦､ 负载突然激增､

超时或其他情况, 并且您需要确保能够非常快速地扩展,

您可能希望了解SQS队列｡

好了, 这节课就讲到这里｡ 

希望你喜欢｡ 

我们下节课再见｡

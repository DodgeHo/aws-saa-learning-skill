**学习目标**
- 掌握在控制台创建、测试与调试 Lambda 函数的基本操作
- 了解常用配置项（内存、超时、运行时、权限）及日志查看方法

**重点速览**
- 控制台可直接创建函数，选择运行时、函数名并自动生成执行角色
- 使用“测试事件”调试函数并在 CloudWatch 查看日志与执行详情
- 常见配置：内存（128MB–10,240MB）、超时（最大 15 分钟）、权限由执行角色控制

**详细内容**
Hands‑on 要点：在 Lambda 控制台新建函数时可选择蓝图或空白模板，设置运行时（如 Python、Node.js）、函数名与执行角色。创建后可在内置编辑器编写代码或上传包/镜像，使用“测试事件”运行并观察返回值与 CloudWatch 日志流。

调试与配置：部署代码修改需点击 Deploy；查看函数执行时间、初始化时间（cold start）与内存使用；函数权限通过 IAM 执行角色配置（例如写入 CloudWatch Logs、访问 S3/ECR 等）。若出错，查看 CloudWatch 日志可定位异常堆栈。

**自测问题**
- Lambda 控制台如何模拟并运行测试事件？
- 如果函数频繁出现超时，应检查和调整哪些设置？
- 在哪里查看 Lambda 的执行日志与异常信息？
---
source: 19 - Serverless Overviews from a Solution Architect Perspective\004 Lambda Hands-On_zh.srt
---

教师：好的,

我们将练习使用Lambda服务｡

当你进入Lambda, 你可能会在这个屏幕上结束, 但还有另一个屏幕我真的很喜欢｡

所以如果你在你的URL中,

你用/begin替换/discover, 你可能会在这个屏幕上结束,

我真的很喜欢它, 因为它有教育价值, 我想向你们展示｡

因此, Lambda可以帮助您在不考虑服务器的情况下运行代码,

这使其成为真正的无服务器服务｡

所以我们的想法是我们可以使用任何类型的编程语言｡

例如. Net Core, Go, Java,

Node JS, Python,

Ruby或任何自定义运行时, 如果你想拥有一个开源的运行时,

例如, Lambda Rust是可能的｡

因此, 从这段代码中, 您将编写它, 将其上传到Lambda控制台,

然后AWS Lambda将为您运行代码｡

让我们来看一个非常简单的代码｡ 

例如, Python, 我们有一个Lambda处理程序,

它将打印事件, 然后说, “从Lambda返回Hello｡

所以让我们点击Run,

然后从Lambda得到Hello｡

这意味着Lambda函数只运行我们在这里提供的代码｡

很简单, 对吧？

接下来, 如何调用Lambda函数？

所以我们可以点击Run按钮,

当然, 我们也可以让Lambda响应事件｡

这就是我想给你们看的,

我觉得它很酷

正如我们所看到的, 事件可以来自不同的来源｡ 

例如, 在这一个, 这是流分析｡ 

因此, 当流分析将事件发送到Lambda函数时, Lambda函数将返回Hello

from Lambda, Hello

from Lambda, Hello from Lambda, 等等｡

但这不仅仅是那些流媒体分析｡ 

如果你点击这里的手机, 它会向移动物联网后端发送一条消息｡

这个物联网后端也将调用我们的Lambda函数｡ 

同样, 如果我们拍摄一张照片,

并将其上传到S3 bucket进行数据处理, 那么Lambda函数将被调用｡

但是很酷的是,

如果你开始点击这些资源中的一个, 你可以看到在右手边,

我们有更多的齿轮｡

因此, 随着左手边的流程和Lambda调用的扩展,

Lambda调用的数量以及并发运行的Lambda函数也将扩展｡

所以这真的很酷, 因为这意味着当我们有更多的负载时,

Lambda会自动随我们的负载而扩展｡

这就是使用Lambda作为计算平台的全部力量,

这就是为什么Lambda是无服务器的, 而且它的扩展性非常好｡

因此, 如果我们进入这里, 正如我们所看到的,

随着Lambda函数的调用, 我们会随着时间的推移获得更多的调用,

并且成本保持为零, 因为有一个空闲层｡

一旦我们将通过100万次调用, 那么Lambda函数将开始产生一些费用｡

所以如果我们进入那里, 开始有超过100万次调用,

在这里, 现在, 我们得到一些美分｡

正如你所看到的, 我们有近200万次调用,

而我们只有14美分的成本｡

因此, 拥有Lambda功能并大规模运行一些工作负载是非常､

非常､ 非常经济高效的｡

正如你所看到的, 你可以随便玩玩,

看到你有越多的调用, 成本就越多,

但它真的, 真的被控制了｡

如果你大规模使用Lambda, 它可以是一个相当节省成本的机制｡

这只是对Lambda的介绍｡ 

所以如果我点击创建一个函数,

我可以在三个选项中选择,

我将选择使用这个函数的蓝图｡

它将是hello world函数｡ 

所以我只需要搜索hello world,

然后选择Python版本｡

Python 3. 10, 但这可能是一个不同的版本,

只要它是Python｡

接下来, 对于函数名, 我们将输入demo-lambda,

然后我们将创建一个具有基本Lambda权限的新角色｡

这将是我们Lambda函数的IAM角色｡ 

然后我们可以看看函数代码｡ 

这就是Lambda函数｡ 

所以我们有了一个Lambda处理器

这个函数实际上处理调用Lambda函数的事件｡

现在, 它只是打印一堆值并返回key1｡

因此, 我们将在测试函数时详细了解这一点｡

所以当你准备好了, 只需点击创建功能｡ 

好了, 我的函数已经创建好了, 正如我们所看到的,

代码的源代码在这里｡

如果我点击lambda函数｡  py并打开它, 我们可以看到我们之前的函数代码现在加载到这个代码编辑器中｡

所以我们为什么不继续测试这个功能｡ 

所以我要点击test, 我们需要创建一个新的测试事件,

这是一个hello world事件, 它包含key1,

value1, key2, value2, key3, value3作为相邻文档｡

所以我把它叫做DemoEvent,

然后点击Create｡

至此, 演示活动成功保存｡ 

所以如果我现在点击test,

它会运行DemoEvent,

响应是value1, 函数日志是value1等于value1, value2等于value2, value3等于value3,

这只是三个print语句的结果｡

最后, 由于这行代码, 响应值再次为value1｡

所以它可能看起来不像匹配,

但从程序员的角度来看, 正如你所看到的, 你只有一些代码,

它被上传到Lambda, 然后它很快就被Lambda运行了｡

如果你是一个开发人员, 这是一个巨大的改进,

正如你所看到的, 部署代码并让它运行｡

最重要的是, 它无缝运行,

它会自动扩展, 完全无服务器｡

好了吗？

我们没有部署任何服务器｡ 

现在, 在构建持续时间方面,

所以如果你在这里向下滚动, 对不起｡

如你所见, 时间是2｡  32毫秒

我们已经为三毫秒的执行计费, 这里是我们提供的内存大小,

使用的内存大小以及init的大小,

因为这是我们第一次使用Lambda函数｡

现在, 如果我再次运行它, 哦,

如果我回到我的函数, 对不起, 再次运行这个函数,

正如我们现在看到的, 函数duration是1｡

33毫秒

在右手边, 没有启动, 因为我的Lambda函数已经准备好了｡

好了吗？

所以这是一种做事的方式｡ 

现在, 我要向你们展示的另一件事是,

从这个Lambda函数中, 我们能够配置它｡

所以如果我进入常规配置,

我们会得到一些最重要的设置｡

第一个是关于记忆｡ 

所以我们可以有任何内存从128兆字节到10,240兆字节的内存｡

很明显, 如果你有更多的内存,

你会得到更多的账单｡

在暂停方面,

我们可以从3秒到5秒, 一直到15分钟｡

所以最大超时时间是15分钟,

但是你要确保你只在你认为它会被使用的时间内使用这个函数｡

然后执行角色是Lambda在开始时创建的角色｡

好的, 这些是一些最重要的设置｡ 

好了吗？

另一个我们可以关注的是监控｡ 

因此, 在监控中, 我们可以看到Lambda函数发生了什么,

以及它被调用了多少次｡

所以在这里, 一次, 它持续了多久,

是否有错误或成功等等｡

所以可能会很有帮助｡ 

但我们与CloudWatch､ 指标和CloudWatch插件进行了集成｡

所以现在, 我们什么都没有,

但我们可以在函数运行时立即查看CloudWatch｡

为此, 只需刷新右侧最近的调用,

我们可以看到这里有一个日志流｡

因此, 如果我点击它,

我会直接进入CloudWatch服务器, 我们可以看到在CloudWatch服务器上,

我们有这个Lambda函数调用的所有日志｡

这是在一个名为AWS Lambda的日志组中,

Demo Lambda, 显然, Demo Lambda是我所在区域的Lambda函数的名称｡

我们这里有一条原木流｡ 

所以我们把所有的日志都放进Lambdas｡ 

你可以尝试的其他事情是修改代码｡ 

例如, 如果我们拿这段代码,

我们去Lambda函数,

我将通过一个hashtag注释这行代码,

并取消注释这一行, 这将引发一个异常｡

为此, 我需要首先通过单击Deploy来部署更改｡

现在, 更改已经部署,

现在, 我可以测试我的功能了｡

在这个类型中, 我们得到一个执行结果, 这是一个错误,

其中出现了错误, 类型是异常,

正如我们所看到的, 出现了错误,

这是由这段代码或这行代码触发的｡

因此, Lambda也会报告任何类型的错误,

您可以查看CloudWatch日志以了解错误发生的位置｡

所以如果我回到CloudWatch,

这里有第二个日志流, 我要打开它,

我们在这里得到这个异常｡

因此, 我们也可以返回CloudWatch服务器中的异常日志,

以了解问题的根本原因｡

所以相当容易｡ 

现在, 如果你想让函数再次正常运行,

你只需要反转你所做的, 然后点击测试｡

再一次, 现在, 这一次,

这个Lambda执行函数将工作｡

所以我们最后可能要检查的事情是, 在这里,

运行时设置, 我们正在运行Python

3｡ 7在这个例子中, 但你可能会得到一个更新的版本,

也许在你的结束｡

处理程序是lambda函数｡  lambda处理器, 它说要查看lambda函数｡

py文件和名为lambda

handler的函数｡

所以如果你向上看, 你可以看到函数名是lambda_function｡

py,

在它里面, 我们有lambda_handler函数｡

这就是为什么它知道要特别调用这个函数｡ 

此外, 我们还写信给CloudWatch｡ 

我们能够这样做的原因是,

如果我们进入Lambda的配置, 并转到权限选项卡,

我们有一个名为demo lambda

role的角色名称, 它是由Lambda控制台为我们创建的｡

如果您查看策略本身, 我们可以在策略摘要中看到我们有权写入CloudWatch日志,

您也可以在这里通过资源摘要看到, CloudWatch日志有三个操作和两个资源, 它们允许我们创建日志流和日志组,

并将日志发送到CloudWatch日志｡

这就是这个权限选项卡背后的整个想法｡

这节课就到这里｡ 

希望你喜欢｡ 

如果您正在参加AWS上的认证开发人员课程, 请准备好在Lambda上额外学习几个小时的内容｡

如果你不是, 好吧, 这对你的考试来说足够了｡ 

我希望你们喜欢, 我们下次课再见｡

---
source: 14 - Amazon S3 Security\006 S3 CORS Hands On_zh.srt
---

教师：让我们练习使用CORS｡ 

为此, 我们首先必须更改索引｡  html档案｡ 

所以如果你打开它,

你会发现这部分已经被注释掉了, 这部分是演示CORS的｡

好的, 要想让它正常工作, 首先你要到第13行,

把div前面的第一个字符去掉.

在脚本之后,

您还要删除破折号､ 破折号和箭头｡

这将启用CORS｡ 

接下来我的第一个网页会写上“Hello

world, 我爱咖啡, ”并显示咖啡的图片｡

但是在这之后, 我们将有一个脚本, 它将获取一个额外的页面,

一个额外的HTML页面, 好吗？

然后显示在下面｡ 

这个额外的HTML页面表示这个额外的页面已经成功加载｡

现在, 我们进入存储桶, 并上传两个文件｡

所以我们有额外的一页｡  HTML和索引｡  html中找到｡ 

我们现在要做的就是上传这两个文件,

因为这是成功的｡

如果我进入“属性”并在此处查找我的端点,

我可以单击此选项卡以在新选项卡中打开｡

我爱咖啡, 你好, 世界！ 咖啡的形象｡ 

然后这个额外的页面已经被成功加载｡ 

因此, 这意味着获取请求在同一个源中工作,

因为, 嗯, 我的额外页面和我的索引都是如此｡

HTML文件位于同一存储桶上｡ 

现在我们来演示CORS｡ 

而要做到这一点,

我必须首先创建另一个额外的额外桶,

并启用它作为一个网站｡

所以我们创建一个桶, 并将其命名为demo-other-origin-stephane｡

例如, 我将选择它位于另一个区域, 以演示存在非常不同的服务器｡

比如说, 我会把这个放在加拿大｡ 

好的, 我向下滚动｡ 

我会解除所有公众访问的封锁,

因为我们会公开这一点｡

然后向下滚动, 创建这个桶｡ 

现在我进入桶本身｡ 

然后在“Properties”（属性）下, 我将向下滚动,

确保我们已将其作为网站启用｡

所以, 是的, 这是一个网站,

我想主办一个静态网站｡

然后我们会说索引｡  html, 即使我们没有一个,

这将是足够的索引文档｡

好吧, 这是好事｡ 

接下来, 我们需要将此桶公开｡ 

现在, 让我们进入“权限”｡ 

然后对于桶策略, 让我们编辑它, 好的｡ 

为了简单起见,

我将复制我之前的一个｡

所以这个将被复制粘贴到这里, 我将把bucket

ARN换掉, 就在资源下面｡

所以这实际上也将使这些桶公开｡

因此, 让我们保存这些更改｡ 

我们得到了一个意想不到的反应,

因为我们刚刚删除了第一个字符｡

储存变更｡  好极了｡ 

回到这里, 我们现在要上传, 在我的其他来源中,

我们要上传一个文件｡

所以我们要上传这个额外的页面｡  html中找到｡ 

上传就没事了｡ 

因此, 这个文件现在应该是一个公共文件上我的水桶启用作为一个网站｡

如果我单击这个对象URL, 我们可以看到额外的页面已经加载,

并且文件是公开的｡

现在, 我们有了原始存储桶,

可以删除此额外页面｡

html,

因为我们现在不需要它, 因为我们已经将它放在另一个桶中｡

然后我们要改变索引｡  html文件指向我的其他来源中的额外页面｡

首先, 让我们转到此页面,

我将刷新此页面｡

我得到一个“404未找到”, 因为, 嗯,

我们找不到额外的页面｡ html中找到｡ 

所以这是完美的｡ 

现在, 我们表明, 我们有一些东西要修复｡ 

所以让我们结束吧｡ 

让我们来看看这个演示-来源-斯蒂芬, 其他-来源｡ 

让我们转到属性, 找到公共URL, 这一个｡ 

让我们以STS网站/extra-page的形式打开它｡

html中找到｡ 

太完美了, 我们有这个额外的页面, 这个拼图网站｡ 

我们将使用整个URL并更改索引｡  html中找到｡ 

这一次, 我们要获取的不是这个, 而是我的额外页面的完整路径｡

html在另一个桶上｡ 

这将触发跨源资源共享请求｡

所以现在我需要重新上传这个索引｡  html文件的位置｡

让我们将其上传到主存储桶,

第一个｡

好极了｡  让我们覆盖它｡ 

好了, 现在我的文件上传了｡ 

现在让我们进入我的第一个网页｡ 

而且它使用的是新索引｡  html中找到｡ 

首先, 我将打开“更多工具”下的“Web开发人员工具”｡

这也被称为Chrome开发者工具｡ 

我将刷新此页面,

看看是否有错误｡

让我们刷新此页面｡ 

现在您可以看到, 这里没有任何错误消息,

但是在我控制台日志调试器中, 我们有一些写得非常非常小的内容,

可能会被注意到｡

但它说跨源请求被阻止, 因为策略不允许这样做｡

缺少名为“Access-Control-Allow”的CORS标头｡

因此, 目前, 由于我的请求将进入另一个存储桶,

但另一个存储桶尚未为CORS设置, 因此此请求失败｡

Web浏览器显示跨源请求已被阻止｡

因此, 让我们通过添加CORS设置来解决此问题｡ 

我们转到“其他来源”下, 然后转到“权限”下,

向下滚动, 这里是我们在JSON中定义的CORS设置｡

我们来编辑一下｡ 

我们需要添加正确的CORS设置｡ 

所以谢天谢地我有他们在这里｡ 

所以你只要复制这段代码粘贴到这里｡ 

在这里, 我们需要定义的AllowedOrigins将是第一个bucket的URL,

http结尾没有斜杠｡

太懒了｡ 

让我们转到我的第一个网页｡ 

我们把它全部复制下来,

粘贴到这里, 如果像现在这样结尾有一个斜线,

就把它去掉｡

然后保存这些CORS设置｡ 

所以现在我们对另一个源说, 是的,

从第一个源发出请求是可以的｡

那我们怎么知道它会起作用呢

好吧, 现在让我们刷新此页面｡ 

正如我们现在所看到的,

这个额外的宠物已经成功加载, 这是正确的｡

我们还可以通过进入“网络”选项卡来了解这一点｡

如果您查看在额外页面上发出的请求,

我们查看响应标头, 我们可以在这里看到,

同样, 它非常小, 但我们可以看到有访问控制允许方法GET､

访问控制允许来源, 这是我的第一个桶的来源｡

因此, 这些是允许进行此跨源请求的头｡

当然, 我知道我们现在看到的可能有点高级,

但这个CORS设置只是在考试中出现的一个高级设置｡

你知道这是什么吗？

但我想向你们展示它是如何工作的,

这样你们就可以很容易地回答这个问题｡

好了, 这节课就讲到这里｡ 

我希望你们喜欢, 下节课再见｡

---
source: 30 - Other Services\003 CloudFormation - Hands On_zh.srt
---

教练：好的, 我将给你一个简短的介绍CloudFormation,

因为它是如此重要, 看看这个服务是如何工作的｡

所以在CloudFormation中, 我们要创建一个堆栈,

然后你必须提供一个堆栈模板｡

所以我想确保在你创建一个堆栈之前,

我必须使用的堆栈模板必须在US-east-1中使用｡

因此, 请点击该地区, 并前往美国东部,

北弗吉尼亚州, 美国东部-1｡

否则, 事情将不会为你工作, 你会得到一个错误｡

所以请大家进入美国东部, 北弗吉尼亚州,

美国东部1区｡

好了吗？

所以接下来我们必须通过一个模板创建一个堆栈｡ 

因此, 我们可以使用一些示例模板,

甚至在设计器中创建一个｡

但我有一个模板已经准备好了｡ 

因此, 我们将使用现成的模板,

然后我们可以说模板在Amazon S3中, 或者我们可以上传它,

我们将上传它｡

所以我将点击上传文件,

在代码中我将选择CloudFormation,

在它里面我将选择零-只是EC2｡

这个CloudFormation模板将为我们创建一个EC2实例｡

如果你想看看这个模板里面有什么, 你没有必要知道它是如何工作的｡

但你可以看到, 它很容易阅读｡ 

我们将创造资源｡ 

一个将被称为我的实例｡ 

它的类型是EC2实例｡ 

然后定义该EC2实例的一些属性,

例如, 可用区US-east-1A､

映像ID､ AMI ID和实例类型T2 Micro,

仅此而已｡

这将为我们创建一个EC2实例｡ 

所以我们正在上传这个文件, 这很好｡ 

然后, 我们在设计器中单击View｡ 

如果你想在设计器中以图形的方式看到这个模板的样子｡

因为我们可以很快看到, 只要我缩小, 这是一个非常简单的实例,

只是一个EC2实例,

它现在是孤独的｡

好的, 我将点击Next, 然后我将把它命名为DemoCloudFormation｡

好的太好了

接下来, 您可以设置一些参数,

但目前我们的模板中没有｡

所以这里没有输入｡ 

我会点击下一步, 我们可以标记它｡ 

我会叫它名字, DemoCF｡ 

我将向下滚动｡ 

我们不需要担心这些选择｡ 

我们将点击Next｡ 

好吧, 我们回顾一下｡ 

我将向下滚动, 然后单击创建堆栈｡ 

正如你所看到的,

我上传了一个模板｡

模板在这里, 这只是几行代码｡ 

这个模板实际上是用来创建一个EC2实例的｡

这就是为什么CloudFormation被称为基础设施即代码｡

因此, 如果我们转到事件, 我们可以看到所有的事件,

正在发生的, 为我们的堆栈创建｡

正如我们所看到的, 我的实例现在处于Create in Progress中｡ 

这意味着现在正在创建EC2实例｡

我们可以通过进入EC2控制台来验证这一点｡ 

让我们进入EC2控制台,

正如我们在EC2控制台中看到的, 我也在美国东部,

北弗吉尼亚地区｡

好了吗？

然后你点击实例, 你会看到,

是的, 这个EC2实例是为我创建的,

名称是DemoCF, 类型是t2 Micro｡

AMI ID是我们指定的,

可用区是US-east-1a｡

所以我们在模板中指定的内容就是在AWS中创建的内容｡

所以当我们完成的时候, 我们进入了创建完成状态｡ 

现在, 如果你看看堆栈信息, 它是创建完成,

然后它完全完成｡

所以现在我们可以使用这个EC2实例, 并对它做任何我们想做的事情｡

这就是基础设施作为代码的力量｡ 

这些是我们的转换模板, 但是在创建一个模板的基础上,

您可以更新它｡

因此, 如果我去更新,

我能够取代当前的模板, 并上传一个新的｡

在这种情况下, 我将选择一个1-EC2-with-sg-eip｡

yamo｡ 

这个模板更完整一点, 因为如果我们看一下它,

我们有更多的东西, 我们有一些参数, 我们有一些包含我的EC2实例的资源, 但现在有安全组连接到我的EC2实例｡

我定义了一个弹性IP, 我定义了两个安全组和安全组规则｡

这些安全组将附加到我的EC2实例｡

所以这个模板更复杂, 但是现在我们有四种资源,

但是CloudFormation足够聪明,

可以弄清楚如何使用这个模板以及如何以正确的顺序创建东西｡

我们来看看｡ 

我将单击“下一步”,

这样就可以指定安全组描述｡

因此, 通过CloudFormation演示安全组描述｡ 

如您所见, 我们可以在参数中输入您想要的任何内容｡

我会点击下一步, 也许它会太长｡ 

为了安全起见, 我还是去做演示安全组吧｡ 

我将点击Next｡ 

我可以改变标签, 但我会保持原样｡ 

我将向下滚动, 单击“下一步”,

然后再次向下滚动｡

我们可以看到在最下面有一个叫做变化集的东西｡

现在, 如果我们应用这个堆栈, CloudFormation将执行更改集｡

如我们所见, 它将添加一个弹性IP,

它将添加两个安全组, 好吗？

对于实例, 它会修改它, 为了修改它,

它会执行替换true｡

因此, 这意味着前一个实例将被终止,

并将使用正确的配置创建一个新实例｡

所以在这个例子中, CloudFormation必须销毁并终止前一个实例｡

一些很好的消息｡ 

我们对这些变化感到满意｡ 

让我们继续更新堆栈｡ 

现在我们正在进行更新｡ 

因此, CloudFormation将再次在后台对AWS云进行所有必要的更改,

以达到我们通过模板指定的最终状态｡

因此, 在此期间, 我们可以在Designer中查看此模板,

以查看它是否更完整｡

因此, 在本例中,

我们将实例连接到一个弹性IP, 并连接到两个安全组｡

这又是一个很好的可视化方式｡ 

所以回到我们的CloudFormation模板,

让我们看看另一个选项卡｡

参数就是我们所拥有的参数值｡ 

资源是由我们的CloudFormation模板创建的｡

所以我们可以看到, 到目前为止,

已经创建了两个安全组｡

我的实例正在更新中, 好吗？

我需要再等一会儿｡ 

我们正在等待事件, 我的弹性IP也被创建｡

就在此时此刻｡ 

所以创建正在进行中,

它会非常, 非常快｡

但是, 当我完成刷新后, 我们可以在资源中看到,

现在已经创建了四个资源｡

所以我的模板几乎完成了｡ 

回到我的EC2控制台, 如果我刷新它, 我可以看到现在我有两个EC2实例｡

一个是以前创造的,

一个是现在创造的｡

而且因为我们只需要一个EC2实例,

那么另一个实例很快就会被CloudFormation终止｡

如果我刷新一下, 我们马上就会看到这个｡ 

因此, 弹性IP现在正在全面完成｡ 

如果我现在转到Events, 会有一个正在进行的清理,

清理实际上会终止我创建的另一个EC2实例｡

回到EC2实例, 我将刷新这个｡ 

现在另一个实例也要关闭了

正如你所看到的, 我除了写代码什么都没做,

CloudFormation精确地指出了该做什么,

以正确的顺序创建什么, 何时删除EC2实例等等｡

这就是云形成的真正大魔力｡ 

正如我们所看到的, 实例已经创建｡ 

如果我去标签, 他们的标签与我给它的名字, 但他们也得到一些CloudFormation标签自动｡

如果我在这里访问我的安全组, 我会看到CloudFormation创建的安全组｡

这里有两个

如果我去弹性IP, 我们还没有真正看到弹性IP,

但它是一个静态的公共IP｡

我们可以看到一个已经在这里创建｡ 

所以CloudFormation真的让我们可以自动为我创建所有这些东西｡

现在我的CloudFormation模板的更新已经完成｡

那清理工作呢

好吧, 正如你所料,

云形成可以清理后本身｡

所以我们不需要在EC2控制台中手动删除内容｡

不, 不

相反, 我们可以做的是获取堆栈, 然后单击Delete,

这将删除与堆栈相关的所有资源｡

所以我点击删除, 现在删除开始了｡ 

同样, CloudFormation将确定删除这些堆栈元素和资源的顺序｡

这很好, 因为我们可以自己清理,

我们就完成了这个动手｡

总而言之, CloudFormation是一种将模板､

资源和基础设施定义为代码的非常简单的方法, CloudFormation允许您采用相同的模板, 如果编写得很好, 您可以将其部署到许多AWS区域或许多AWS帐户, 这使得它成为AWS上许多其他类型基础设施的基础｡

我希望你们喜欢这个讲座｡ 

我希望这是有意义的,

我们下节课再见.

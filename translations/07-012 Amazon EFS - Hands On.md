---
source: 07 - EC2 Instance Storage\012 Amazon EFS - Hands On_zh.srt
---

老师：那么我们来练习一下EFS｡ 

为此, 我将直接进入EFS控制台, 我们将创建第一个文件系统,

它将是一个网络文件系统｡

我被提示对话真的很快｡ 

但是, 由于我们想了解创建EFS文件系统时的不同选项,

我将继续单击底部的customize｡

下面是文件系统设置｡ 

首先, 一个可选的名字,

# EFS 实操

## 学习目标
- 创建 EFS 文件系统
- 在 EC2 上挂载 EFS
- 验证多实例共享

## 重点速览
- EFS 创建后生成文件系统 ID
- EC2 需安装 `amazon-efs-utils`
- 多实例挂载可共享文件

## 详细内容
创建 EFS：
1. 控制台进入 **EFS**，点击 **Create file system**。
2. 选择 VPC，保持默认设置并创建。

挂载到实例：
1. 安装工具：`sudo yum install -y amazon-efs-utils`
2. 创建挂载点：`sudo mkdir -p /mnt/efs`
3. 挂载：`sudo mount -t efs fs-xxxx:/ /mnt/efs`

验证共享：
- 在 `/mnt/efs` 创建文件
- 第二台实例挂载同一 EFS 后应能看到

## 自测问题
- EFS 与 EBS 的最大差异是什么？
- 挂载 EFS 之前必须安装什么工具？

您可以启用或禁用它, 但现在让我们保持启用状态｡

然后是生命周期管理｡ 

所以这是非常重要的｡ 

这是为了节省成本, 它说,

“好吧, 如果我的对象不经常使用,

那么将它们转换到一个不同的访问层,

称为标准非频繁访问存储类｡ 所以我们说, “好吧, 如果一个文件30天没有被访问,

那么就把它转换到IA, ”这将为我们节省一些成本｡

然后, 您可以根据需要在第一次访问时将其从IA中移出,

也可以永远不将其从IA中移出｡

因此, 对于性能设置, 我们有吞吐量模式｡ 

你有三个选择｡ 

所以增强只是一个类别,

重新组合弹性和配置,

但你有弹性吞吐量模式, 你有配置吞吐量模式, 以及突发吞吐量模式｡

让我们从爆裂开始｡ 

突发是一种根据实际使用的存储量来调整吞吐量的方法,

这就是为什么它被称为突发｡

因此, 如果您有1GB, 您将获得基于1GB的吞吐量｡

当您拥有1 TB时, 您可以获得更高的吞吐量,

因为您使用了更多的存储｡

然后是增强模式｡ 

现在推荐使用Elastic,

它说, “嘿, 不管你的EFS文件系统的大小如何,

我们都会为你提供你需要的所有I/O, 并自动扩展, 你只需要为你使用的东西付费｡

因此,

当您的工作负载具有不可预测的I/O时, 这是最好的选择,

例如, 您可以立即从每秒0 MB扩展到每秒100

MB｡

这就是为什么它是推荐的模式, 因为它不需要你考虑任何设置｡

然后是最后一个, 所以我们有突发,

弹性, 最后一个是预配置｡

这是您提前知道需要的吞吐量的时候｡

这就是Provisioned模式｡ 

所以你说, “嘿, 我肯定需要每秒100兆字节｡

然后,

您还具有每秒300兆字节的突发限制｡

因为你是通过put in advance进行配置的,

所以你要提前支付｡

所以Elastic是推荐的设置｡ 

然后, 如果您查看其他设置,

我们有通用和最大I/O｡

因此, 在Elastic的情况下, 您可以根据所需的性能获得所需的I/O｡

因此, “通用”是“性能”模式的唯一选项｡ 

但如果您使用Bursting或Provisioned,

则可以在两种设置之间进行选择｡

因此, 通用用途, 它为您提供高性能和延迟敏感的应用程序｡

这意味着延迟非常低｡ 

但如果您想获得最大数量的I/O模式, 那么这是针对高度并行化的工作负载,

您可以容忍更高的延迟｡

因此, 以更高的延迟为代价, 您还可以获得更多的I/O｡

这在大数据类型的设置中很好, 但对于AWS来说,

最好的建议设置是使用增强的通用和弹性,

好吗？

以上就是我们的选择｡ 

希望不会太混乱｡ 

我不喜欢在Enhanced下有Elastic和Provisioned｡

我们只有三个选择｡ 

我们有Bursting､ Elastic和Provisioned,

这是您在考试中应该记住的内容｡

好的, 现在让我们点击Next｡ 

接下来, 我们有网络访问设置,

它们非常重要｡

我们必须选择VPC｡ 

我将选择默认VPC｡ 

然后是安装目标｡ 

由于我们选择了区域性类型的EFS文件系统,

因此有三个可用的AZ｡

因此, 每个AZ将被分配到一个子网｡ 

我将保持原样, 这是默认子网, IP是自动的,

我们需要分配一个安全组｡

因此, 我们需要继续为我的EFS文件系统创建一个特定的安全组｡

因此, 我将进入EC2控制台, 然后进入安全组｡

我将创建一个安全组, 并将其命名为ssg-efs-demo｡

我把这个叫做EFS Demo SG｡ 

目前, 我们将没有任何入站规则｡ 

我将单击创建安全组｡ 

我们不能这样｡ 

所以efs-demo已经足够好了｡ 

好了, 我的efs-demo创建成功了｡ 

为了让它出现在这里,

我需要做的就是刷新页面｡

我们从头开始, 但设置是基本的,

默认的, 我们来下一个｡

现在, 我可以删除这些安全组并选择以前创建的efs-demo安全组｡

好了我们没事了

现在我们已经完成了所有的网络访问配置,

我将单击“下一步”｡

我们有一个可选的文件系统策略,

我们现在不会触及它｡

这是相当先进的, 我们现在不需要它｡ 

所以我会点击Next｡ 

在这里, 我们可以查看和创建所有文件系统设置｡

所以我们对此很满意｡ 

当我们完成后, 我们只需点击创建｡ 

现在, 我的文件系统正在创建中, 创建完成后,

我会回复您｡

我的文件系统现在是可用的, 我可以进入它,

看看现在正在使用的大小为6KB的事实｡

当您使用EFS文件系统时, 您只需为所使用的存储付费｡

所以现在我的成本是零｡ 

这很好, 创建好了, 现在我们要将其融合到EC2实例上｡

因此, 您知道下一步, 我们将创建EC2实例｡

所以让我们启动一些实例, 我将命名这个实例为A,

因为我们将在AZ

A的子网中启动它｡

所以我们将运行Amazon Linux版本2｡ 

可以走了

我们用T2 微, 因为它符合免费层资格｡ 

我们将禁用密钥对｡ 

我们将执行EC2实例连接来连接到我们的EC2实例｡

对于网络设置, 我将保持原样,

并将在此处使用这些规则创建一个新的安全组｡

因此, 允许SSH从任何地方访问, 这很好｡ 

然后我们有8G的GP2存储空间｡ 

但是现在, 因为我们想将这个EC2实例的存储配置到Amazon

EFS中, 所以我们现在实际上可以从EC2控制台中完成, 这非常令人兴奋｡

在我们运行一些命令之前,

让我向您展示如何实现它｡

所以有0x文件系统, 你做编辑｡ 

它还指出, 在选择子网之前不能添加文件系统｡

所以我们向上滚动, 进入网络设置, 编辑它｡ 

在子网中, 我将选择eu-west-1a｡ 

现在创建了子网,

我可以返回到文件系统｡

如您所见, 我可以添加EFS或FSX文件系统｡ 

因此, 我们将添加一个EFS文件系统｡ 

然后我们将单击Add shared

file system, 它将在此处链接到我的EFS｡

挂载点是/mnt/efs/fs 1｡ 

这对我们来说已经足够了｡ 

这将自动为我们创建和附加安全组,

这是惊人的｡

然后, 它会自动通过附加所需的用户数据脚本来挂载共享文件系统｡

因此, 在过去, 我们必须手动在EC2实例上运行自己,

或者创建自己的用户数据脚本｡

但现在, EC2控制台为我们完成了这一点,

这真的很好｡

好的, 让我们创建一个实例并启动它｡ 

好了, 这个实例启动了｡ 

我可以查看所有实例,

然后启动一个新实例｡

好的, 我把这个叫做实例B｡ 

Amazon Linux 2

再次, 为了使它更快,

我将继续没有密钥对｡

我将进入EU-West-1B｡ 

我可以选择之前创建的launch-wizard-2的安全组｡

然后, 我们需要再次编辑它并添加一个EFS类型的文件系统｡

我们将使用与之前相同的文件系统和相同的挂载点,

并且我们也将保留这些选项｡

所以我们没事了

让我们启动这个实例｡ 

现在让我们来看看已经发生的有趣的事情｡

所以我将执行instance state = running,

并刷新它, 直到看到两个实例｡

所以现在他们都跑了｡ 

有趣的是, 如果我们进入EFS控制台并转到Network选项卡, 正如我们现在所看到的,

每个可用区现在都有多个安全组｡

我们有之前创建的efs-demo, 还有efs-sg-1和efs-sg-1,

它们是由EC2控制台自动创建的, 并附加到我们的EFS文件系统中｡

因此, 如果我进入我的EC2实例, 然后进入这里的安全组,

我可以查看, 例如, 这个efs-sg-2, 查看入站规则｡

正如您将看到的, 它允许在端口2049上使用NFS协议,

如果我们查看入站规则本身, 它的源就是这个安全组, 而这个安全组就是连接到我的EC2实例（实例B）的安全组｡

因此, 这允许我的实例B访问EFS文件系统,

因为此处称为efs-sg-2的安全组已附加到我的EFS文件系统中｡

所以所有的设置都是由AWS为我们完成的, 这真的很好｡ 

所以现在, 如果我进入其中一个实例, 我们将使用此选项卡上的EC2实例连接进行连接,

然后我还将通过EC2实例连接连接到实例B来执行完全相同的操作｡

例如, 现在我可以验证在ls /mnt/efs/fs 1中确实存在一个EFS文件系统｡

现在我们需要在其中创建文件｡ 

所以, 为了使它简单, 我将提高我的权利和类型sudo

su｡

然后我可以把“hello world”作为hello回显到/mnt/efs/fs

1/中｡ txt文件｡ 

所以我们创建了名为hello的文件｡  txt文件｡ 

如果我做cat, 然后这个文件名就在这里, 正如你所看到的,

它说hello wold｡

因此, 这个文件已经从这个EC2实例创建到我的EFS文件系统中,

它是一个eu-west-1a｡

但是现在, 如果我进入第二个EC2实例并执行ls,

然后是相同的文件系统, 所以我在其中查找文件｡

正如你所看到的, 我们也看到了这个你好｡  txt文件中｡ 

如果我做了cat然后cat文件你好｡  txt, 它也说Hello

World｡

因此, 正如您所看到的, EFS星形系统确实作为网络驱动器安装到我的两个EC2实例上,

它们位于不同的AZ中, 并且共享相同的EFS｡

这真是太棒了, 这是一种不同类型的存储,

你现在已经有了它的演示｡

这就是EFS演示的全部内容｡ 

这是相当完整的｡ 

现在, 为了清理它, 您可以做的是终止这两个EC2实例｡

所以你去这里杀了他们｡ 

您还可以进入EFS文件系统,

通过输入文件系统ID将其删除｡

删除所有内容后,

您可以继续进入您的安全组并删除在此演示期间创建的额外安全组｡

好了, 这节课就到这里｡ 

我希望你们喜欢, 我们下次课再见｡

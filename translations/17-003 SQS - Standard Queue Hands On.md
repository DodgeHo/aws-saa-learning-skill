---
source: 17 - Decoupling applications SQS, SNS, Kinesis, Active MQ\003 SQS - Standard Queue Hands On_zh.srt
---

讲师：那么, 让我们练习一下Amazon SQS｡ 

因此, 我们将进入SQS控制台,

然后创建一个队列｡

现在我们可以看到, 我们可以在SQS中设置两种类型的队列｡

我们有标准队列和FIFO队列｡ 

我将使用标准的, 名称将是演示队列｡

我们稍后会看到FIFO｡ 

对于配置, 我们将在以后的课程中看到所有这些内容,

如可见性超时､ 传递延迟､ 等待时间､ 保留期,

我们将使用四天, 最大邮件大小将为256 KB, 这是SQS中允许的最大值｡

对于加密, 我们有几个加密选项,

因此我们可以完全禁用队列的加密, 但默认情况下,

我们使用Amazon SQS密钥启用它｡

它被称为SSE-SQS类型的加密,

类似于我们在Amazon S3中使用的SSE-S3｡

这是服务器端加密的一个选项｡ 

另一种是使用KMS｡ 

这就是我们必须选择客户主密钥的地方｡ 

因此, 我们可以选择AWS的默认CMK（别名/AWS/SQS）,

然后定义数据密钥重用周期, 例如可以是5分钟｡

这是为了限制在两个KMS中进行的API调用的数量｡ 

但这不是很重要,

所以我们将加密保留为Amazon SQS密钥SSE-SQS｡

好吧｡ 

接下来是访问策略｡ 

并且可以使用此处的提示来定义此访问策略｡

所以我们可以说, “嘿, 谁能很好地访问这个队列？ 只有队列所有者可以发送消息, 或者我可能想指定一个帐户､

用户和角色列表, 然后再指定谁可以接收消息｡

是只有我､ 队列所有者还是指定的帐户､

用户和角色？

这将从中生成一个json文档, 如您所见,

这个json文档看起来非常类似于我们在Amazon

S3中使用Amazon S3 Bucket策略时的文档｡

这是SQS的一个资源策略,

它的工作原理非常非常相似｡

现在, 对于重新驱动和死信队列, 我们将在稍后看到这一点,

所以现在, 我们很好｡

让我们继续创建队列｡ 

现在, 队列已成功创建, 我们可以继续向其发送和接收消息｡

在此UI中, 我们可以看到许多不同的面板,

但我们要做的是转到右上角,

然后单击“发送和接收消息”｡

所以这里有一个工具让我们发送信息,

然后在底部, 接收它们｡

因此, 正如我们现在在队列中所看到的,

我们没有可用的消息｡

但是如果我进入“你好世界！ ', 然后发送邮件｡

正如您所看到的, 消息已经发送并准备接收｡

现在我们有了一个可用的消息,

在这里, 只要我单击“拉取消息”,

消息就会出现｡

我们来看看｡ 

我单击拉取消息, 是的,

我们确实在这里收到了该消息｡

如我们所见, 我们有一个消息id｡ 

如果您想查看消息的内容,

我可以单击消息详细信息, 然后获得一些信息｡

所以有很多元数据围绕着这个信息｡ 

例如, 消息的哈希值, 谁发送的,

接收了多少次, 所以现在只接收一次,

因为这是我们第一次处理此消息,

大小以字节为单位｡

如果我们去想接收身体本身, 我们可以看到,

无论什么已经发送之前'你好世界！ 就在刚才读到的信息里｡ 

如果我们为消息创建属性, 有一个消息属性面板, 我们没有查看,

我们可以创建键值, 并从这里读取它们｡

所以很简单, 当你发送一条信息然后阅读它时,

你会得到完全相同的信息｡

但是我们已经解耦了, 因为生产者发送了一些信息,

消费者接收了这些信息｡

现在我们可以看到, 由于我们没有在足够的时间内处理它,

消息已经被接收了两次｡

因此, 30秒后, 消息返回到队列中,

我们再次收到它｡

因此, 如果提取消息, 则消息接收计数为3｡

因此, 它又被读了一遍｡ 

所以要完成这个消息, 因为假设我们已经处理了这个“你好,

世界！ 消息, 我会点击它, 然后我会点击删除｡

通过从队列中删除消息, 我们向SQS队列发出了消息已成功处理的信号,

因此队列中没有可用的消息｡

如果我们再次拉取, 我们将不会再次收到相同的消息,

因为我们已经删除了它｡

所以你开始看到队列的力量｡ 

我们可以继续发送许多不同的消息,

如hello world等,

您可以随意使用它, 这是您设置消息属性的方式,

但这超出了考试的范围｡

在这里你会收到这些信息, 你可以一次收到很多信息｡

如果我们发送“hello world”, 我们会再次发送该消息,

例如“hello world 2”,

然后发送该消息和“hello world 3”, 无论您在该消息中真正想要什么｡

正如我们所看到的, 只要刷新此窗口, 我们就可以看到可用的消息数为3｡

因此, 如果我提取消息, 这里将有三条消息可供处理｡

同样, 您可以将它们全部删除,

以通知SQS它们已被处理｡

很简单｡ 

但你已经看到了生产者和消费者的力量｡ 

现在, 回到队列中,

我们也可以看到一些选项｡

因此, 我们可以编辑此队列, 以编辑我们之前看到的所有配置,

或者您也可以清除此队列｡

这将删除队列中的所有消息｡ 

因此, 要删除所有消息, 您只需要键入purge, 它将继续删除所有内容,

这在您进行开发时非常有用｡

但我不认为你应该在制作中这样做｡ 

然后, 您将获得一些有关监视的信息,

例如这里, 它为您提供了一些有关队列中有多少消息､

最旧消息的大致年龄的信息, 如果您有一个自动伸缩组从SQS队列中读取消息, 这可能是伸缩SQS队列的另一种方法, 等等｡

最后是访问策略, 即谁可以访问队列以及如何访问;加密,

这是我们为SQS队列定义的服务端加密｡

例如, 我们现在使用SSE-SQS作为加密方案, 但我们可以编辑它｡

最后是死信重驱动状态, 如果您设置了死信队列,

则此状态是相关的｡

这堂课就到这里｡ 

我希望你们喜欢, 我们下节课再见｡

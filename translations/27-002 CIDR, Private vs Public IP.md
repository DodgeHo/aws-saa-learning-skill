## 学习目标

- 理解 CIDR（无类域间路由）表示法及其如何定义 IP 地址块。
- 明确私有 IP 与公网 IP 的区别、使用场景及 AWS 中常见的配置（如 VPC 子网、NAT、弹性 IP）。
- 能够根据需求为子网选择合适的 CIDR 大小并说明访问互联网的典型实现方式。

## 重点速览

- CIDR 表示法示例：`10.0.0.0/16` 表示从 `10.0.0.0` 起、掩码为 255.255.0.0 的地址范围。
- 私有 IP 范围（RFC1918）：`10.0.0.0/8`、`172.16.0.0/12`、`192.168.0.0/16`，这些地址不在互联网路由中传播。
- 在 AWS 中，VPC 和子网使用 CIDR 分配地址；子网可配置为公有（有路由到 Internet Gateway）或私有（通过 NAT 访问互联网）。
- 公网访问常见方式：直接使用弹性公网 IP（EIP）或通过 NAT Gateway/实例进行出站网关转换。

## 详细内容

1. CIDR 基础
   - CIDR 使用前缀长度 `/n` 指定网络位数，例如 `/24` 意味着 256 个地址（含网络与广播）。
   - 可用主机数约为 `2^(32-n) - 2`（小网段有特殊情况）。

2. 私有 IP 与公网 IP
   - 私有 IP：为内部网络保留，不可在公共互联网中直接路由。常用于实例间通信、后台服务。它们可由 NAT 设备映射为公网地址以进行外部访问。
   - 公网 IP：可被互联网直接访问。AWS 中的弹性公网 IP（EIP）是静态公网地址，可绑定到 EC2 或 NAT Gateway。

3. 在 AWS VPC 的实践
   - VPC 创建时必须指定一个 CIDR（例如 `10.0.0.0/16`）；然后在 VPC 内划分子网（例如 `10.0.1.0/24`）。
   - 公有子网：路由表中包含指向 Internet Gateway（IGW）的路由，且实例通常需要分配公网 IP 或绑定 EIP 才能被外部访问。
   - 私有子网：没有指向 IGW 的直接路由，若需要访问互联网则通过 NAT Gateway/Instance 来做地址转换，入站来自互联网的连接不能直接到达私有 IP。
   - VPC 的 CIDR 大小要预留增长空间：小规模环境可用 `/24` 子网，但跨多个 AZ 和服务时通常用 `/16` 或更宽的前缀来保持灵活性。

4. 设计建议与注意点
   - 避免与公司/合作方/客户网络的 CIDR 冲突，尤其在使用 VPN/Direct Connect 或 VPC Peering 时。
   - 不要把所有子网都划得过小，留出可扩展地址池；常见策略是为每个可用区保留独立的 `/24` 子网。
   - 使用 AWS 提供的 VPC IPv4 CIDR 限制与最佳实践：单个 VPC 最多支持若干个非重叠的 CIDR（取决于账户及区域设置）。

## 自测问题

1. CIDR `192.168.10.0/24` 包含多少个可用主机地址？请写出起止地址范围。
2. 列出三段 RFC1918 的私有地址范围，并说明为什么私有地址不能直接用于互联网通信。
3. 在 AWS 中，如果一个实例位于私有子网但需要访问互联网，它通常如何实现？列出至少两种实现方式并比较优缺点。
4. 解释为何在设计 VPC 时要避免与本地办公室网络使用相同的 CIDR。

---

（基于原文改写为学习笔记：学习目标 / 重点速览 / 详细内容 / 自测问题）

---
source: 15 - CloudFront & AWS Global Accelerator\002 CloudFront with S3 - Hands On_zh.srt
---

讲师：那么, 让我们来练习使用CloudFront,

但首先我们必须创建一个S3存储桶来保存我们的分发文件｡

所以, 让我们创建一个bucket,

我将其命名为demo-cloudFront-stephane-V4,

它将向下滚动, 保留所有默认值并单击Create

bucket｡

好了, 现在我的bucket已经创建好了,

我要在里面上传一些文件｡

所以, 让我添加文件, 我将选择我的三个文件,

海滩, 咖啡, 和索引｡ html｡ 

所以, 让我们上传他们, 现在他们已经上传｡ 

所以, 如果我进入我的桶, 我们可以看到所有的, 作为提醒,

如果我进入索引｡ html, 我有两种打开它的方法｡

第一个是使用对象URL, 但是如果我尝试它,

我会得到一个拒绝访问, 因为我的对象不是公共的｡

如果我点击Open here, 这会生成一个预签名的,

所以让我们允许弹出窗口, 这会为我的S3对象生成一个预签名的URL,

它允许我访问对象, 所以我看到我喜欢咖啡和Hello World, 但我仍然看不到图像, 因为图像本身不是公开的｡

所以, 让我们看看如何使用CloudFront使这些文件可以访问,

而不公开它们｡

那么, 让我们打开CloudFront控制台,

正如您在右上角看到的, 它是一个全球服务,

因为CloudFront是一个全球分发, 所以没有区域选择｡

接下来, 我们必须选择一个原始域名｡ 

所以, 正如你所看到的, 我得到了我的Amazon S3存储桶,

或者我的弹性负载均衡器或其他任何东西｡

所以, 如果我选择了我的bucket,

我可以选择我的演示CloudFront bucket,

点击此处退出｡

但是在这里你可以输入任何你想要的域名,

包括自定义HTTP来源, 这很好｡

然后是原点访问｡ 

你如何访问身份？

因为这是Amazon S3, 我们有多种方法,

我们有公共的, 也就是说桶本身必须是公共的, 但我们不是这样｡

然后是Origin访问控制, 即OAC｡ 

这是我们推荐的使用方式, 这里是OAI,

这是以前的方式, 但现在我们要使用OAC的新方式, 起源访问控制｡

所以, 我们需要创建一个来源访问控制｡ 

因此, 要做到这一点, 让我们点击创建控件设置, 它只是给我们一个名称｡

这很好, 让我们点击Create｡ 

因此, 现在已经创建了此策略, 我们必须更新S3存储桶策略｡

所以, 这是为了让CloudFront可以访问我们的S3存储桶,

因为如果您现在进入这里,

在权限下查看我们的存储桶本身, 然后向下滚动, 存储桶策略当前为空,

因此CloudFront将无法访问它｡

所以, 现在我们就保持原样｡ 

我将向下滚动并跳过许多不同的设置｡ 

对于WAF, 我们将禁用安全保护,

因为我们不需要它们｡

最后, 我们必须做的一件事是默认的根对象是index｡

html｡ 

好的, 一切正常｡ 

让我们创建我们的发行版,

我们的发行版可能需要一些时间来创建｡

正如您在这里看到的,

S3存储桶策略需要更新｡

所以, 我可以点击这里的复制策略,

从这里有一个快捷方式可以直接进入您的存储桶策略设置｡

所以, 佩奇, 我们来了, 我们有了｡ 

现在, 让我们点击Edit,

我们将粘贴我们刚刚打印的策略｡

顺便说一句, 如果你不知何故失去了对这个政策的访问权限,

你可以进入“起源”下, 然后在“起源”中,

你点击“编辑”, 向下滚动,

在这里你会找到要复制并粘贴的政策声明｡

所以, 如果你现在看看这个bucket策略,

我们允许平台服务在我们bucket中的任何文件上做get对象, 只要平台分发,

所以这是一个条件, 就是我们创建的那个｡

因此, 这基本上允许我们的分发访问S3桶｡

这很好, 这是由AWS生成的｡ 

除此之外, 我们什么也不做.

现在权限是正确的｡ 

所以, 回到CloudFront, 让我们取消这个,

我们转到我们的分发版,

我们必须等到它被部署｡

我的CloudFront分发现在已经准备好了,

所以我要复制域名, 打开一个新选项卡｡

正如你现在所看到的,

我喜欢咖啡, Hello World和我的形象｡

你可以去喝咖啡｡  jpeg, 当然这会工作,

你可以去/海滩｡ jpeg, 这也会工作｡

但最酷的是,

现在如果我刷新这个页面, 它实际上是从平台缓存中提供的,

而不是从S3存储桶本身, 因为, 好吧,

我请求了一次文件, 所以现在它们是由CloudFront自动发送的, 正如你所看到的,

加载速度要快得多｡

再一次, 如果我去索引｡  html, 这是从缓存中提供的｡

这就是CloudFront的美丽之处｡ 

现在, 我们已经通过CloudFront对Amazon

S3执行了一个请求, 然后将其余的请求缓存在分发版本身上｡

所以, 如果我现在回到CloudFront,

在左手边, 只是为了向您展示, 您拥有原始访问权限,

您将在这里找到原始访问控件｡

我们可以看到, 这一个已经创建,

并且现在处于活动状态,

并且被分配给这个分发｡

好吧就这样

我们已经了解了CloudFront的工作原理｡ 

希望你们喜欢, 下次课再见｡

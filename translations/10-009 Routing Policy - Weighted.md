---
source: 10 - Route 53\009 Routing Policy - Weighted_zh.srt
---

教师：现在我们来讨论加权路由策略｡

其思想是, 由于权重, 您可以控制一定百分比的请求转到特定资源｡

简单地说, 在图中, 我们有Amazon

route 53, 然后我们有三个EC2实例, 它们被分配了不同的权重, 分别是70､ 20和10｡

在我的例子中, 这些权重加起来是100,

但在现实生活中你不必这么做, 好吗？

但这意味着, 来自Amazon的70%的DNS响应将重定向到第一个EC2实例,

然后20%重定向到第二个, 10%重定向到第三个｡

所以我们在权重中要做的就是给每个记录分配一个相对权重｡

然后流量百分比将被发送到每条记录,

就像记录的权重除以所有记录的所有权重之和, 就像所有权重的百分比一样,

好吗？

权重不需要加起来等于100,

它们只是表示与DNS名称中的所有其他记录相比,

我们要向该实例发送多少内容｡

因此, 要实现这一点,

DNS记录必须具有相同的名称和类型, 您可以将它们与运行状况检查关联起来,

虽然我们还没有看到运行状况检查, 但我们很快就会看到它们｡

现在, 加权路由策略的使用情形非常明显,

例如, 可能跨不同区域执行负载平衡,

或者通过向新应用程序版本发送少量流量来测试新应用程序版本, 等等｡

然后, 如果你发送到一个权重为零的排序,

那么你将停止发送流量到一个特定的资源,

所以你可以随着时间的推移转移权重｡

如果所有资源记录的权重都为零,

则返回的所有记录的权重都相等｡

让我们在控制台中看看它是如何工作的｡

让我们创建一个新记录, 这个记录叫做加权记录｡

史蒂芬妮塔彻 com的网站｡ 

这是一个A记录, 路由策略将被加权｡

首先对于第一个值, 让我们输入ap-setheast-1的值,

这次我给它赋值的权重是10,

好吗？

所以它的重量非常非常小｡ 

对于TTL, 我会将其设置为非常低的值,

3秒, 以便向您展示加权的影响｡

但很明显, 这不是你在现实生活中会使用的TTL｡

因此, 正如我们所看到的,

我们可以将运行状况检查与它关联起来,

但现在我们不会｡

我们有一个可以设置的记录ID｡ 

这是为了在加权记录集内标识该特定记录｡

在这个例子中, 我从东南方向得到这个例子,

我只写东南方向｡

好的, 然后我们可以再加一条记录｡ 

同样, 我们将使用相同的权重｡

史蒂芬妮老师 好吗？

路由策略将被加权｡ 

它的值是来自us-east-1的值｡

我将复制此IP地址并粘贴到此处｡ 

这次的重量是70.

因此, 我们将70%的流量发送到us-east-1,

然后记录ID为“US East”｡

太好了, 还是TTL, 三秒｡ 

最后一条记录我们要加, 同样是加权的,

它的值是eu-central-1,

在这里｡

我将把它作为加权记录发送｡ 

我将发送20个砝码, 记录ID将是EU

OK｡

和TTL三秒｡ 

现在, 让我们继续创建这些记录｡ 

正如我们所看到的, 我们现在在这个表中有三条记录,

好吗？

这就是为什么它不同于, 例如,

一个简单的记录有两个值,

这里, 我们有三个记录, 每个记录有一个值作为答案,

但是我们有10, 20和70的权重｡

如果我现在转到这个URL,

如果我转到加权｡ 斯蒂芬老师｡  然后按Enter键,

我得到了来自us-east-1a的第一个响应, 这是有道理的,

因为这是70%的流量应该流向这个地区的地方｡

但是, 如果我刷新, 我需要刷新可能每三秒,

在某些时候, 我应该得到一个来自另一个地区的响应｡

而这仅仅是基于权重,

所以这是加权资源背后的（模糊不清）｡

如您所见, 这一个变化不大,

我们来执行一个dig命令, 以显示它的输出,

即dig加权｡ 斯蒂芬老师｡  com的网站｡ 

这里我们得到的TTL值是3, 答案是, 我想还是来自us-east-1的那个,

但是让我们试着再发出一个, 看看我们会不会更幸运｡

所以70的重量绝对是一个很大的重量｡ 

好的, 但是我们可以看到, 我们刚刚得到了一个答案, 这个是不同的IP,

3｡ 70. 14, 这对应于20的权重｡

正如我们所看到的, 加权做的正是它应该做的,

它将大多数查询重定向到一个有最大权重的查询, 但有时,

你会得到其他的答案, 好吗？

如此等等｡ 

所以这是你可以在你的网页浏览器中练习的东西,

就像我们看到的那样, 很酷｡

我刚被编辑进了中央1C｡ 

这节课就讲到这里, 希望它能向你们展示加权记录的力量｡

我希望你们喜欢, 下节课再见｡

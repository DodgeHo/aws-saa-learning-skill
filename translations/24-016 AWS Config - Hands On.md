---
source: 24 - AWS Monitoring & Audit CloudWatch, CloudTrail & Config\016 AWS Config - Hands On_zh.srt
---

教师：现在, 让我们进入配置服务并开始对其进行配置｡

现在, 我们已经进入该对话框, 我将单击"开始“,

开始记录一些设置｡

因此, 我们将记录此区域中支持的所有资源,

但如果您愿意, 也可以只记录特定的资源类型｡

在这种情况下, 您可以在右侧找到资源类别和资源类型｡

但因为我想向你们展示我能记录的所有资源,

所以我将单击这个｡

在此基础上, 您还可以包括全局资源,

如IAM用户､ 组角色和客户管理的策略｡

只是要注意, 再次,

配置不是这里的功能的一部分, 所以你记录的资源越多,

你要支付的钱就越多｡

所以我这样做是为了向你们展示所有的东西,

但是如果你们不想从这个课程中支付任何费用,

请不要继续这个实践｡

好的, 我们要记录我们的资源｡ 

我们将包括全局资源, 然后记录所有资源配置,

我们需要创建一个配置服务链接角色｡

我们将单击它｡ 

然后, 所有这些信息将被传递到Amazon

S3桶中｡

创建一个存储桶后, 已经输入了存储桶名称,

这样就很完美了｡

如果你愿意的话, 我们可以有一个前缀｡ 

最后, 这是数据的存储位置｡

在通知方面, 如果我们愿意,

我们可以将所有配置更改和通知流到Amazon

SNS主题中, 再次记住, 这是针对一个主题中的所有内容｡

但我不想这么做, 所以我不打勾｡ 

我单击“下一步”, 接下来我们将看到一些AWS托管规则｡ 

所以我们有很多, 如你所见, 我想稍后定义它们,

所以我会跳过这一部分,

但如果你想的话, 你可以看看它们｡

因此, 单击“下一步”, 我们可以查看配置｡ 

因此, 我们希望记录所有资源,

包括全局资源｡

我们将把它交付到S3存储桶中, 但目前我们尚未定义任何角色｡

我们单击“确认”｡ 

现在, 已创建角色和存储桶,

然后将启动配置｡

现在, 配置人员需要花点时间查看您帐户中的所有内容和配置｡

所以我会把视频发出去, 直到这件事结束｡ 

好的, 我的资源仍在被发现中, 但我可以转到左侧的资源,

实际上我们会看到, 一些资源已经在我的帐户中被发现了, 如您所见｡

发现了一些路由表､ 子网､

VPC等｡

因此, 我可以查看资源类型, 例如,

查找EC2安全组, 然后发现是的,

我的安全组在这里｡

目前, 它们没有合规性状态,

因为我们尚未在它们之上定义任何类型的规则｡

让我们以其中一个EC2安全组为例｡

在组内, 我们可以查看应用的规则,

因此目前没有｡

我们可以查看安全组本身的配置,

好吗？

我们还可以查看资源时间表｡ 

资源时间线将为您提供与该资源相关的所有事件｡

这里有一个配置更改,

就是这里的初始值｡

还有一些CloudTrail事件也与安全组有关｡

例如, 授权安全组入口规则, 创建启动配置和创建安全组,

这类事情｡

我们可以去CloudTrail找到这些事件｡ 

因此, 我想做的是弄清楚我的安全组是否符合要求｡

因此, 我们要讲规则｡ 

rules将能够为我们提供添加规则的选项,

我们可以添加AWS托管规则,

也可以使用lambda函数创建我们自己的自定义规则｡

为了简单起见, 我将添加一个AWS托管规则, 让我们来看看我们可以访问的规则｡

我喜欢的一个例子是, approved-amis-by-id｡ 

因此, 这是为了检查正在运行的实例是否在您的帐户中使用指定的AMI｡

例如, 如果我单击它, 然后单击“下一步”,

这与安全组无关, 但我只想向大家展示一条规则｡

因此, 此操作将检查您的EC2运行实例是否将使用指定的AMI｡

因此, 您可以根据资源的更改来触发此操作｡

然后, 您还可以在此处指定所有EC2实例,

我们必须为该规则指定一个参数,

该参数是在其帐户内批准的所有AMI

ID的列表, 规则和输入将使用该列表来确定EC2实例是否合规｡

因为我们还没有很多EC2实例, 所以我们不打算使用该规则｡

因此, 我们将使用托管规则,

但这次是针对SSH｡

这将应用于我们的安全组｡ 

因此, 我们要确保不允许任何SSH流量从任何地方传入｡

我们单击“下一步”, 这称为受限SSH,

只要配置发生更改, 触发器就会出现在我们的资源上,

明白吗？

但是正如我们所看到的, 如果我们定义一种不同的规则,

我们也可以让它周期性地运行｡

所以, 好吧, 我们就一次｡ 

每当我们的安全组资源发生变化时, 请评估该规则｡

这仅适用于AWS EC2安全组,

并且该行没有参数｡

单击“下一步”, 然后单击“添加规则”｡ 

现在我们已经定义了第一条规则,

让我们来看看｡

因此, 目前尚未对该问题进行评估, 我们也没有任何补救措施｡

所以让我们等一等, 直到这个完成｡ 

所以我刚刚刷新了我的页面, 正如你所看到的,

评估是自动完成的｡

如果我们看一下这个规则,

我们有七个安全组, 这里没有六个安全组, 它们是不符合的｡

如果我们查看左侧的资源, 我们将再次按EC2安全组进行筛选, 并查看所有资源｡

我们可以看到, 有的是合规的,

有的是不合规的｡

因此, 如果我们看看合规和非合规的,

让我们看看区别｡

所以这个是合规的, 好吗？

我们对它应用了一条规则, 可以看到它显示为“合规”｡

因此, 如果我管理一个资源, 并查看此处的入站规则,

我们可以看到, 我们只有一个入站规则, 它没有端口, 因此此处没有端口22｡

所以这就是为什么这是工作｡ 

但如果我看到一个不兼容的资源,

例如, 这个launch-wizard-3,

我认为它是不兼容的, 好吗？

然后单击“Manage Resource”（管理资源）,

我们将再次直接进入安全组控制台｡

如果您查看入站规则, 我们可以看到,

IPv4上的端口22从任何地方都是开放的｡

所以这是个大问题｡ 

所以我能做的就是删除这个规则｡ 

如果我删除这个规则,

这将重新触发我的资源的评估, 这应该使它再次符合｡

所以, 让我们删除它, 并保存我的规则｡ 

安全组已经被修改了, 让我来关闭它｡

这是我的非遵从性安全组, 我可以进入资源时间线查看｡

因此, 在资源时间线内,

我们可以看到配置发生了更改, 然后运行了规则,

但它不符合要求｡

现在, 我再次更改了配置, 因此我们需要等待一段时间,

等待配置更改在此处发生,

这将触发规则遵从性, 希望现在资源将遵从规则｡

让我稍微停一下, 然后再和你们说｡ 

我刚刚刷新了我的页面, 正如我们在7月12日看到的,

在规则合规性之后, 发生了一个CloudTrail事件, 因为我确实因为删除了一个入口规则而撤销了一个安全组入口规则,

这是真的｡

然后, 它还记录了一个配置更改,

该配置更改说, 嘿, 具有端口22的规则已被删除,

因此from和to为空, 因为它已被删除｡

然后配置, 他们再次运行我的规则, 名为受限SSH｡

现在, 我的资源符合要求｡ 

所以这意味着, 是的,

我已经修复了我的资源的顺应性｡

我可以返回到这里,

查看另一个安全组,

例如, 这个组｡

在这里的规则下, 您可以执行操作,

然后管理补救｡

这是针对此规则进行的补救, 如果您查看此规则,

就会发现我们有管理补救, 而且我们可以进行手动补救或自动补救｡

在这种情况下, 你可以指定你的重试次数和重试发生的秒数,

好吗？

例如, 我们可以选择手动修复, 然后您需要选择修复操作｡

这些是我们可以选择的SSM自动化文档｡ 

这些都是由AWS定义的, 但我们也可以创建自己的｡ 

例如, 如果快照或图像不符合我们的要求,

我们可以将其删除｡

因此, 真正由您来定义您想要的操作｡ 

例如, 您可以说, hey attach EBS volume（连接EBS卷）,

这是基于不合规资源的正确限制｡

资源ID参数（如果需要将其提供给修正等）｡

现在这个补救行动没有任何意义,

对吧？

我们需要定义一个对规则有意义的修正操作,

但正如您所看到的, 我们可以设置自动或手动修正,

并对其进行配置等, 最好在文档本身的一些参数中进行配置｡

以上就是配置, 希望大家喜欢｡ 

然后聚合器是跨多个帐户集成,

好吗？

然后在“设置”下,

您可以查看我们之前定义的设置, 例如,

包括将所有数据发送到SNS主题｡

或者您可以设置Amazon CloudWatch活动规则, 好吗？

从CloudWatch控制台或从事件规则控制台,

仅拦截某些特定规则的特定不合规事件｡

这一节就讲到这里了, 希望你们喜欢,

下节课再见.

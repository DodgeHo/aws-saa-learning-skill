---
source: 19 - Serverless Overviews from a Solution Architect Perspective\014 API Gateway Basics Hands-On_zh.srt
---

教师：让我们打开API网关, 我们进入API网关控制台｡

正如你在这里看到的,

我可以选择一个API类型｡

所以我们有HTTP, API, 我们有WebSocket

API, REST API, 它们是公共的或私有的,

因此, 我们现在只处理REST API｡

所以我们可以通过点击这个来尝试新的控制台,

这将很快成为默认值｡

所以请确保有这个｡ 

然后你选择REST API, 然后你构建它｡ 

所以当你构建一个API, 一个REST API时,

你有几个选择｡

你可以创建一个新的API, 你可以从一个开放的API定义文件中导入一个｡

这里说的是文件和导入,

API是为你创建的｡

您可以克隆现有的API,

也可以从示例API开始｡

对于我们来说, 我们将从一个新的API开始,

名称将是MyFirstAPI｡

现在, 如您所见, 对于API端点类型,

我们有三个选项｡

我们有区域, 边缘优化或私人｡ 

因此, 区域将部署在一个区域｡ 

边缘优化将部署在许多不同的地区,

但它将部署在边缘｡

第一, API仍然存在于一个区域｡ 

或者private只是private, 不暴露在网络上｡ 

为了保持简单,

现在我将选择区域API类型｡

让我们来创建API｡ 

我们就在这里

所以现在我们在这里,

我们将在这个API中创建第一个方法｡

为此, 您单击此处的创建方法, 然后我们选择方法类型｡

所以它可以是任何一个HTTP动词, 但我们要做一个GET,

只是为了得到一个页面｡

然后你必须选择集成类型｡ 

所以你可以看到我们有五个选择｡ 

我们有Lambda函数, HTTP, Mock, AWS服务和VPC链接｡

我们要测试的是Lambda函数｡ 

但我想向你们展示, 我们也可以与任何地区的任何服务相集成｡

所以我们选择一个地区, 然后我们选择一个服务｡ 

它的作用是, 您可以通过API

Gateway将某些AWS服务公开为API｡

因此, 我们将保持简单,

并在其中使用Lambda函数｡

所以我们需要选择一个Lambda函数,

但为此, 我们当然需要创建它｡

所以让我们进入Lambda并创建我们的函数,

它将对这个API网关做出反应｡

所以创建一个函数, 我称之为api-gateway-route-gets｡

这是完美的｡ 

然后我在运行时使用的框架将是Python

3｡ 11但是无论Python

3还是Python都应该工作｡

所以这是完美的｡ 

让我们来创建这个函数｡ 

在创建的同时, 我想给你们看一下我们要用的代码｡

所以我在我的代码中, 在我的文件夹中, 有一个“密码”｡

py.

这是我们要复制到Lambda的全部代码｡ 

所以这个想法是, 这是一个非常简单的函数,

它响应于一个有上下文的事件, 然后说, “嘿,

这个身体将是来自Lambda的hello｡

它将作为尸体被归还｡  状态码是200｡

然后头部是Content-Type application/json,

让我们的Web浏览器知道我们得到了JSON响应｡

所以我要复制整个代码｡ 

向下滚动并粘贴到这里｡ 

所以我们要部署这个函数｡ 

所以我将单击Deploy来部署这个函数, 我们也可以测试它｡

例如, 我可以创建一个名为DemoTest的测试事件｡ 

然后我们发送这个事件, 保存它,

然后点击测试｡

正如你所看到的, 结果是来自Lambda的hello,

状态码为200｡

所以现在一切都很好, 这是完美的｡ 

我现在要做的是将这个Lambda函数集成到我的API网关中｡

回到这里, 我要复制函数ARN, 转到我的API网关,

然后单击并粘贴ARN｡

完美了

现在我们已经集成了Lambda函数,

因为我们希望看到完整的请求被传递到Lambda并从Lambda发回,

所以您将进行Lambda代理集成｡

现在, 对于超时, 正如您所看到的,

即使Lambda函数可以有很长的超时时间,

例如5分钟或15分钟, API Gateway也有有限的超时时间, 默认值为29秒｡

您可以自定义它, 使其小于29秒,

但无论Lambda函数执行多长时间,

默认超时都是29秒｡

所以让我们创建这个方法,

它将自动授予API网关, 调用Lambda函数的权利｡

所以如果我回到这里并刷新这个页面, 正如你现在看到的,

我们的API网关可以调用我们的Lambda函数,

我们可以通过进入配置和权限来验证这一点｡

如果我们看一下基于资源的策略声明,

这一个, 我们点击View policy, 结果是如果源API是来自我的API网关的路由GET,

则允许我的API网关调用我的Lambda函数｡

这是在AWS上后台发生的事情, 允许API网关调用我们的Lambda函数｡

所以我们知道一切都是从安全的角度来做的｡

现在我们可以看看我们的API网关｡ 

因此, 这个方法的客户端发送了一个请求, 我们可以在这里查看请求本身｡

所有的设置都在这里, 它已经完成了与Lambda的集成,

所以它是一个Lambda类型的集成,

启用了代理｡

那么Lambda本身就是这个函数｡ 

我们可以点击它并返回到我们的功能｡ 

然后, 响应是代理集成｡ 

这意味着它会, API网关将解析Lambda发送的内容并解释它｡

方法反应就是我们这里所得到的｡ 

如果你愿意, 我们可以修改它, 但我们要找的是application/json｡

让我们测试一下这个API｡ 

右下角有一个测试, 你可以指定一些查询字符串或一些头,

但我们没有指定任何东西｡

只需点击测试｡ 

测试是, 嘿, 响应体是Lambda的hello｡

所以你可以从API网关看到, 状态是200｡ 

我们的代码里写着状态是200.

我们还有响应体, 来自Lambda的hello, 同样, 在我们的代码中定义在这里,

body等于json｡

垃圾场

你好, Lambda｡ 

最后, 内容类型是JSON,

并且作为内容类型JSON的响应头的一部分进行检索｡

在测试的基础上, 我们可以查看API网关的执行日志,

这真的很好, 这也是你想要调试并查看发生了什么的时候｡

一个非常好的方式这样做｡ 

因此, 我们已经在Lambda函数上完成了API网关的第一次执行｡

现在让我们实际调试它, 看看发送给Lambda函数的是什么｡

所以我要打印事件, 然后我要部署它,

我们现在要从API网关再次调用Lambda函数｡

所以我们要运行一个新的测试, 它仍然从Lambda说hello,

但这次我们要打印事件｡

所以如果我们去看云监控日志应该能找到它｡

让我们进入监控, 然后看看CloudWatch日志｡

我们要找到最新的日志流, 这一个｡ 

这是我们的日志

我们可以在这里看到, 这是从API网关接收的打印事件｡

这里有一些信息, 比如,

资源是斜杠, 路径是斜杠, 方法是GET,

然后你得到头, 然后你得到查询字符串参数,

等等｡

因此, 大量信息通过API网关传递给我们的Lambda函数｡

我们的Lambda函数可以使用这些信息来伪造响应并将其发送回API网关｡

所以现在我们可以继续并实际创建一个新的资源｡ 

所以这次我们将通过这样做来获得资源,

资源名称将是房屋｡

让我们创建这个资源｡ 

现在我们有了我刚刚打开的/houses路径｡ 

在/houses中, 我将创建一个方法｡ 

对于代理集成的Lambda函数, 它将再次成为GET｡

我需要创建Lambda函数｡ 

让我们快速地做一下, 我将复制这个,

然后创建一个函数｡

它还不是根, 它的房子还没有现在｡ 

运行时仍然是Python｡ 

让我们创建这个函数｡ 

再一次, 我将复制这段代码｡ 

所以我们要把Lambda的hello改成hello,

然后是房子｡

现在, 我的功能已经创建了｡ 

我们要复制这个,

它将是你好从我的漂亮的房子｡

好的, 我们要展开这个｡ 

现在我们已经部署了该函数｡ 

我将复制函数ARN并粘贴到这里｡

创造了这个方法｡ 

所以现在我们有/houses, 它有GET方法｡ 

我可以测试一下｡ 

所以让我们测试一下, 然后点击测试｡ 

你也看到了, 我漂亮的房子里有200个人跟我打招呼｡ 

到目前为止, 这是相当酷的｡ 

我们有根GET和房子GET, 它们调用两个不同的Lambda函数｡

但是我们希望能够从Web浏览器访问它,

而不仅仅是从API网关UI测试它｡

因此, 让我们单击Deploy API, 我们需要选择一个阶段｡ 

所以这将是一个新的阶段, 名字是dev,

我们稍后会看到它｡

我们把这个展开｡ 

现在我们已经部署了这个API, 有一个调用URL｡ 

所以我要复制这个URL, 然后我要把它粘贴到我的Web浏览器中｡

你可以看到, 当我打开/dev时,

它说Lambda的hello｡

所以这只是Firefox做了一个漂亮的打印, 但是你从Lambda得到了hello｡

如果我去房子, 我会从我漂亮的房子里得到你好｡

所以这个API有两个Lambda函数回复我｡ 

如果我做错了什么, 如果我做/错了,

那么我会收到错误消息,

例如缺少身份验证令牌的消息｡

我们开始吧｡ 

我们已经将我们的API部署到API网关, 这非常酷,

因为我们有两个Lambda函数在后台实际响应它｡

这就是我们在API网关上的基本角色｡ 

我希望你们喜欢, 我们下次课再见｡

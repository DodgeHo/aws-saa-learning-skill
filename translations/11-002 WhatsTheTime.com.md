---
source: 11 - Classic Solutions Architecture Discussions\002 WhatsTheTime.com_zh.srt
---

讲师：好的, 现在我们开始讨论第一个解决方案体系结构｡

我真的很兴奋,

因为我们将看到这么多不同的主题, 我们将真正了解它们是如何适应的,

以及我们作为解决方案架构师面临的挑战是什么｡

第一个网站是WhatIsTheTime｡  和什么是时间｡

com让人们知道现在是什么时间｡ 

我知道这听起来很愚蠢,

但至少它是如此容易, 每个人都明白它,

我们将能够谈论它的长度｡

所以我们不需要数据库, 因为它太简单了｡ 

每个实例､ 每个服务器都知道时间, 我们希望从小处着手｡

我们愿意接受停机时间, 但总的来说,

也许我们的应用程序会越来越受欢迎｡

人们真的想知道世界各地的时间,

所以我们需要纵向扩展, 横向扩展可能会消除停机时间｡

让我们来了解一下此应用程序的解决方案架构师之旅｡

你会看到, 我们会看到很多事情, 我们可以如何继续下去｡ 

我们从简单的开始｡ 

好吧, 让我们从头开始｡ 

您是一名解决方案架构师, 您说您知道什么是最好的？

你有一个T2微实例, 你有一个用户,

用户问, “现在几点了？ 然后说, “现在是下午5：30｡  “, 搞定了, 这是我的app｡ 

因此, 我们有一个公共EC2实例,

并且因为我们希望使EC2实例具有静态IP地址,

以防发生什么情况, 并且我们重新启动它,

所以我将向它附加一个弹性IP地址｡

这是我的第一个PoC, 效果非常好｡ 

我们的用户能够访问我们的应用程序,

我们得到了很好的反馈｡

所以现在的情况是, 我们的用户在使用我们的应用程序时真的很开心｡

于是他们对朋友们说：“嘿, 你们也应该用这个应用程序｡

所以另一个朋友进来说, “现在几点了？ 晚上7：30,

另一个朋友进来, “现在几点了？ “, 6：30 PM, 因此我们意识到我们的应用程序正在获得越来越多的流量,

当然T2 Micro实例是不够的｡

因此, 作为解决方案架构师, 我们会说,

等一下, 也许我们应该用稍微大一点的东西来替换T2

Micro实例, 以处理负载, 这称为垂直扩展｡

也许我们可以把它做成一个M5大型实例｡ 

我们要做的就是停止实例,

更改实例类型,

然后重新启动实例, 就这样｡

这是M5类型的实例｡ 

这里发生的情况是, 它具有相同的公共IP,

因为它具有弹性IP地址, 所以人们仍然能够访问我们的应用程序,

但我们在升级到M5时遇到了宕机｡

因此, 我们的用户在那一刻并不高兴,

他们无法访问我们的应用程序｡

这是可行的, 但不是很好, 对吧？

所以接下来我们会非常受欢迎,

是时候横向扩展了｡

记住, 应用程序M5有一个公共IP,

弹性IP连接到它｡

现在我们有很多用户｡ 

所以他们都问现在几点了？

现在我们要横向扩展｡ 

因此, 我们开始添加EC2实例, 它们都是M5大小,

并且都连接了一个弹性IP｡

现在, 除了三个EC2实例之外,

我们还有三个弹性IP｡

因此, 我们的用户需要知道这三个弹性IP的确切值,

才能与我们的实例进行通信｡

这就是所谓的水平扩展｡ 

我们做得不错, 但我们看到我们开始达到一些极限｡

现在用户需要知道越来越多的IP,

我们必须管理更多的基础设施,

这是非常棘手的, 对不对？

好吧, 我们换个方法｡ 

现在, 我们有三个EC2实例M5, 让我们删除弹性IP,

因为它是我们无法真正管理的东西｡

默认情况下, 每个区域每个帐户只有五个弹性IP,

所以不是很多｡

因此, 我们的用户, 他们要做的是,

他们要利用53号公路｡

所以我们已经建立了53号公路,

网站的URL是api｡ 什么时候了｡  com公司｡ 

我们决定这将是一个A记录,

TTL为一小时｡

A记录意味着从这样的DNS,

它会给我一个IP列表｡

记住53A公路的记录是IP

太好了, 用户查询Route 53,

然后获得EC2实例的IP地址,

这些地址可能会随时间变化, 但这并不重要,

因为Route 53会更新, 我们会更新它并使其保持同步｡

因此, 我们的用户现在能够访问我们的EC2实例, 而我们不再需要管理任何Elastic

IP｡

所以使用53号公路, 我们做了一些很好的改进｡ 

但是现在发生的是, 我们希望能够缩放, 你知道,

能够添加和删除飞行中的实例｡

当我们删除一个实例时, 会发生什么？

看起来像是顶部的这些用户,

他们正在与这个M5大型实例对话,

但现在它消失了, 结果是, 如果他们执行Route

53查询, 因为TTL是一个小时,

他们在一个小时内使用相同的响应｡

因此, 在一个小时内, 他们将尝试连接到该实例,

但该实例已消失｡

因此, 这不是很好, 因为即使这些用户玩得很开心,

也许一个小时后, 这些用户将能够连接到这两个实例,

但他们现在玩得不开心, 因为他们认为我们的应用程序已关闭, 这真的很糟糕｡

好吧, 这是一个架构,

我们看到了它的局限性｡

那么我们怎样才能把它推进一点呢？

那么, 让我们来讨论一下添加负载平衡器的问题｡ 

因此, 现在我们不再有公共实例,

而是有私有EC2实例, 我们将在同一可用性区域中启动它们,

因为我们不知道更好的方法｡

因此, 我们手动启动了它们,

我们有三个和五个大型实例,

我们遵循这一过程, 我们说, 好吧,

让我们使用负载平衡器｡

您知道, 除此之外, 它还将进行运行状况检查, 例如,

如果一个实例关闭或不工作, 至少我们不会将用户的流量发送到该实例｡

好吧, 我们把两者联系起来｡ 

因此, 我的ELB将面向公众, 而我的私有实例EC2实例在后面,

因此它们可能使用我们之前看到的安全组规则（使用安全组作为参考）来限制这两者之间的流量｡

好吧, 听起来不错｡ 

所以现在我们的用户, 他们要查询whatisthetime｡

com,

但这次不能是A记录, 因为负载均衡器的IP一直在变化｡

因此, 由于它是一个负载平衡器,

我们可以使用别名记录｡

这个别名记录是完美的, 因为它将指向从53号公路到ELB,

一切都会工作得很好｡

这里我们将更改DNS｡ 

但是现在用户连接到我们的负载平衡器,

负载平衡器将我们重定向到EC2实例,

并平衡流量｡

这真的很棒, 因为现在, 我们可以添加和删除这些实例,

并将它们注册到负载平衡器, 而且由于运行状况检查功能,

我们不会为用户提供任何停机时间｡

所以真的, 真的很好｡ 

但是现在手动添加和删除实例是相当困难的｡

那么, 我们利用刚刚在本课程中学到的一些知识,

并启动一个自动扩展组, 怎么样？

现在我们的API在左手边, 是一样的,

53号公路, ELB｡

但现在在右侧, 我们将有一个可用性区域,

我们将启动专用EC2实例,

但这次它们将由一个自动扩展组管理｡

因此, 这使得我们的自动缩放组基本上可以按需缩放,

也许在早上, 没有人想知道时间, 但在晚上, 当人们想下班时,

他们想知道时间｡

因此, 我们能够根据需求进行扩展, 进行横向扩展和横向扩展｡

这真的非常棒, 因为现在我们有了一个应用程序,

没有停机时间, 自动扩展, 负载平衡｡

它看起来像是一个非常稳定的体系结构,

它确实是, 但发生的是,

有一个地震发生和可用性下降｡

一个倒下了, 你猜怎么着？

我们的应用程序完全瘫痪了, 我们的用户很不高兴｡ 

因此Amazon找到我们说：“是的, 这是因为您尚未实施多AZ应用程序,

我们建议您实施多AZ以实现高可用性｡

好吧,

我们说, “好吧, 让我们稍微改变一下｡ 现在, 我们必须进行ELB, 除了运行状况检查之外,

它还将是多AZ的, 并且将在AZ 1到3上启动｡

因此, 此ELB的三个AZ以及自动扩展组将跨多个AZ,

这允许我们在AZ 1中有两个实例,

在AZ 2中有两个实例, 在AZ 3中有一个实例｡

所以现在最酷的事情是, 哦, 太好了,

如果AZ 1坏了, 那么, 我们仍然有AZ 2和AZ 3来为我们的用户提供流量,

我们已经有效地使我们的应用程序多AZ,

高可用性和故障恢复能力｡

很棒吧？

好吧, 我们能走多远, 继续｡ 

我们有两个AZ, 并且知道每个AZ中至少要运行一个实例,

那么为什么不保留容量呢？

为什么我们不从根本上降低应用程序的成本呢？因为我们知道,

一年中必须始终运行两个实例｡

因此, 通过保留实例（可能是针对自动扩展组的最小容量）,

我们将在未来节省大量成本｡

而新实例的启动, 可能是临时的,

所以按需即可｡

或者, 如果我们有点疯狂,

我们甚至可以使用spot实例以降低成本,

但我们可能会终止实例｡

这真的很有趣, 对吧？

因为我们已经看到一个体系结构从非常小的应用程序一直发展到负载平衡､

自动扩展组､ 多AZ､ 运行状况检查､ 保留实例类型的应用程序｡

对我来说, 这就是作为一名解决方案架构师的旅程;这取决于理解什么是需求,

以及为了满足这些需求我们应该构建什么, 这就是考试要测试的内容｡

现在, 这是第一次架构讨论, 相信我, 下节课还会有很多其他的讨论｡

但现在, 让我们回顾一下我们讨论过的内容｡ 

例如, 我们已经讨论过, EC2实例要有一个公共IP和一个私有IP,

您知道, 它在我们的体系结构图中处于什么位置？

我们还看到了使用弹性IP与使用Route 53以及可能使用负载均衡器对我们的应用程序的好处｡

我们还看到, 由于53号公路的TTL,

我们不能真正使用A记录｡

因此, 我们必须使用负载平衡器和别名记录,

这样才能看到53号公路如何适应整个情况｡

我们已经了解了如何手动维护EC2实例, 然后我们会说, 这太多维护工作了,

让我们使用自动扩展组吧, 您知道吗, 它实际上会为我们提供更好的成本控制,

因为它可以按需扩展, 而且我们随时都有完美数量的EC2实例｡

然后我们说, 好吧, 让我们进入Multi

AZ, 我们可以这样度过灾难｡

让我们启用ELB运行状况检查, 这样只有正确响应的实例才能获得流量｡

我们已经了解了如何设置安全组规则,

以便EC2实例只接收来自ELB的流量, 最后我们说,

“你知道吗, 让我们看看容量, 让我们节省一些成本｡

我们总是希望两个EC2实例在任何时候运行,

所以让我们保留这些实例, 这样我们将节省大量成本｡

这里的所有讨论,

如果在AWS中有一种东西叫做良好架构的框架, 我们将在专门的部分详细讨论它,

但它有五个支柱, 分别是成本､ 性能､ 可靠性､ 安全性和卓越运营｡

通过这次讨论, 我想告诉你们, 我们已经看到了这五大支柱｡

因此, 如果成本有许多不同的用途, 那么我们可能会纵向扩展实例,

可能会使用ASG根据负载来获得适当数量的实例,

也可能会保留实例以优化成本｡

在性能方面, 我们已经看到了垂直扩展､

ILB和自动扩展组, 基本上就是我们如何随着时间的推移而适应性能｡

可靠性, 我们已经了解了如何使用路由53将流量基本可靠地定向到正确的EC2实例,

并且可能对ELB使用多AZ, 对ASG也使用多AZ｡

在安全性方面, 我们已经了解了如何使用安全组将负载平衡器基本链接到我们的实例,

实现可靠和卓越的运营, 如何从非常笨拙的手动流程发展到使用自动扩展组实现完全自动化, 等等｡

所以真的很棒｡ 

我认为这是一个很好的讨论, 我们还会有许多其他讨论, 但作为一名解决方案架构师,

请开始了解我们所看到的技术是什么, 它们如何相互配合,

以及在我们正确配置的情况下, 它们如何一起解决问题｡

就这样, 我希望你们喜欢,

我们下节课再见｡

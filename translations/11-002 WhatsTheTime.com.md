---
source: 11 - Classic Solutions Architecture Discussions\002 WhatsTheTime.com_zh.srt
---

# 架构演进：WhatsTheTime.com

## 学习目标
- 理解从单实例到可扩展架构的演进
- 识别弹性 IP 与 DNS 的局限
- 理解引入负载均衡的动机

## 重点速览
- 单实例 + EIP：简单但有停机风险
- 垂直扩展：需要停机
- 多实例 + Route 53：扩展但受 TTL 影响

## 详细内容
阶段 1：单实例 PoC
- 单个 EC2 + 弹性 IP
- 简单可用，但单点故障

阶段 2：垂直扩展
- 升级实例规格
- 需要停机，影响可用性

阶段 3：水平扩展 + 多 EIP
- 多台实例各自 EIP
- 运维复杂，IP 管理困难

阶段 4：Route 53 A 记录
- 用 DNS 统一入口
- TTL 较长时实例下线会导致缓存失效问题

结论：需要负载均衡器与自动伸缩来解决扩缩与可用性问题。

## 自测问题
- 为什么仅靠 Route 53 不能替代负载均衡？
- TTL 对故障切换有什么影响？

我们有三个和五个大型实例,

我们遵循这一过程, 我们说, 好吧,

让我们使用负载平衡器｡

您知道, 除此之外, 它还将进行运行状况检查, 例如,

如果一个实例关闭或不工作, 至少我们不会将用户的流量发送到该实例｡

好吧, 我们把两者联系起来｡ 

因此, 我的ELB将面向公众, 而我的私有实例EC2实例在后面,

因此它们可能使用我们之前看到的安全组规则（使用安全组作为参考）来限制这两者之间的流量｡

好吧, 听起来不错｡ 

所以现在我们的用户, 他们要查询whatisthetime｡

com,

但这次不能是A记录, 因为负载均衡器的IP一直在变化｡

因此, 由于它是一个负载平衡器,

我们可以使用别名记录｡

这个别名记录是完美的, 因为它将指向从53号公路到ELB,

一切都会工作得很好｡

这里我们将更改DNS｡ 

但是现在用户连接到我们的负载平衡器,

负载平衡器将我们重定向到EC2实例,

并平衡流量｡

这真的很棒, 因为现在, 我们可以添加和删除这些实例,

并将它们注册到负载平衡器, 而且由于运行状况检查功能,

我们不会为用户提供任何停机时间｡

所以真的, 真的很好｡ 

但是现在手动添加和删除实例是相当困难的｡

那么, 我们利用刚刚在本课程中学到的一些知识,

并启动一个自动扩展组, 怎么样？

现在我们的API在左手边, 是一样的,

53号公路, ELB｡

但现在在右侧, 我们将有一个可用性区域,

我们将启动专用EC2实例,

但这次它们将由一个自动扩展组管理｡

因此, 这使得我们的自动缩放组基本上可以按需缩放,

也许在早上, 没有人想知道时间, 但在晚上, 当人们想下班时,

他们想知道时间｡

因此, 我们能够根据需求进行扩展, 进行横向扩展和横向扩展｡

这真的非常棒, 因为现在我们有了一个应用程序,

没有停机时间, 自动扩展, 负载平衡｡

它看起来像是一个非常稳定的体系结构,

它确实是, 但发生的是,

有一个地震发生和可用性下降｡

一个倒下了, 你猜怎么着？

我们的应用程序完全瘫痪了, 我们的用户很不高兴｡ 

因此Amazon找到我们说：“是的, 这是因为您尚未实施多AZ应用程序,

我们建议您实施多AZ以实现高可用性｡

好吧,

我们说, “好吧, 让我们稍微改变一下｡ 现在, 我们必须进行ELB, 除了运行状况检查之外,

它还将是多AZ的, 并且将在AZ 1到3上启动｡

因此, 此ELB的三个AZ以及自动扩展组将跨多个AZ,

这允许我们在AZ 1中有两个实例,

在AZ 2中有两个实例, 在AZ 3中有一个实例｡

所以现在最酷的事情是, 哦, 太好了,

如果AZ 1坏了, 那么, 我们仍然有AZ 2和AZ 3来为我们的用户提供流量,

我们已经有效地使我们的应用程序多AZ,

高可用性和故障恢复能力｡

很棒吧？

好吧, 我们能走多远, 继续｡ 

我们有两个AZ, 并且知道每个AZ中至少要运行一个实例,

那么为什么不保留容量呢？

为什么我们不从根本上降低应用程序的成本呢？因为我们知道,

一年中必须始终运行两个实例｡

因此, 通过保留实例（可能是针对自动扩展组的最小容量）,

我们将在未来节省大量成本｡

而新实例的启动, 可能是临时的,

所以按需即可｡

或者, 如果我们有点疯狂,

我们甚至可以使用spot实例以降低成本,

但我们可能会终止实例｡

这真的很有趣, 对吧？

因为我们已经看到一个体系结构从非常小的应用程序一直发展到负载平衡､

自动扩展组､ 多AZ､ 运行状况检查､ 保留实例类型的应用程序｡

对我来说, 这就是作为一名解决方案架构师的旅程;这取决于理解什么是需求,

以及为了满足这些需求我们应该构建什么, 这就是考试要测试的内容｡

现在, 这是第一次架构讨论, 相信我, 下节课还会有很多其他的讨论｡

但现在, 让我们回顾一下我们讨论过的内容｡ 

例如, 我们已经讨论过, EC2实例要有一个公共IP和一个私有IP,

您知道, 它在我们的体系结构图中处于什么位置？

我们还看到了使用弹性IP与使用Route 53以及可能使用负载均衡器对我们的应用程序的好处｡

我们还看到, 由于53号公路的TTL,

我们不能真正使用A记录｡

因此, 我们必须使用负载平衡器和别名记录,

这样才能看到53号公路如何适应整个情况｡

我们已经了解了如何手动维护EC2实例, 然后我们会说, 这太多维护工作了,

让我们使用自动扩展组吧, 您知道吗, 它实际上会为我们提供更好的成本控制,

因为它可以按需扩展, 而且我们随时都有完美数量的EC2实例｡

然后我们说, 好吧, 让我们进入Multi

AZ, 我们可以这样度过灾难｡

让我们启用ELB运行状况检查, 这样只有正确响应的实例才能获得流量｡

我们已经了解了如何设置安全组规则,

以便EC2实例只接收来自ELB的流量, 最后我们说,

“你知道吗, 让我们看看容量, 让我们节省一些成本｡

我们总是希望两个EC2实例在任何时候运行,

所以让我们保留这些实例, 这样我们将节省大量成本｡

这里的所有讨论,

如果在AWS中有一种东西叫做良好架构的框架, 我们将在专门的部分详细讨论它,

但它有五个支柱, 分别是成本､ 性能､ 可靠性､ 安全性和卓越运营｡

通过这次讨论, 我想告诉你们, 我们已经看到了这五大支柱｡

因此, 如果成本有许多不同的用途, 那么我们可能会纵向扩展实例,

可能会使用ASG根据负载来获得适当数量的实例,

也可能会保留实例以优化成本｡

在性能方面, 我们已经看到了垂直扩展､

ILB和自动扩展组, 基本上就是我们如何随着时间的推移而适应性能｡

可靠性, 我们已经了解了如何使用路由53将流量基本可靠地定向到正确的EC2实例,

并且可能对ELB使用多AZ, 对ASG也使用多AZ｡

在安全性方面, 我们已经了解了如何使用安全组将负载平衡器基本链接到我们的实例,

实现可靠和卓越的运营, 如何从非常笨拙的手动流程发展到使用自动扩展组实现完全自动化, 等等｡

所以真的很棒｡ 

我认为这是一个很好的讨论, 我们还会有许多其他讨论, 但作为一名解决方案架构师,

请开始了解我们所看到的技术是什么, 它们如何相互配合,

以及在我们正确配置的情况下, 它们如何一起解决问题｡

就这样, 我希望你们喜欢,

我们下节课再见｡

---
source: 10 - Route 53\011 Route 53 - Health Checks_zh.srt
---

教师：那么, 让我们来谈谈53号公路的健康检查｡

健康检查是一种检查公共资源健康状况的方法,

当然我们也可以对私有资源进行健康检查, 这节课我们会讲到｡

例如, 我们在不同的区域有两个负载平衡器,

它们是公共负载平衡器, 好吗？

在后台, 我们的应用程序在这两个平台上运行｡

因此, 我们需要一个多区域设置,

因为我们需要在区域级别实现高可用性等｡

然后, 我们将使用Route 53创建DNS记录｡ 

这就是用户访问我们的URL的时间,

例如mydomain｡ com上, 然后它们被重定向到例如它们拥有的最近的负载平衡器｡

这就是延迟类型记录的情况｡ 

但我们希望确保, 如果一个地区出现故障,

我们不会将用户发送到该地区, 这是显而易见的,

对吗？

为此, 我们将从53号公路创建运行状况检查｡

因此, 我们将在us-east-1中的实例上创建运行状况检查,

并在eu-west-1中的实例上创建运行状况检查｡

有了这两项健康检查,

我们就能把它们和53号公路的记录联系起来.

我们这样做的原因是为了实现自动化的DNS故障转移｡ 

因此, 我们有三种可能的健康检查｡ 

我刚才向大家展示的是监控端点（公共端点）的运行状况检查｡

因此, 它可以是应用程序､ 服务器或其他AWS资源｡

它可以是监控其他运行状况检查的运行状况检查（也称为计算运行状况检查）,

也可以是监控CloudWatch警报的运行状况检查, 这将为您提供更多控制, 并有助于私有资源, 我们将在本讲座中看到这一点｡

最后, 这些运行状况检查有自己的指标, 您也可以在CloudWatch指标中查看它们｡

现在, 让我们看看运行状况检查如何与特定端点配合使用｡

因此, 如果我们对eu-west-1和ALB进行运行状况检查,

那么AWS的运行状况检查人员将来自世界各地｡

因此, 这不仅仅是一个运行状况检查器｡ 

这是来自世界各地的15个健康检查员｡ 

它们都会将请求发送到我们的公共端点,

发送到我们设置的任何路由｡

然后, 如果它返回200个OK代码或我们定义的代码,

则认为该资源是健康的｡

因此, 大约有15个全局运行状况检查器将检查端点的运行状况,

然后您可以设置一个阈值来判断运行状况是否正常｡

您可以设置一个间隔,

因此我们有两个选项｡

它可以是30秒的定期健康检查或每10秒,

这是一个更高的成本, 这就是所谓的快速健康检查｡

它支持许多协议, 如HTTP､ HTTPS和TCP｡ 

规则是, 如果超过18%的健康检查员说端点是健康的,

那么53号公路将认为它是健康的,

否则它被认为是不健康的｡

您还可以选择要用于运行状况检查的位置｡

现在, 仅当您从负载平衡器返回状态2xx或3xx状态代码,

并且运行状况检查具有冷却功能时, 运行状况检查才会通过｡

因此, 如果它是基于文本的响应,

那么健康检查器可以检查响应的前5, 120个字节, 以在响应本身中查找一些特定的文本｡

最后, 从网络角度来看非常重要的一点是,

如果您希望运行状况检查器正常工作,

那么很明显, 它必须能够访问您的应用程序平衡器或您拥有的任何端点｡

因此, 您必须允许来自Route 53健康检查器的IP地址范围的传入请求｡

您可以在屏幕右下角的URL中找到此地址范围｡

第二种类型的运行状况检查是计算运行状况检查｡

因此, 这是将多个运行状况检查的结果合并到单个运行状况检查中｡

如果您看一下Route 53, 其中有三个EC2实例,

我们可以创建三个运行状况检查｡

它们都将是儿童健康检查,

并且它们都可以逐个监视每个EC2实例｡

然后, 我们可以定义父级运行状况检查,

该检查将在所有这些子级运行状况检查上定义｡

因此, 组合所有这些运行状况检查的条件可以是OR､

AND或NOT｡

您最多可以监视256个子级运行状况检查,

并且可以指定父级需要通过多少个运行状况检查｡

例如, 如果您希望进行父级健康检查,

以便在不导致所有健康检查失败的情况下对您的网站执行维护, 则可以使用此用例｡

那么, 我们如何监控私人资源的健康状况呢？

因此, 如果您想要监控某些私有内容, 这将是困难的,

因为虽然所有Route

53运行状况检查程序都位于公共Web上,

但它们位于VPC之外, 因此无法访问私有端点｡

因此, 如果是私有VPC或内部资源, 

因此, 我们可以这样做, 虽然, 是创建一个CloudWatch指标,

并分配一个CloudWatch警报｡

然后, 您可以将CloudWatch警报分配到运行状况检查器中｡

我们的想法是, 使用CloudWatch指标监控私有子网中EC2实例的运行状况｡

然后, 如果违反了指标, 我们将在其上创建CloudWatch警报｡

当警报进入警报状态时, 运行状况检查程序将自动处于不正常状态,

因此将创建我们想要的内容, 即对私有资源进行运行状况检查, 这是最常见的使用情形｡

这节课就讲到这里｡ 

我希望你们喜欢它, 我们下节课再见｡

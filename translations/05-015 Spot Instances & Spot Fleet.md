---
source: 05 - EC2 Fundamentals\015 Spot Instances & Spot Fleet_zh.srt
---

讲师：好的, 让我们深入了解EC2

spot实例｡

因此, 我们知道, 与按需实例相比,

使用现货实例可以获得高达90%的折扣, 因此可以节省大量成本｡

这是怎么做到的呢？

我们定义一个最大现货价格,

我们愿意为该现货实例支付｡

然后, 只要实例的现货价格低于我们愿意支付的最高价格,

那么我们就保留该实例｡

所以, 最大现货价格,

我将在下一张幻灯片中向您展示,

但每小时现货将根据报价和容量而变化, 因此它会上升,

也会下降｡

如果当前的现货价格超过了你定义的最高价格,

那么你有两个选择｡

对于这两个选项,

您有两分钟的宽限期｡

所以, 这给了你一点时间来做这些事情｡ 

选项可以是停止实例, 这意味着关闭正在执行的所有操作,

然后停止实例｡

因此, 如果有一天现货价格低于您的最高价格,

那么您可以重新启动您的实例并继续您离开的地方, 或者如果您不需要EC2实例上的状态, 您可以选择终止您的实例并让它离开｡

然后, 这将假设您可以在任何时候重新启动您的工作,

您可以从一个全新的EC2实例开始｡

所以, 两个策略基于你的工作量类型,

但你有两分钟的成绩时间来做｡

另一种策略是, 如果您不希望您的spot实例被AWS回收,

则使用spot块｡

Spot阻止是指在指定的时间段内阻止一个Spot实例｡

这可能是1到6个小时, 你可以不受任何干扰地完成这个过程,

至少在文件上是这样的, 因为在文档中--但这真的很少见｡

在极少数情况下, 实例可能会被回收, 但总的来说,

当你考虑一个spot块的时候, 实例不会被回收, 这就是spot块的全部目的｡

那么, 我们什么时候使用spot实例呢？

它们用于批处理作业､ 数据分析,

工作负载对故障具有弹性｡

正如我所说,

它们不适合关键作业或数据库｡

现在让我们来看看现货实例的定价｡ 

这是我直接从AWS控制台获得的图表｡

正如我们在这里看到的, 这给了我们一个m4大型实例在现货区域三个月的价格｡

所以, 正如你所看到的,

你有六条线给我们-东1a｡

对不起, 地区｡ 

你有六个可用区｡ 

六个价格｡ 

所以, 正如你所看到的,

现货价格确实根据你考虑的AZ而有所不同｡

正如我们所看到的, 在三个月的时间里,

它发生了很大的变化｡

例如, 如果你看那条黄线,

它在0. 四比零｡  45, 一路跌到几乎0.

35､ 我说, 等等｡ 

因此, 让我们假设我们正在定义一个用户定义的最高价格是这个黑色的水平线/虚线,

好吗？

因此, 我们会看到, 如果黄线在虚线上方,

那么当前现货价格将高于我们定义的最高价格｡

所以, 在这个例子中, 我们将失去我们的现货实例,

所以我们必须终止它或停止它,

但如果价格下降, 所以如果黄线沿着我们的虚线,

这意味着我们愿意支付这个价格｡

因此, 我们在此期间获得了现场实例｡ 

因此, 这就是我们可以非常轻松地优化工作负载成本的方法｡

如您所见,

按需价格为0美元｡ 每小时10个｡ 

所以这真的很便宜｡ 

然后现货实例价格更便宜｡ 

大约是0美元｡  4我说

因此, 该实例的现货实例定价节省了60%｡

所以, 很多储蓄｡ 

显然, 如果你要定义你的用户定义的最高价格是像0美元｡

05每小时,

那么没有现货实例将被回收, 因为你总是愿意支付高于现货实例的实际价格｡

所以, 没有人可以预测价格如何随着时间的推移,

但正如你所看到的, 它可以相当稳定,

它可以波动一点点,

但总的来说, 它仍然为您提供了巨大的节省相比,

按需, 好吗？

好了下一个

如何终止spot实例？

所以, 我们必须首先了解点请求是如何工作的｡ 

因此, 让我们考虑一个现场请求｡ 

因此, 使用spot请求,

您可以定义您想要的实例数量, 您将要支付的最高价格,

启动规范, AMI等, 以及您的请求从何时起有效, 直到何时,

但它可以是无限的｡

然后是请求类型｡ 

有两种类型的请求,

理解这一点很重要｡

您可以对Spot实例进行一次性请求,

也可以对Spot实例进行持久性请求｡

让我们来看看两者的区别｡ 

因此, 如果它是一次性请求,

一旦您的spot请求完成, 您的实例将被启动, 然后您的spot请求将消失,

因为它是一次性请求类型｡

所以在这种情况下,

你的现场请求会消失, 你很好｡

但如果是持久请求类型,

这意味着只要spot请求从到有效到有效,

我们就希望这个数量的实例有效｡

因此, 这意味着如果您的实例确实以某种方式根据现货价格停止或中断,

那么您的现货请求将重新生效｡

当事情可以验证时, 我们将为您重新启动spot实例｡

因此, 如果您以某种方式停止了持久模式下的spot实例,

而您的spot请求仍然处于活动状态,

您的spot请求将自动智能地为您重新启动启动和实例｡

你们也可以在这张图中看到, 但我不会在上面花太多时间｡

因此, 您可以从中了解到,

如果要取消一个spot请求, 它需要处于打开状态､

活动状态或禁用状态｡

这意味着基本上它没有失败,

没有取消, 或者没有关闭, 好吗？

当你想取消一个spot请求时,

如果你把左边的spot请求取消了,

它不会终止你之前启动的任何实例｡

因此, 终止这些实例仍然是您的责任,

而不是AWS的责任｡

因此, 如果您希望永久终止spot实例并且不重新启动它们,

则需要首先取消spot请求, 然后终止关联的spot实例｡

因为如果你要先终止spot实例, 记住它会返回到spot请求,

spot请求说, “好的, 你想要六个实例”,

但我可以看到你现在没有｡

“我给你开六个副本｡  因此, 取消和终止spot实例的正确顺序是首先取消spot请求,

以确保AWS不会启动新实例, 然后终止关联的spot实例｡

我在这上面花了点时间, 因为这是考试中会出现的问题｡

好, 下一个：现货舰队｡ 

这是省钱的终极方法｡ 

所以, spot fleets将是一种定义方法,

让您可以获得一组spot实例和可选的按需实例,

这就是为什么它被称为fleet｡

现货船队将在您定义的价格约束下尽最大努力满足目标容量｡

因此, 它将从可能的发射池发射｡ 

因此, 它可以具有不同的实例类型､ 不同的操作系统和可用区｡

因此, 您将定义多个启动池, 因此多个实例类型,

多个所有内容｡

然后舰队会为你选择最好最合适的发射池｡

当您的现货舰队达到您的预算或达到您想要的容量时,

它将停止启动实例｡

因此, 您定义了一个策略来在您的spot队列中分配spot实例,

这是需要记住的｡

第一个是最低价格,

这将是考试中最受欢迎的一个,

即现货舰队将从价格最低的池中启动实例,

这为您提供了大量的成本优化｡

如果你的工作量很短, 这是一个很好的选择｡

您还可以采用多样化的方式来启动您的spot实例,

在这种情况下, spot实例中的启动将分布在您之前定义的所有池中, 这对于可用性和长期工作负载非常有用, 因为如果一个池消失, 那么其他池仍然处于活动状态｡

然后, 您可以优化容量｡ 

因此, 您拥有一个具有最佳容量的池,

可满足您所需的实例数量｡

然后进行价格容量优化, 即首先选择具有最高可用容量的池,

然后在其中选择价格最低的池, 这是大多数工作负载的最佳选择｡

所以, 这个想法是, 现货舰队可能很复杂,

但你必须记住的是, 使用现货舰队,

你可以定义多个启动池和多个实例类型,

直到你只是对原始功率感兴趣｡

然后如果你对现货机队使用最低价折扣或者最低价策略,

那么现货机队会自动为我们请求价格最低的现货实例｡

因此, spot fleets基于spot实例为我们提供了额外的节省,

因为它足够聪明, 可以选择正确的spot实例池, 让我们获得最大的节省｡

这就是现货舰队的好处｡ 

同样, 你需要理解这里的区别, 做一个非常简单的现货实例请求,

你确切地知道你想要的实例类型和你想要的AZ使用现货舰队, 并说, “好吧,

你可以选择所有这些实例类型”和所有这些AZ, “我需要你做的是”给我最低的价格, 例如, 好吗？

所以,

希望这能让你深入了解现货舰队和现货实例的不同之处｡

我希望你们喜欢这节课,

我们下节课再见｡

---
source: 29 - More Solution Architectures\001 Event Processing in AWS_zh.srt
---

Instucor：那么, 让我们来谈谈AWS中的事件处理,

以及我们所拥有的不同可能性和与之相伴的约束类型｡

所以第一个是使用SQS和Lambda｡ 

如果你在Lambda函数中使用SQS和Lambda,

我们的SQS队列, 那么事件将被插入到SQS队列中｡

Lambda服务将拉取SQS队列｡ 

如果出现问题, 它会将消息放回到SQS队列中,

然后不断尝试提取它们, 好吗？

这可能会进入某种无限循环｡ 

如果一条消息出现了大问题,

我们可以设置SQS, 在尝试五次后, 将消息发送到一个死信Q,

好吗？

这是我们的出路｡ 

现在我们还可以使用SQS FIFO和Lambda｡ 

在这种情况下, FIFO表示先进先出｡ 

这意味着消息将按顺序进行处理｡

所以现在我们的Lambda函数将不断尝试从队列中获取消息｡

但是, 因为它只是按顺序处理它们,

如果一条消息没有通过,

它将是一个阻塞的､ 永不结束的进程, 整个队列处理将被阻塞｡

在这种情况下, 我们可以再次建立一个死信队列,

将这些消息发送到SQS队列, 并允许我们的函数继续处理它｡

好吧, 我会的

接下来, 我们有另一个选择, SNS和Lambda｡ 

在这种情况下, SNS是一个服务,

消息通过它, 然后消息被异步发送到Lambda｡

在这种情况下, Lambda函数是一种不同的重试行为｡

如果它无法处理该消息,

它将重试, 但在内部进行｡

重试次数为三次｡ 

而如果消息没有被成功处理, 它将被丢弃,

或者我们可以设置一个DLQ｡

但是这次, 在Lambda服务级别将该消息发送到SQS队列中进行信件处理｡

所以我们可以看到, 这是一种不同的建筑｡ 

使用SQS时, DLQ设置在SQS端｡ 

而对于Lambda, DLQ设置在Lambda侧｡ 

因此, 不同的架构具有不同的需求｡ 

现在, 我们来讨论扇出模式,

即如何将数据传递到多个SQS队列？

第一种选择是, 我们的应用程序上安装了AWS

SDK｡

我们有三个SQS, 我们想传递一个消息给他们｡

因此, 我们可以很容易地编写应用程序,

首先向第一个队列发送消息,

然后向第二个队列发送消息｡

然后将相同的消息再次发送到第三个队列｡ 

这是可行的,

但有点不太可靠, 对吗？

因为例如, 如果我们的应用程序在我们向第二个队列发送消息后崩溃,

那么第三个队列将永远不会收到最后一条消息｡

并且每个队列的内容将是不同的｡ 

所以, 虽然这是可行的, 这是不是很可靠,

这是不漂亮｡

相反, 我们可以使用扇出模式,

将SQS队列与中间的SNS主题相结合｡

在这种情况下, 会发生什么？

好吧, 我们的SQS队列将成为中间SNS主题的订阅者？

接下来, 每当我们向SNS主题发送消息时,

SNS服务都会将其发送到我们所有的SQS队列中,

这是一个更高的保证｡

所以从我们现在的应用角度来看,

我们只是把一个投入到我们的SNS主题中｡

SNS服务会自动将该消息分散到其他SQS队列中｡

这真的很有效｡ 

这是AWS上非常常见的设计模式｡ 

关于S3事件通知, 您可以对Amazon

S3存储桶上的特定事件做出反应,

例如创建､ 删除､ 恢复对象的时间,

以及复制发生的时间, 您还可以按名称进行筛选｡

因此, 一个用例是生成上传到Amazon

S3的图像的缩略图｡

因此, 您可以从Amazon S3事件发送到SNS､

SQS或Lambda函数, 并且可以根据需要创建任意数量的S3事件｡

这些事件通知通常会在几秒钟内送达,

但有时可能需要一分钟或更长时间｡

所以你必须记住这三个整合｡ 

还有最后一个, 那就是使用Amazon事件桥｡ 

因此, 在本例中,

事件将发生在Amazon S3存储桶中｡

而所有的事件实际上都被发送到现在的亚马逊事件桥｡

使用规则, 我们可以将它们发送到超过18个AWS服务作为目标｡

那么, 您为什么要使用EventBridge呢？

因为您可以获得具有相邻规则的过滤选项｡

因此, 您可以根据元数据､ 对象大小､

名称等进行筛选｡

您也可以一次将其发送到多个目的地, 如步进函数､ Kinesis

Streams或Data Firehose｡

然后, 您还可以使用EventBridge功能,

例如归档､ 重放和可靠的事件交付,

这可能是您所需要的｡

谈论事件桥｡ 

请记住, 您可以使用与CloudTrail的集成来拦截Amazon

EventBridge的任何API调用｡

例如, 如果您希望对用户从DynamoDB中删除表的事件做出反应,

则使用删除表API调用｡

然后, 此API调用将被记录在CloudTrail中｡ 

实际上他们都将被记录在CloudTrail.

这些将触发Amazon EventBridge中的事件｡ 

从这个, 你可以创建提醒提醒亚马逊SNS.

最后, 您可以将外部事件放到AWS上｡ 

例如, 使用API网关｡ 

所以他们说客户端会将请求发送到一个API网关｡

API网关将消息发送到Kinesis数据流中｡

记录将在Nemesis数据Firehose结束,

然后数据, 例如, 可以在Amazon S3结束｡

您已经看到了很多在AWS中集成事件和构建一些很酷的自动化的选项｡

我希望你们喜欢它, 我们下节课再见｡

---
source: 30 - Other Services\007 SSM Session Manager_zh.srt
---

老师：好的｡  现在, 我们来讨论一下Systems

Manager的SSM会话管理器功能｡

因此, 这允许您在EC2实例和内部部署服务器上启动安全shell,

而无需SSH访问, 也不需要堡垒主机或任何SSH密钥｡

这意味着EC2实例上的端口22将被关闭,

因为不需要通过SSH在EC2实例上建立安全shell｡

这意味着更好的安全性｡ 

那这是怎么做到的呢？

我们马上要展示的EC2实例有一个SSM代理,

该代理连接到会话管理器服务｡

因此, 这意味着我们的用户可以通过会话管理器服务访问这两个实例,

并在其上执行一些命令｡

它支持Linux､ macOS和Windows,

我们可以将日志数据发送到Amazon S3或CloudWatch

Logs, 使其超级安全｡

我想当我们动手的时候会更有意义,

所以让我们开始吧｡

让我们来看看SSM会话管理器服务, 但首先,

我们需要启动一个EC2实例｡

我们现在启动一个实例, 然后向下滚动｡

我们将选择亚马逊Linux 2 AMI, t2. 微型的

我们不会使用任何密钥对｡ 

然后我将禁用SSH流量｡ 

因此, 正如您所看到的, 我的EC2实例将有一个不允许任何操作的安全组｡

没有HTTP, 没有HTTPS, 没有SSH｡ 

然而, 我们将能够使用SSM会话管理器shell｡ 

因此, 我实际上需要做的是将IAM实例配置文件附加到我的实例,

以允许它与SSM服务进行通信｡

我这里有几个, 但我将创建一个新的,

只是为了显示过程｡

因此, 单击“创建新IAM角色配置文件”｡ 

然后让我们创建一个角色｡ 

对于AWS上的服务, 它将是Amazon EC2｡ 

单击“下一步”｡  然后, 对于权限,

我们将筛选SSM, 并选择Amazon

SSM托管实例核心｡

让我们选择此选项, 然后单击“下一步”｡ 

然后, 我将把它称为SSM的演示EC2角色,

它允许EC2实例使用此策略与SSM服务对话｡

因此, 这对于由SSM服务管理我的实例是必要的,

因此我们可以使用SSM会话管理器特性｡

现在, 此角色已创建,

我们将在此处进行刷新, 并查找用于SSM的演示EC2角色｡

好极了｡  现在, 让我们继续创建并启动实例,

该实例现在已启动并将启动｡

现在我必须检查SSM服务｡ 

现在, 让我们进入Systems Manager｡ 

在左侧, 您将查找Fleet

Manager, Fleet Manager是一项服务,

在此处将显示所有注册到SSM的EC2实例｡

因此, 它们被称为受管节点｡ 

正如您现在看到的,

我们没有任何托管节点,

但我们需要等待EC2实例启动, 然后它就会出现在这里｡

好吧, 我会的 我刚刚刷新了一下, 如您所见,

有一个实例｡ 它在运行｡ 

我们可以看到SSM代理处于联机状态｡ 

我们可以看到平台､ 操作系统､

Amazon Linux 2､ SSM代理版本,

如果需要, 还可以链接到EC2实例｡

好吧, 我会的 因此, 只要我们的实例处于Fleet

Manager之下,

就意味着我们准备好对其运行安全shell｡

为此, 我将向下滚动并查找会话管理器｡

现在, 会话管理器是我们访问Linux实例和Windows实例的一种方式｡

我们开始一个疗程吧｡ 

正如您在这里看到的,

安全组下的EC2实例没有任何入站规则｡

好吧, 我会的 所以这里没有入站规则｡ 

因此, 让我们在此EC2实例上启动一个会话并启动它｡ 

我们的想法是我们将得到一个安全的shell,

你马上就会看到｡

在这里, 我们去, 我们有一个安全的外壳,

我不需要有SSH访问, 所以我可以做ping谷歌｡

这个命令显然是可以用的｡

如果我执行host以获取主机名, 我们可以看到这是IP

172-31-1-148, 它与我的实例的私有IP地址完全对应, 如果进入网络,

它就是我的实例的私有IP地址｡

这意味着, 使用SSM安全shell,

我们可以直接从AWS获得安全shell,

而无需SSH安全密钥和SSH访问｡

总之, 我们有三种访问EC2实例的方法｡

第一种方法是打开端口22, 然后使用SSH密钥,

并使用终端执行SSH命令｡

第二个是使用EC2实例连接, 它不需要获取SSH密钥,

因为如果需要, 它们将临时上传到Amazon EC2实例｡

这是第二个问题, 但这仍然需要在EC2实例上打开端口22,

以便使用EC2实例连接进行访问｡

然后, 我们探讨了第三个选项,

即会话管理器｡

因此, 我们需要确保我们有一个Amazon

Linux 2的EC2实例,

并确保此EC2实例具有IAM角色,

而此IAM角色（如您在“安全性”下所见）具有IAM角色,

此IAM角色允许从EC2实例访问Systems

Manager, 这就是我们运行安全外壳的原因｡

这节课就讲到这里｡ 

我们可以终止此会话, 很酷的是,

会话历史将以日志的形式保存｡

我们可以在这里看到会话历史记录｡ 

所以这是真棒｡ 

最后, 取下你的实例并终止它｡ 

就这样了｡ 

我希望你们喜欢这节课,

下节课再见｡

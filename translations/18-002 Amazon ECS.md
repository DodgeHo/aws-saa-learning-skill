---
source: 18 - Containers on AWS ECS, Fargate, ECR & EKS\002 Amazon ECS_zh.srt
---

好了, 现在让我们来谈谈Amazon ECS, 我们将对它的所有不同方面进行概述｡

所以我想和你们谈的第一件事是EC2发射类型｡ 

因此, X代表弹性容器服务, 当您在AWS上启动Docker容器时, 您正在ECS集群上启动所谓的ECS任务｡

ECS集群是由事物组成的｡ 

对于EC2启动类型, 这些都是EC2实例, 在这种情况下, 如果您使用EC2启动类型的ECS集群,

则必须自己配置和维护基础设施｡

这意味着您的Amazon ECS集群将由多个EC2实例组成｡ 

现在这些实例有点特殊, 因为每个实例都必须运行代理, 然后该代理将每个EC2实例注册到Amazon

ECS服务和指定的ECS集群中｡

现在, 一旦你有了它, 那么当你启动任务时, AWS将启动或停止容器｡

这意味着每当你有一个新的Docker容器时, 它会随着时间的推移相应地放置在每个EC2实例上,

正如你在这里看到的｡

您可以启动或停止ECS任务, 它们将自动放置｡ 

这就是EC2启动类型, Docker容器被放置在我们提前配置的Amazon EC2实例上｡

好的｡ 

现在有第二种发射类型叫做法盖特发射类型｡ 

同样, 您在AWS上启动Docker容器, 但这次您没有配置基础设施｡ 

因此没有EC2实例需要管理｡ 

一切都是无服务器的｡ 

为什么？

因为我们不管理服务器｡ 

当然, 后面还有服务器｡ 

因此, 在fargate类型中, 如果我们有一个ECS集群, 我们只需创建一个任务定义来定义我们的任务,

然后根据我们需要多少CPU和RAM来运行这些任务｡

所以每当我们想要运行一个新的docker容器时, 就这么简单｡ 

它将在我们不知道它在哪里运行的情况下运行, 并且在我们的帐户中没有在后端创建EC2实例以使其工作｡

所以这有点神奇｡ 

然后要扩展得很好, 你只需要增加简单任务的数量｡ 

你不需要管理更多的EC2实例, 考试喜欢告诉你使用fargate, 因为fargate是无服务器的,

它比EC2启动类型更容易管理｡

好了, 我们已经看到了Amazon ECS的两种启动类型｡ 

现在我们来讨论任务的角色｡ 

因此, 让我们以EC2启动类型为例, 其中我们有一个在Docker上运行ECS代理的EC2实例｡

因此, 在这种情况下, 我们可以创建一个仅有效的EC2实例配置文件｡ 

当然, 如果您使用EC2启动类型, 并且它将仅由代理使用, 然后代理将使用EC2实例配置文件对服务进行API调用以恢复实例将对cloudwatch日志进行API调用以发送容器日志将使用对ECR的API调用从ECR中提取Docker映像,

并引用Secrets Manager或SSM参数存储中的敏感数据｡

然后我们的任务将获得ECS任务角色｡ 

所以这对EC2发射类型和Fargate都有效｡ 

这里我有两个任务, 我们可以为每个任务创建一个特定的角色｡ 

所以我的第一个任务将有一个EC2任务角色, 第一个任务是第二个任务, 它将有一个任务角色｡

为什么我们有不同的角色？

因为每个角色都允许您链接到不同的服务｡ 

例如, EC2任务角色允许您运行任务｡ 

某些API调用针对Amazon S3, 而任务B角色允许您再次运行｡ 

API调用DynamoDB, 并在服务的任务定义中定义任务角色｡ 

因此, 请记住EC2实例配置文件角色和ECS任务角色之间的区别｡ 

下一个负载平衡器集成｡ 

所以在这个例子中, 我是在EC2启动类型, 但它也可以是Fargate,

当然, 并有多个任务运行｡

这些任务都在ECS集群中, 我们希望将这些任务公开为Http或Https端点｡ 

因此, 我们可以在它前面运行一个应用程序负载均衡器, 然后我们的用户将转到Alb,

并在后端直接访问任务｡

因此, 在这种情况下, Alb得到支持, 并将支持大多数用例, 这是一个很好的选择｡ 

仅当您有非常高的吞吐量或高性能用例时, 才建议使用网络负载均衡器,

或者您将在本课程后面学习到, 如果您将其与Privatelink一起使用, 或者如果您想使用旧一代经典负载均衡器,

您可以｡

但绝对不推荐, 因为您没有获得任何高级功能, 并且无法将弹性负载均衡器链接到fargate｡

然而, 如果你使用的是应用程序负载均衡器, 那么它当然可以与Fargate一起工作｡ 

那么, Amazon ECS上的数据持久性如何呢？

为此, 您需要数据卷, 并且有不同的类型, 但其中一种是值得注意的, 那就是EFS｡

假设您有一个ECS集群, 在本例中, 我代表了ECS集群的EC2实例和Fargate启动类型,

我们希望将文件系统挂载到ECS任务上以共享一些数据｡

在这种情况下, 我们使用Amazon EFS文件系统, 因为它是一个网络文件系统,

它将与EC2和Fargate启动类型兼容, 并且它允许我们将文件系统直接挂载到任务上｡

为什么？

那么, 在任何链接到此Amazon EFS文件系统的任务中运行的任务都将共享相同的数据,

因此如果需要, 可以通过文件系统彼此通信｡

因此, 最终的组合是使用Fargate以无服务器的方式启动ECS任务, 并使用Amazon EFS进行文件系统持久化,

因为EFS也是无服务器的｡

我们不管理任何服务器｡ 

它是随用随付的, 只是提前准备好了, 你就可以开始了｡ 

因此, 将EFS与一起使用的用例是为您的容器执行持久性多az共享存储｡ 

您应该注意的是, Amazon S3不能作为文件系统挂载到您的任务上｡ 

好吧, 就这样｡ 

我希望你们会喜欢, 我们下次课再见面练习｡

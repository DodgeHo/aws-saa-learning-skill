---
source: 27 - Networking - VPC\021 VPC Endpoints Hands On_zh.srt
---

讲师：接下来,

我们将练习使用VPC端点｡

首先, 我想向您展示的是, 我将停止此默认VPC实例,

因为我们实际上并不需要它｡

所以我要终止这个实例, 是的, 结束｡ 

因此, 如果我们进入堡垒主机,

它也是一个公共实例,

我们将连接到它｡

然后, 从该EC2实例连接到我的专用EC2实例,

这是我的专用EC2实例的IP, 我们可以在其中执行SSH命令,

EC2用户的IP减去i demoKeyPair｡

下午4时｡ 

好吧, 我们把这弄清楚｡ 

现在我们要访问S3, 好吗？

因此, 要访问S3, 我们需要为该实例创建一个角色｡

好的, 我们将进入安全状态, 现在没有附加IM角色｡

所以我要做的就是右键单击,

然后我会进入安全, 然后修改IM角色｡

我们需要创建一个新角色,

我将为EC2实例快速创建一个角色,

因此, 让我们创建一个角色｡

这是针对EC2实例的, 接下来是权限｡ 

对于我们现有的策略, 我们将使用Amazon

S3只读访问权限, 好吗？

标记, 查看, 然后我将它命名为DemoRoleEC

2-S3 ReadOnly, 好的｡

创建角色, 并且已经创建｡ 

现在, 我可以刷新此页面, 查看此演示角色EC2

S3（只读）, 并保存它｡

我提供的实例无效, 因此, 我们需要等待一个小延迟｡

好的, 我的私有实例现在作为一个IM角色附加到它,

所以如果我回到这里, 并执行AWS

S3 LS｡

正如我们所看到的, 我们得到了我们的四个桶的答案,

我们的帐户｡

所以我们的实例连接到了互联网上, 同样, 我们可以使用curl

google｡ com的网站｡ 

再一次, 我们得到了答案, 好吗？

这是可行的, 但现在我要做的是,

在我的专用子网的路由表下, 编辑路由,

并且删除通过NAT网关连接到互联网的路由｡

所以我现在要做的就是阻止这个实例访问互联网｡

所以如果我们做S3LS, 这是行不通的, 如果我们做curl谷歌｡

com,

这也不起作用, 因此我们从该EC2实例中删除了Internet访问,

因为我们希望通过VPC端点私下连接到Amazon S3｡

接下来, 我们将创建一个VPC端点,

我将单击“端点”, 而不是“端点服务”,

然后单击“创建端点”｡

在这里, 我可以选择所需的端点类型｡ 

因此, 我需要一个AWS服务的端点, 然后我们有一个所有服务的列表,

以及我们拥有的VPC端点的类型｡

我们有一个接口类型的端点, 或者,

如果我在这里输入dynamodb,

它是一个网关类型的端点｡

因此, 如果我们采用端点的接口类型, 我将只采用我看到的第一个｡

我需要做的是选择一个将在其中部署此端点的VPC｡

然后, 我们需要确保DNS名称已启用, 为此,

我们需要修改一些有关DNS的VPC设置,

但我们以前已经这样做了｡

然后, 我们指定将在哪个AZ中部署此端点,

部署此接口端点｡

因此, 您可以说在这两个子网中,

因为我们没有使用第三个子网,

因为我们没有为最后一个AZ创建子网｡

但无论如何, 您选择所需的端点,

选择与之关联的子网ID,

例如, 它将位于IPv4的私有子网A中,

然后是私有子网B｡

然后选择一个安全组连接到此端点,

这将定义如何从其他类型的实例访问此端点的安全性,

好吗？

因此, 另一个选择是创建网关终结点,

而不是创建接口终结点｡

为此, 我们将使用Amazon S3｡ 

正如我们所看到的, 我们有不同种类的端点,

我们有网关和接口, 但在本示例中, 最常见的是Amazon

S3的网关端点｡

在这种情况下, 我们必须选择一个VPC,

演示VPC, 我们必须选择然后更新路由表｡

因此, 我们将更新专用路由表,

以便在此路由表中的专用子网内发出的任何请求都将被路由到此网关端点｡

因此, 我们将对此网关端点使用完全访问权限,

然后单击“创建端点”｡

因此, 端点已经创建, 如果您查看路由表,

我们可以看到它与我的专用路由表关联｡

因此, 我们可以通过进入路由表来验证这一点,

在我的专用路由表中, 查看路由,

然后编辑它们｡

正如我们所看到的, 这里有一条直接添加的路由,

这意味着一些流量将直接进入我的VPC端点｡

我们可以开始了, 但我们不能删除它,

因为它实际上链接到端点本身｡

现在这一切都完成了,

让我们来看看我们的堡垒实例, 看看它是否正常工作｡

所以如果我做curl, 现在它不工作了,

我被断开了, 所以让我们回到它,

通过堡垒主机｡

然后我们再次使用SSH, 因此我们使用演示密钥对,

然后我们添加私有实例的IP, 就在这里｡

好吧, 现在如果你做卷曲谷歌｡  com, 正如我们所看到的,

它仍然不起作用, 因为我们仍然有一条通往互联网的路线｡

如果你做AWS S3 LS, 它也不起作用｡ 

您可能会说, 但我们有一个网关端点,

所以它应该可以工作｡

是的, 实际上这是因为CLI问题｡ 

因此, 您需要做的是, 默认情况下,

CLI的区域将是美国东部地区, 因此我们需要对其进行编辑,

为此, 我们将使用AWS S3 LS, 然后区域将是欧盟中部地区,

或者您在实际操作时所在的任何区域｡

新闻中心, 正如您现在所看到的,

此流量被重定向到我所在地区的VPC端点, 因此我拥有Amazon

S3上所有桶的列表, 即使我的实例没有Internet访问权限｡

这就是VPC端点的全部功能,

希望大家喜欢, 我们下一堂课再见｡

---
source: 09 - AWS Fundamentals RDS + Aurora + ElastiCache\002 RDS Read Replicas vs Multi AZ_zh.srt
---

Stephane：参加考试对于理解RDS

Read Replicas和Multi

AZ之间的区别以及准确理解这些用例非常重要｡

所以这堂课是专门用来理解读副本和多AZ的｡

让我们从读取副本开始｡ 

读副本顾名思义可以帮助您扩展读操作｡

我们来举个例子｡ 

在这里, 我们有一个应用程序,

我们有一个RDS数据库实例,

我们的应用程序对我们的数据库实例执行读取和写入, 但是我们想扩展读取, 因为主数据库实例不能足够扩展｡

它收到了太多的请求｡ 

我们最多可以创建15个读取复制副本,

它们可以位于同一可用性区域､

跨可用性区域或跨区域｡

所以有三个不同的选择,

记住它们非常重要｡

假设我们有另一个RDS实例Read Replica和另一个RDS实例Read

Replica, 将会发生的情况是, 它们将是主RDS数据库实例和两个Read Replica之间的异步复制｡

异步, 这意味着读取最终是一致的｡

这意味着, 例如,

如果您的应用程序在有机会复制数据之前从读取副本中读取,

则您可能会获得所有数据｡

这就是为什么它被称为最终一致异步复制｡

这些副本, 它们可以很好地读取扩展读取,

但它们也可以提升到自己的数据库｡

所以你可以选择其中一个副本, 然后说,

好的, 我希望它现在是它自己的数据库, 并获得权限｡

所以你把它提升到自己的数据库｡ 

在那之后它就完全脱离了复制机制, 但它仍然存在,

并有自己的生命周期｡

因此, 如果您想使用Read Replicas,

屏幕顶部橙色的主应用程序必须更新连接字符串,

以利用RDS集群中所有Read

Replicas的列表｡

好的, 很好｡ 

让我们来讨论一个经典的使用案例,

让您读取副本｡

因此, 在本例中, 我们有一个生产数据库,

它正在承担正常的负载｡

我们开始吧｡ 

我们的生产数据库正在对我们的主RDS数据库实例进行读写操作｡

新团队进来说,

我们想在你的数据上运行一些报告和分析｡

因此, 如果您将该报告应用程序插入到主RDS数据库实例中,

那么它将使其过载, 并可能降低生产应用程序的速度,

这是您不希望看到的｡

因此, 作为解决方案架构师, 您要做的是创建一个Read

Replica来运行新的工作负载｡

因此, 您创建了一个读取复制副本｡ 

在主RDS DB数据库实例和读副本之间存在一些异步复制,

然后您的报告应用程序可以从读副本中读取并在那里运行分析｡

在这种情况下, 生产应用程序完全不受影响,

这是完美的｡

所以请记住, 如果你有一个读副本,

你需要确保它只用于SELECT类型的语句,

SELECT是一个SQL关键字｡

SELECT表示读取｡ 

因此, 您不能使用关键字, 如INSERT,

UPDATE或DELETE, 这会改变数据库本身｡

好的, 读取副本仅用于读取｡ 

那么, 让我们来谈谈与RDS读取复制副本相关的网络成本｡

因此, 在AWS中, 您应该知道, 当数据从一个可用性区域转移到另一个可用性区域时,

通常会有成本, 但也有例外, 这些例外通常用于托管服务｡

因此, 对于RDS读取复制副本, 这是一项托管服务｡ 

如果您的读取副本在同一区域内, 好吗？

不同的地区, 但相同的地区, 你不支付这笔费用｡ 

这意味着, 如果您在us-east-1a中有一个RDS

DB实例, 然后在us-east-1b中有一个读副本,

并且存在异步复制, 因为这是一个读副本, 即使流量从一个AZ到不同的AZ,

复制流量也是免费的, 因为RDS是一个托管服务, 他们为您提供免费的流量｡

但是, 如果您使用的是跨区域复制副本,

例如您位于一个区域us-east-1,

而转到另一个区域eu-west-1,

那么您的RDS DB实例和读取复制副本将具有跨区域复制, 这将为您的网络带来复制费用｡

最后, 让我们谈谈RDS Multi AZ,

Multi AZ主要用于灾难恢复｡

因此, 我们有我们的应用程序,

它执行对可用性区域A中的主数据库实例的读取和写入,

我们认为您拥有的是对可用性区域B中的备用实例的同步复制, 它们将同步复制主数据库中的每个更改｡

因此, 这意味着当您的应用程序写入主服务器时,

该更改也需要复制到备用服务器才能被接受｡

所以我们得到的是一个DNS名称｡ 

因此, 您的应用程序与一个DNS名称对话,

如果主服务器出现问题, 将自动故障转移到备用数据库｡

多亏了这个DNS名称｡ 

因此, 我们提高了可用性｡ 

这就是为什么它被称为多AZ, 并且在我们丢失整个AZ或丢失网络或主数据库出现实例或存储故障时,

它们将进行故障切换｡

在这种情况下, 备用数据库显然将成为新的主数据库｡

他不需要在你的应用程序中做任何手动干预,

只要它试图在某个时候自动保持连接到你的数据库,

它会故障转移到将被提升为主服务器的备用服务器,

你会很好, 它不用于扩展｡

因此, 正如您在这里看到的,

备用数据库只是用于备用｡

没有人能读到它｡ 

没有人可以写入它, 它只是在这里作为故障转移, 以防Master数据库发生任何事情｡

因此, 快速的问题是, 是否有可能将读取副本设置为用于灾难恢复的多AZ？

答案是肯定的, 如果需要, 您可以将读取副本设置为多AZ｡

这是一个常见的考试问题, 好吗？

这就是Read Replicates和Multi

AZ的区别, 但是你需要在考试中完全理解这一点, 因为很多问题都会涉及到它｡

因此, 考试中可能会出现的一个问题是,

如何使RDS数据库从单AZ变为多AZ？

所以你应该知道的是,

这是一个零停机操作｡

这意味着您不需要停止数据库以从单AZ转到多AZ｡

您需要做的唯一一件事就是单击数据库的修改并启用多AZ｡

这意味着您的RDS数据库实例将拥有一个主数据库,

拥有一个带有同步复制的备用数据库, 除了修改该设置之外,

您无需做任何事情, 数据库将不会停止｡

这是考试的题目, 但我想告诉你们,

为了让考试顺利进行, 幕后会发生什么.

因此, 以下情况将在内部发生｡ 

RDS将自动为您的主数据库拍摄快照,

并且此快照将恢复到新的备用数据库中,

好吗？

然后, 一旦备份数据库恢复,

将在两个数据库之间建立同步, 因此备份数据库将赶上主RDS数据库,

这样您将处于多AZ设置中｡

这堂课就到这里｡ 

我希望你们喜欢,

我们下节课再见｡

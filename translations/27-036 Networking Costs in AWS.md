---
source: 27 - Networking - VPC\036 Networking Costs in AWS_zh.srt
---

讲师：现在, 我们来讨论AWS每GB的网络成本｡

这是一个简化的版本,

让事情尽可能简单,

并向你解释几个重要的概念｡

现在, 网络成本可能会变得非常复杂, 但这里有一个高层次的概述,

这应该有助于您进入考试｡

我们有一个区域,

我在这个区域中画了两个可用性区域｡

我们假设在第一个AZ中有一个EC2实例｡ 

因此, 您应该知道的第一件事是,

进入EC2实例的任何流量都是免费的｡

因此, EC2上的任何传入流量都是免费的｡ 

现在, 假设我们有第二个EC2实例,

并且它位于同一可用性区域中, 那么在这种情况下, 由于可用性区域表示一组地理位置相互重叠的多个数据中心,

因此假设使用其专用IP进行通信, 则两个EC2实例之间的任何流量都是免费的｡ 通过使用专用IP,

它们将通过它们所连接的网络｡

所以这是伟大的｡  到目前为止一切都是免费的｡ 

但现在, 在另一个AZ中包含一个EC2实例｡ 

这一次, 我们希望您在同一区域内的两个不同AZ上拥有这两个EC2实例,

以便相互通信｡

一种方法是使用公共IP或弹性IP｡

如果我们这样做, 如果使用公共IP或弹性IP,

我们将为每GB支付2美分｡

为什么？

嗯, 因为流量必须通过AWS网络离开, 然后返回,

以便我们的两个实例进行通信, 因此AWS将为此向我们收费｡

相反, 如果我们使用专用IP,

则收费将减少一半, 因为我们现在使用内部AWS网络在这两个可用性区域之间进行链接｡

因此, 这里的要点是, 如果您想让您的实例以更低的价格更快地进行一次通信和两次通信,

则应尽可能多地使用私有IP, 而不是使用公共IP｡

接下来, 让我们考虑具有另一个可用性区域的另一个区域｡

在这种情况下, 从一个区域到另一个区域的流量将为$0｡

02上的千兆字节｡ 

所以这意味着整个地区的交通可能是相当昂贵的｡

那么, 我们从这张非常简化的幻灯片中得到了什么？

第一件事是, 如果你想节省成本,

获得更好的网络性能,

你应该使用私有IP而不是公共IP, 因为你会自动进入私有网络｡

因此, 一个原因是不使用公共IP在AZ中的同一区域中的两个实例之间进行通信｡

第二件事是, 如果您有一个执行一些计算的集群,

并且确实需要在EC2实例之间进行大量通信,

那么您可能希望使用相同的可用性区域以实现最大程度的节省, 明白吗？

显然, 这些成本节约是有代价的,

代价是您不再具有高可用性｡

这意味着, 如果你的AZ下降,

那么你没有任何可用的下跌｡

因此, 您必须在高可用性和成本之间取得平衡｡

根据您在考试中将要回答的问题, 您必须选择正确的天平｡

典型的例子是, 我们有一个RDS数据库,

我们希望您创建一个读取副本,

并在此读取副本上执行一些分析｡

我们如何以最低的成本创建读取副本？

如果您在同一个AZ中创建读取复制副本,

那么就网络成本而言, 将一个数据库复制到另一个数据库将不会向您收取任何费用｡

但是, 如果您在另一个AZ中创建该读取副本,

那么您将为两个数据库之间的每GB数据传输支付1美分｡

现在, 我们来讨论一下如何通过做出一些明智的架构决策来优化网络成本｡

因此, 出口流量是出站流量｡ 

这意味着从AWS到外部｡ 

入站流量是入站流量｡ 

这意味着从外部到AWS通常是免费的｡

因此, 向AWS发送数据通常是免费的,

但在AWS之外获取数据, 则需要付费｡

因此, 您的目标将是尽量在AWS内保持尽可能多的互联网流量,

以最大限度地降低成本｡

假设我们有一个数据库,

公司数据中心有一个用户, 我们在公司数据中心运行一个应用程序｡

该应用程序正在对数据库执行查询,

并从数据库检索100 MB的数据｡

然后, 它将进行一些聚合､ 一些计算,

最后, 返回查询结果,

仅向用户提供50 KB｡

在这种情况下,

出口流量将非常非常高｡

与此相关的成本也将非常高｡

因为我们从AWS获取了100兆字节的数据,

并将其放入我们的企业数据中心, 可能是通过互联网,

对吗？

但如果我们做出明智的选择,

我们可以将应用程序直接移动到EC2实例上的AWS云中｡

在这种情况下, 如果我们非常聪明,

并且将数据保持在同一可用性区域内,

那么DB查询数据传输将是免费的｡

因此, 100兆字节将不会建立在所有帐户｡ 

然后查询结果本身只有50千字节将发送给我们这将是一个便宜得多的成本

在这种情况下, 出口成本最小化｡ 

要最大限度地降低出口流量网络成本,

您需要了解的另一件事是, 如果您使用Direct Connect,

则需要选择位于同一AWS区域的Direct Connect位置, 以降低出口网络成本｡

好吧, 我会的 S3数据传输定价如何？

我们来分析一下美国的情况｡ 

因此, 我们有一个S3存储桶,

进入S3存储桶的任何数据都将是免费的,

因为这是入口流量｡

但是如果我们通过互联网从亚马逊S3下载数据到我们的电脑上,

那么我们将支付每千兆字节9美分的出口流量成本｡

这是在这里表示的｡ 

如果我们想使用S3传输加速来获得更快的传输时间,

从50%提高到500%, 那么我们将在数据传输定价的基础上获得额外的成本, 这将是每GB 4美分到8美分之间的任何地方｡

因此, 使用传输加速是有代价的｡ 

现在, S3到CloudFront将是免费流量｡ 

因此, 如果您在S3桶上设置了CloudFront分发,

则S3和CloudFront之间发生的任何数据传输都是免费的｡

但是从CloudFront到互联网要花你8美元｡

50美分每千兆字节,

比亚马逊S3略便宜｡

在此基础上, 您将获得缓存功能｡ 

因此, 无论何时发出请求,

数据访问的延迟都将降低, 成本也将降低｡

因此, 当有人向您的S3 bucket发出请求时,

您将为该请求付费, 但向Amazon

CloudFront发出请求要便宜得多｡

它便宜七倍｡ 

因此, 在Amazon S3存储桶上使用CloudFront可以节省大量资金（如果这符合您的用例）｡

最后, 如果您为Amazon S3存储桶执行跨区域复制,

那么您将为它支付每GB

2美分的费用, 明白吗？

因此, 数字可能会随着时间的推移而变化,

这是针对美国的数字, 也可能针对您所在的地区而变化, 但您需要记住的是,

使用某些服务会产生额外成本, 了解这些成本之间的关系对您来说非常重要｡

另一个成本分析是使用NAT网关与网关VPC端点｡

因此, 我们在该区域中有一个VPC, 并且有两个私有子网,

其中包含两种不同类型的EC2实例｡

他们都希望将数据访问到Amazon S3存储桶中｡ 

因此, 一种方法是使用公共互联网, 为此,

我们设置了一个公共子网, 该子网具有NAT网关｡

要使子网成为公共子网, 我们需要有一个到Internet网关的路由｡

我们将使用路由表建立一条路由｡

然后, 我们可以通过NAT网关和Internet网关从EC2实例直接连接到Internet｡

然后从互联网访问Amazon

S3存储桶中的数据｡

因此, 与此相关的成本为0美元｡  045美元, NAT网关为0美元｡

通过NAT网关处理的数据每GB需要045美元,

然后是0美元｡ 跨地区向外传输到S3的数据为每小时$09,

如果是同一地区, 则为$0, 明白吗？

但是, 如果我们要设置一个VPC端点, 好的, 以访问我们的数据到我们的Amazon

S3桶私人, 然后我们设置一个不同的路由表｡

因此, 在本例中, 要访问VPC端点, 我们只需设置一个到它的路由｡

因此, 数据直接从专用子网流入VPC端点和S3存储桶｡

我们使用网关端点没有任何成本,

我们为同一地区的S3桶传输的每GB数据支付1美分｡

因此, 使用VPC端点而不是NAT网关可以显著降低成本｡

这也是考试可以测试你的东西｡ 

我希望你们喜欢这节课,

下节课再见.

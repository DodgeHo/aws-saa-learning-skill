---
source: 27 - Networking - VPC\012 NAT Instances_zh.srt
---

教师：现在我们来讨论一下NAT实例,

这些实例肯定已经过时了｡

在下一讲中有一个更好的解决方案叫做NAT网关,

但它们仍然会出现在考试中｡

所以我们去看看他们吧｡ 

因此, NAT意味着网络地址转换, 这些NAT实例允许私有子网中的EC2实例连接到Internet｡

为此, NAT实例必须在公共子网中启动,

然后将连接公共子网和专用子网｡

我们还必须禁用一个设置, 我们将在实践练习中看到这个设置,

称为源/目标检查, 我现在就向您展示为什么要禁用它｡

此外, 您的NAT实例必须有一个固定的弹性IP连接到它｡

让我们来看看｡ 

我们有一个服务器, 它是一个公共服务器,

有一个公共IP, 50｡ 60. 4. 10, 我们想从我们的私有子网访问它,

好吧｡

那么, 我们如何建立从专用子网到服务器的连接呢？

为此, 我们将在公共子网中启动一个具有自己的安全组的NAT实例,

然后将一个弹性IP附加到此NAT实例, 然后编辑从专用子网到公共子网的路由表,

以便允许从两个子网之间的EC2实例向NAT实例发送流量｡

因此, 实例中的IP需要访问服务器（公共服务器）,

但它必须通过NAT实例｡

因此, 请求看到源IP为10｡  0. 0. 20, 这是真的, 这是一个私有IP,

目的地是50｡

60. 4. 10

NAT实例足够智能地说, 嘿,

我知道你正试图将流量发送到其他服务器,

所以让我将流量发送到该服务器｡

但那台服务器有些不同｡ 

因此, 目的地仍然是这个IP, 但现在源IP是12｡

34. 56. 78,

对应于NAT实例的公有IP｡

如您所见, 此网络数据包被NAT实例重写,

这就是NAT所做的, 它们重写网络数据包,

并且源IP已更改｡

服务器现在会说, 嘿, 我知道如何回复你,

因为源是我, 目的是你的NAT实例的公共IP, 然后NAT实例会将流量回复给EC2实例, 它足够智能,

知道该去哪一个, 然后说, 嘿, 源是公共服务器,

目的是你的私有IP｡

这就是为什么必须在NAT实例的EC2实例上禁用源和目标检查的原因,

因为有些IP正在被重写｡

这就是NAT实例在高层次上的工作方式｡ 

同样, 我们将在公共子网中创建NAT实例,

然后将弹性IP附加到该实例, 然后我们将创建一个路由表,

该表允许私有实例与NAT实例通信, 一直到Internet网关, 依此类推｡

下面是关于NAT实例的一些说明｡ 

因此, 我们有一个预配置的Amazon Linux

AMI可供我们使用, 虽然它在那里可用, 但它的标准支持已于2020年12月31日结束｡

因此, 现在建议使用NAT网关,

而NAT实例的可用性不高｡

它们在开箱即用的设置中没有弹性,

因此我们需要创建多个1和多个AZ, 可能还需要一个ASG,

一个弹性用户数据脚本｡

这很复杂｡ 

如果您选择较小的实例,

则获得的带宽将比较大的实例少｡

您还必须管理实例上的安全组和规则｡

因此, 入站时, 您必须允许来自专用子网的任何HTTP

HTTPS流量, 可能允许来自家庭网络的SSH流量,

出站时, 您还需要允许一些出站流量｡

NAT实例可以正常工作｡ 

这是很好的了解NAT如何在高层次上工作, 这就是这节课要讲的｡

我们将在下一节课中设置NAT实例, 但请记住,

它们将消失, 考试将要求您在我们刚才看到的NAT实例和我们将在下一节课中看到的NAT网关之间进行选择｡

所以我们下节课再见｡

---
source: 19 - Serverless Overviews from a Solution Architect Perspective\013 API Gateway Overview_zh.srt
---

教师：到目前为止, 在我们的无服务器之旅中,

我们已经看到了如何创建Lambda函数,

以及如何使用DynamoDB｡

函数可以使用DynamoDB作为API的数据库,

我们可以创建, 读取, 更新, 删除我们的表, 但是我们希望客户端能够以某种方式调用Lambda函数｡

所以有多重的做这件事｡ 

我们可以让客户端直接调用Lambda函数,

但这意味着客户端需要IAM权限, 或者我们可以使用应用程序负载平衡器将其置于客户端和Lambda函数之间,

这将把Lambda函数公开为HTTP端点｡

我们还有最后一件事可以利用｡ 

它被称为API网关｡ 

这是AWS提供的无服务器产品, 允许我们创建REST

API, 这些API将是公共的, 可供我们的客户访问｡

因此, 客户端将与API网关进行通信,

API网关将把请求代理给我们的Lambda函数｡

因此, 它将使用API网关,

因为它提供的不仅仅是HTTP端点｡

它将为我们提供许多功能,

如身份验证､ 使用计划､ 开发阶段等｡

因此, API Gateway具有许多功能, 这只是一个概述,

但我们可以集成API Gateway和Lambda,

这将为我们提供一个完整的无服务器应用程序｡

因此无需管理基础架构｡ 

我们支持WebSocket协议,

因此我们可以通过API网关以两种不同的方式进行实时流传输｡

API网关处理API版本控制｡ 

所以我们可以从第一个版本到第二个版本和第三个版本,

而不会破坏我们的客户端｡

我们可以处理多个环境,

包括开发､ 测试和生产环境｡

有一个完整的事情关于API网关和安全｡ 

因此, 有很多方法可以在API网关上为身份验证和授权启用安全性｡

我们能够创建API密钥, 在某些客户端在我们的API网关上执行过多请求的情况下执行请求限制,

并且我们还可以使用一些常见标准, 如Swagger或Open API 3｡

0导入快速定义的API,

也可以将其导出为Swagger和Open

API｡

我们可以在API网关级别转换和验证请求和响应,

以确保调用正确, 我们可以生成SDK和API规范, 并缓存API响应｡

因此, 当您使用像应用程序负载平衡器这样简单的东西时,

API网关附带的许多功能并不一定包括在内｡

那么, API网关与什么集成？

有一个Lambda函数,

我们在上图中看到过, 所以它可以调用Lambda函数.

通过这种集成, 这是公开REST（一种由Lambda函数支持的API）的最常见和最简单的方式,

以实现完整的无服务器应用程序｡

但也HTTP｡ 

因此, 我们可以在后端公开任何HTTP端点｡ 

例如, 它可以是您内部部署的HTTP

API, 也可以是您云环境中的应用负载平衡器｡

你为什么要这么做？

您可以使用API网关来利用速率限制功能､

缓存､ 用户身份验证､ API密钥等｡

因此, 在HTTP端点上使用一层API网关肯定是充分的｡

最后, 我们可以使用证据服务, 这样我们就可以通过API网关公开任何AWS

API｡

例如, 在哪些应用程序中,

我们可以启动步骤功能工作流,

我们可以直接从API网关API向SQS发布消息｡

你为什么要这么做？

因为您可能希望添加身份验证､

公开部署一些API或对一些AWS服务进行一些速率控制｡

下面是一个与AWS服务一起使用的API网关示例｡

举个例子, Kinesis数据流｡ 

因此, 我们希望人们以安全的方式将数据发送到Kinesis数据流中,

而不授予他们访问AWS凭据的权限｡

因此, 我们要做的是在客户端和Kinesis数据流之间,

我们将使用API网关｡

客户端将HTTP请求发送到API网关｡

它被配置为将信息发送到Kinesis数据流中｡

正如您在此设置中看到的, 我们不管理任何服务器｡ 

然后是Kinesis数据流,

例如, 我们可以将记录发送到Kinesis Data

Firehose中, 并最终以JSON格式将其放入Amazon

S3桶中｡

因此, 您开始看到API Gateway的强大功能｡ 

实际上, 您可以通过API网关向外部公开任何AWS服务｡

有三种方法可以部署您的API网关｡ 

这称为端点类型｡ 

因此, 第一种类型（默认类型）称为“边缘优化”｡

这是为您的全球客户准备的｡ 

因此, 这意味着您的API网关将可以从世界上的任何地方访问｡

为了提高效率, 请求将通过所有CloudFront

Edge位置进行路由, 这将改善延迟｡

您的API网关仍然只位于您创建它的一个区域,

但可从每个CloudFormation Edge位置高效访问它｡

然后是区域部署｡ 

因此, 这是我们不想使用CloudFront

Edge位置的时候｡

因此, 我们希望所有用户都在我们创建API网关的同一区域内｡

如果您愿意,

您可以创建自己的平台分发, 这将为您提供与边缘优化分发相同的结果, 但这一次您可以更好地控制位置策略和平台设置本身｡

最后, 您可以使用的最后一种API网关是私有API网关｡

所以这次不公开｡ 

因此, 只能从VPC内部访问私有API网关｡

它将使用ENI的接口VPC端点｡ 

要定义对API网关的访问,

您可以使用资源策略｡

现在, 我们来谈谈API网关的安全性｡

因此, 您可以通过多种方式在API网关上识别用户｡

第一种方法是通过IAM角色｡ 

因此, 如果您有内部应用程序（例如, 运行在EC2实例上的应用程序）,

并且它们希望访问API网关上的API,

这将非常有用, 它们可以只使用IAM角色｡

如果你想拥有外部用户, 例如,

移动应用程序或Web应用程序, 那么你会使用一种叫做Amazon

Cognito的东西｡

或者, 如果您希望实现自己的逻辑,

则可以使用自定义授权器来实现｡

这是一个Lambda函数｡ 

此外, 您还可以通过与AWS证书管理器或ACM服务集成,

通过自己的自定义域名获得HTTPS安全性｡

因此, 如果您使用的是边缘优化端点,

则该证书必须位于us-east-1, 但如果您使用的是区域端点, 则该证书可能与API网关阶段位于同一区域｡

最后, 当然, 您必须在Route

53中设置一个CNAME或A别名记录,

以指向您的域和API网关｡

这节课就讲到这里｡ 

希望你喜欢｡ 

我们下节课再见｡

---
source: 08 - High Availability and Scalability ELB & ASG\016 Auto Scaling Groups Hands On_zh.srt
---

# ASG 实操

## 学习目标
- 创建启动模板与 ASG
- 关联 ALB 与健康检查
- 观察 ASG 活动与实例创建

## 重点速览
- ASG 依赖启动模板
- 可绑定 ALB 目标组
- Activity 记录扩缩容事件

## 详细内容
创建启动模板：
1. 选择 Amazon Linux 2（免费层 AMI）。
2. 实例类型 `t2.micro`。
3. 选择安全组并填写用户数据（启动 Web 服务）。

创建 ASG：
1. 命名如 `DemoASG`，选择刚创建的启动模板。
2. 选择 VPC 与多个子网（多 AZ）。
3. 可选择绑定 ALB 目标组。
4. 健康检查可选 **EC2** 或 **ELB**（推荐启用 ELB）。
5. 设置容量：`Min=1, Desired=1, Max=1`（可后续调整）。

验证：
- 在 **Activity history** 中查看 “Launching a new instance”。
- 在 **Instance management** 中确认实例已创建。

## 自测问题
- 为什么 ASG 必须依赖启动模板？
- ELB 健康检查对 ASG 有什么作用？

所以这很酷｡ 

现在很酷的事情是,

因为我们已经将ASG设置为链接到目标组, 所以如果我们转到左侧的目标组, 找到我的第一个目标组,

然后转到目标, 我的EC2实例正在被注册, 我将扩展它, 我的EC2实例正在被注册到我的ALB中｡

所以现在它显示为不健康,

因为对象失败, 因为EC2实例仍然在引导｡

但如果过了一段时间, 它会被显示为健康,

然后将被注册到我的ALB｡

所以让我暂停视频等待｡ 

好了, 我的实例现在是健康的, 然后如果我去我的ALB并刷新,

我会得到Hello World响应, 这意味着一切都在运行, 实例是由ESG创建的｡

我们可以在EC2控制台中看到它,

它被注册到链接到我们的负载均衡器的目标组中,

因此我们的负载均衡器完全工作｡

现在, 如果实例永远不会变得健康,

它就会变得不健康,

那么因为我们设置了ASG来终止不健康的实例, 您将看到的是实例将被终止,

并将创建一个新的实例｡

因此, 您将主要在活动历史中看到这一点｡

如果您确实有这个问题,

那么发生这种情况的原因是您的EC2实例配置错误｡

这可能是安全组问题, 也可能是EC2用户数据脚本问题｡

所以请在Q&A中提问之前检查这些｡

好吧, 但这些是你应该犯的错误｡

所以现在我们有一个EC2实例, 它正在服务中｡

我们可以做的是,

我们可以通过编辑Auto Scaling组大小来体验缩放｡

所以我们需要两个实例, 所以我们也必须增加最大容量｡

所以我们会更新这个｡ 

现在我们告诉ASG的是,

我们希望您为我们创建一个或多个EC2实例｡

因此, 如果您转到Activity历史记录,

然后刷新它, 很快就会显示一个新的Activity, 它将尝试启动EC2实例｡

现在, 它显示Launching

a new EC2 instance,

因为您已经将期望容量从1更改为2, 而我们的ASG中的实际实例数只有1｡

现在, 正如您所看到的,

我们创建了第二个EC2实例, 过一段时间,

它将被注册到我们的目标组中并添加｡

所以我会暂停视频让这个过程发生｡

好了, 我的实例现在是健康的｡ 

所以如果我去我的ALB并刷新,

正如我们所看到的, 我得到了两个IP, 它们循环通过我的ALB｡

一切都很顺利｡ 

最后一件事, 如果我们转到活动,

我们可以看到这两个实例已成功启动｡

现在让我们反过来,

我们将通过将Desired capacity恢复为1来缩减容量, 并更新它, 它会说, “嘿,

看起来你有两个实例, 但现在你只需要一个, 所以我要在这里选择这两个实例中的一个并终止它们｡

因此,

正如您在这里看到的,

它说, “由于ASG的配置更改,

我正在终止其中一个实例”, 并将终止该实例, 然后将其从目标组中注销｡

然后我们将返回到ASG中只有一个EC2实例｡

这就是这节课的内容,

你们已经看到了ASG的全部力量,

我们下节课会讲到自动缩放｡

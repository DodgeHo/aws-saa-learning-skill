---
source: 08 - High Availability and Scalability ELB & ASG\016 Auto Scaling Groups Hands On_zh.srt
---

教师：好的, 让我们练习使用Auto

Scaling组｡

要做到这一点,

首先, 请确保您的实例并终止它们,

以便在EC2中运行零个实例｡

接下来, 我们需要创建一个Auto

Scaling组｡

让我们进入左手边的Auto Scaling组,

我们将创建第一个Auto Scaling组｡

因此, 创建Auto Scaling组,

让我们将Auto Scaling组命名为DemoASG,

我们需要引用启动模板, 所以我现在要创建一个启动模板｡

所以当你创建一个启动模板时,

你需要给它一个名字, 我会给它一个MyDemoTemplate,

以及一个描述, Template｡

好的, 我们将向下滚动并指定不同的选项｡

对于我将要使用的Amazon机器映像, 我将进入快速入门,

Amazon Linux,

我会选择Amazon

Linux 2, 版本为x86｡

好的, 我们将使用符合免费等级条件的AMI,

这很好｡

接下来, 对于实例类型,

我将选择t2｡ 微因为它是免费层合格,

所以任何免费层合格是好的｡

我将根据Key对向下滚动,

我将包括EC2实例, 因此这基本上定义了我的启动模板中的EC2实例以及ASG中的EC2实例应该如何启动｡

好的, 这些选项与您在单独启动EC2实例时看到的选项非常相似｡

对于安装, 您不将其包含在启动模板中｡

对于防火墙安全组,

您可以选择一个现有的安全组,

例如launch-wizard-1｡

你有8GB的GP2卷,

这是好的｡

然后对于高级详细信息, 我将一直向下滚动,

我将找到我的用户数据, 对于用户数据, 我将输入我们之前使用的用户数据, 因此所有这些,

这将允许在每个EC2实例上创建Web服务器作为ASG的一部分｡

我们可以开始了,

让我们创建这个启动模板, 它已经创建好了,

称为MyDemoTemplate｡

我要刷新它并在这里选择它｡

所以我们有MyDemoTemplate版本1｡ 

我们有它的摘要,

我们点击下一步继续｡

因此, 我们选择实例启动选项,

我们有一个VPC,

这是默认的VPC,

以及启动到三个不同的VPC的能力, 所以eu-west-1a,

1b和1c｡

实例要求｡ 

所以我们有那些提供的模板, 这是一个t2｡

但如果我们想的话,

我们可以覆盖它们, 好吗

当您覆盖它们时,

您可以指定即时属性或手动添加实例类型｡

您可以混合使用随需应变实例和现场实例,

以及不同实例类型的混合｡

所以这肯定是更高级的,

但现在我们将它作为Launch模板中的实例类型要求,

因此我们将其作为t2｡

只有micro

让我们点击Next｡ 

然后我们可以配置高级选项,

因此负载均衡是可选的,

因此我们可以在没有负载均衡器的情况下创建ASG,

并且有一些用例, 好吗？

但是我们已经有了一个负载均衡器, 所以我们要附加到一个现有的负载均衡器,

它将从我的DemoALB应用程序均衡器中选择我的第一个目标组｡

这样作为ASG的一部分启动的EC2实例就可以直接链接到我的应用程序负载均衡器｡

对于健康检查, 这是可选的,

但我们有两种健康检查, 第一种是EC2健康检查｡

因此, 如果我的EC2实例发生故障,

它将自动从我的Auto Scaling组中删除, 我们还可以启用ELB类型的健康检查,

并将其保持启用状态｡

因此, 如果ELB认为实例不健康,

那么ASG将自动终止它｡

好的, 我们不会启用任何其他设置｡ 

点击下一步｡ 

这就是你设置ASG组大小的地方｡ 

所以Desired capacity是1最小容量是1,

最大容量是1, 这意味着我们在ASG中有一个实例,

但是如果我们可以指定10作为最大容量,

这将允许我们在1和10之间拥有不同大小的ASG容量｡

但我现在会把所有的都保持为1｡ 

现在我将它保持为无, 但我们稍后将详细介绍它们｡

让我们点击Next｡ 

没有通知, 没有标签,

我们审查一切,

然后我们点击创建Auto

Scaling组｡

好了, 我的Auto Scaling Group已经创建,

接下来要做的就是为我创建一个EC2实例｡

所以这里的想法是, 如果我点击我的自动侦察组,

我们得到一些细节,

我们可以看到所需的最小和最大容量,

以及用于此ASG的启动模板｡

然后如果我进入活动, 这就是有趣的事情发生的地方｡

所以当ASG决定创建一个EC2实例时,

它会出现在Activity通知中,

所以如果我刷新它, 很快, 对不起, 在Activity历史记录中｡

因此, 如果我刷新Activity历史记录,

那么我可以看到这里有一个Launching a new instance,

因为Auto Scaling组的容量为0, 而我们想要1个容量, 所以它只是增加ASG中的EC2实例数量, 以匹配所需的容量｡

因此, 如果我转到选项卡Instance

Management,

正如我们所看到的, ASG创建了一个EC2实例｡

因此, 如果我们转到此处的“运行”选项卡,

我们可以看到EC2实例当前正在运行并正在初始化｡

所以这很酷｡ 

现在很酷的事情是,

因为我们已经将ASG设置为链接到目标组, 所以如果我们转到左侧的目标组, 找到我的第一个目标组,

然后转到目标, 我的EC2实例正在被注册, 我将扩展它, 我的EC2实例正在被注册到我的ALB中｡

所以现在它显示为不健康,

因为对象失败, 因为EC2实例仍然在引导｡

但如果过了一段时间, 它会被显示为健康,

然后将被注册到我的ALB｡

所以让我暂停视频等待｡ 

好了, 我的实例现在是健康的, 然后如果我去我的ALB并刷新,

我会得到Hello World响应, 这意味着一切都在运行, 实例是由ESG创建的｡

我们可以在EC2控制台中看到它,

它被注册到链接到我们的负载均衡器的目标组中,

因此我们的负载均衡器完全工作｡

现在, 如果实例永远不会变得健康,

它就会变得不健康,

那么因为我们设置了ASG来终止不健康的实例, 您将看到的是实例将被终止,

并将创建一个新的实例｡

因此, 您将主要在活动历史中看到这一点｡

如果您确实有这个问题,

那么发生这种情况的原因是您的EC2实例配置错误｡

这可能是安全组问题, 也可能是EC2用户数据脚本问题｡

所以请在Q&A中提问之前检查这些｡

好吧, 但这些是你应该犯的错误｡

所以现在我们有一个EC2实例, 它正在服务中｡

我们可以做的是,

我们可以通过编辑Auto Scaling组大小来体验缩放｡

所以我们需要两个实例, 所以我们也必须增加最大容量｡

所以我们会更新这个｡ 

现在我们告诉ASG的是,

我们希望您为我们创建一个或多个EC2实例｡

因此, 如果您转到Activity历史记录,

然后刷新它, 很快就会显示一个新的Activity, 它将尝试启动EC2实例｡

现在, 它显示Launching

a new EC2 instance,

因为您已经将期望容量从1更改为2, 而我们的ASG中的实际实例数只有1｡

现在, 正如您所看到的,

我们创建了第二个EC2实例, 过一段时间,

它将被注册到我们的目标组中并添加｡

所以我会暂停视频让这个过程发生｡

好了, 我的实例现在是健康的｡ 

所以如果我去我的ALB并刷新,

正如我们所看到的, 我得到了两个IP, 它们循环通过我的ALB｡

一切都很顺利｡ 

最后一件事, 如果我们转到活动,

我们可以看到这两个实例已成功启动｡

现在让我们反过来,

我们将通过将Desired capacity恢复为1来缩减容量, 并更新它, 它会说, “嘿,

看起来你有两个实例, 但现在你只需要一个, 所以我要在这里选择这两个实例中的一个并终止它们｡

因此,

正如您在这里看到的,

它说, “由于ASG的配置更改,

我正在终止其中一个实例”, 并将终止该实例, 然后将其从目标组中注销｡

然后我们将返回到ASG中只有一个EC2实例｡

这就是这节课的内容,

你们已经看到了ASG的全部力量,

我们下节课会讲到自动缩放｡

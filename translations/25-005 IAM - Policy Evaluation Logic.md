---
source: 25 - Identity and Access Management (IAM) - Advanced\005 IAM - Policy Evaluation Logic_zh.srt
---

教师：让我们进入IAM权限界限｡ 

因此, 用户和角色支持这些权限边界,

而组不支持这些权限边界,

因此请记住这一点｡

它们是一种高级功能,

允许您定义IAM实体可以获得的最大权限｡

让我们举个例子｡ 

我们有这个IAM权限界限｡ 

它看起来就像一个IAM策略｡ 

所以我们说, 允许S3 CloudWatch和EC2上的所有内容｡ 

例如, 我们将它附加到IAM用户, 这就是它的权限边界｡

这意味着它只能在S3 CloudWatch和EC2中执行操作｡

然后, 您需要通过策略在最上面指定IAM权限｡

这里, 假设我们连接到同一个用户, 允许iam：CreateUser,

resource *｡

因此, 存在一个边界,

并且存在一个具有权限的IAM策略｡

在这种情况下, 结果权限是什么？

嗯, 没有, 没有权限,

因为IAM策略在IAM权限边界之外｡

因此, 不允许我们的用户创建其他IAM用户,

因为这不在其IAM权限范围内｡

因此, 我想向您展示IAM权限边界的创建位置｡

现在, 让我们创建一个用户｡ 

我将调用用户John,

然后授予他编程访问权限｡

下一个权限｡ 

我不会设置任何东西,

和下一个标签｡

复查和创建用户｡ 

我们已经创建了John,

并将为John设置权限边界｡

假设John是我们公司的一名开发人员,

他需要具有某些权限, 但我们希望确保他具有权限边界｡

为此, 我们可以为John分配一个策略, 如果我添加权限,

然后说：“嘿, John,

我将连接到您的AdministratorAccess｡

“看起来约翰现在什么都能做｡

所以John是超级用户｡ 

但我也要为John设置权限边界｡ 

我会说, 好吧, 这是你的边界,

这是一个高级功能｡

我要说的是, 你唯一能做的, 实际上,

约翰, 就是拥有亚马逊S3FullAccess｡

在这里, 我为John设置了一个权限边界｡

因此, 通过此AWS S3完全访问管理策略, 即使John具有管理员访问权限,

当John登录时, 他唯一能做的就是访问S3,

因为S3是其边界｡

我们可以看到,

尽管有一个附加到John的策略为他提供了管理员访问权限,

但边界实际上会更加严格｡

因此, IAM权限边界可用于AWS组织SCP的组合｡

请看这张图, 我们拥有有效权限,

可以处于基于身份的策略的中间,

因此, 无论附加到您的用户或组的是什么｡

权限边界, 顺便提一下,

它只适用于用户或角色, 而不适用于组｡

以及您的组织SCP, 它适用于您帐户中的每个IAM实体｡

因此, 在中间是用户可以做什么｡ 

因此, 我们可以在一些用例中使用权限边界｡ 

例如, 在非管理员的权限范围内将责任委派给非管理员,

例如创建新的IAM用户｡

或者允许开发人员自行分配和管理自己的权限,

同时确保他们不能提升自己的权限,

这意味着让自己成为管理员｡

例如, 限制组织内的一个特定用户,

而不是将整个SCP应用于您的帐户并限制整个帐户中的每个人｡

现在, 让我们看一下IAM策略评估逻辑｡ 

因为此图基本上向您解释了您是如何被授权或未被授权在AWS中执行操作的｡

你不需要记住,

但你应该明白｡

我们可以看到, 这是一个完整的流程,

但在每一步, 都有一个评估｡

因此, 我们将了解“拒绝”评估､

“组织”SCP､ 基于资源的策略､

基于身份的策略､ IAM权限边界,

最后是允许或拒绝特定IAM操作的会话策略｡

让我们来详细了解一下这是如何工作的｡ 

我们来看看这里所有可能的策略｡ 

如果有一个显式的拒绝,

那么我们知道它会被自动拒绝｡

然后我们看看组织的SCP,

是否允许？

如果是, 则进入下一步｡ 

如果不是, 那么它就是一个否定, 因为它是一个隐式的否定｡ 

然后, 我们来看一下基于资源的策略,

例如, 可以应用于S3存储桶的策略｡

它们可以应用于SQS等｡ 

再一次, 我们来看看,

有没有资源型政策？

如果是, 是否允许？

是还是不是？

然后是基于身份的策略｡ 

因此, 我们再次查看是否存在基于身份的策略,

是否存在允许, 然后我们隐式拒绝或进入下一步｡

然后, 我们看看刚才看到的IAM权限边界｡ 

最后, 我们来看一下不会超过它们的会话策略,

这与SDS更相关｡

但我希望您记住的是,

所有这些都是在进行特定IAM操作时进行评估的｡

因此, 只有当所有这些因素都允许并一起工作,

或者不具体地拒绝, 那么你将有一个最终的决定允许, 你将能够做你的行动｡

这只是为了让您更好地了解安全性在AWS中的工作原理｡

所以, 让我们来看看这个政策,

看看它可以做些什么, 使它更具体一点｡

因此, 我们对资源 * 执行了sqs：*, Deny, 对资源

* 执行了操作sqs：DeleteQueue, Allow｡

所以第一个问题是, 你能执行sqs：CreateQueue吗？

答案是否定的, 你不能,

因为SQS上有一个Deny星, CreateQueue属于那个块,

它上面有一个deny,

所以它肯定会被拒绝｡

现在, 您可以执行sqs：DeleteQueue了吗？

所以在顶部有一个拒绝,

在底部有一个允许, 它们是冲突的｡

有拒绝和允许｡ 

但我刚才怎么跟你说的？

我告诉过你, 一旦你有一个明确的否认,

那么决定将被拒绝｡

因为sqs：* 上有一个显式拒绝, 并且sqs：DeleteQueue在该sqs：*

内, 所以无论如何, 即使这里有一个允许, 这个操作也会被拒绝.

因此, 您无法执行sqs：DeleteQueue,

即使您已在第二个块中显式地允许它｡

所以知道这一点非常重要｡ 

最后, 您可以执行ec2：DescribeInstances吗？

所以我们可以看到, EC2上什么都没有｡ 

这是IAM的政策｡ 

因此, 因为没有明确的拒绝,

也没有明确的允许, 所以你不能用这个IAM策略执行ec2：DescribeInstances｡

好吧, 希望你说得通｡ 

这节课就讲到这里｡ 

希望您能更好地理解IAM｡ 

我们下节课再见｡

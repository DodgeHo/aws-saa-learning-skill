---
source: 19 - Serverless Overviews from a Solution Architect Perspective\007 Lambda@Edge & CloudFront Functions_zh.srt
---

**学习目标**
- 理解 Lambda@Edge 与 CloudFront Functions 的差异与典型用例
- 能够选择合适的边缘执行方式来实现低延迟请求处理与缓存策略

**重点速览**
- CloudFront Functions：轻量级 JavaScript，在查看器请求/响应阶段运行，启动极快、延迟极低，适合头部改写、缓存键规范化、简单鉴权等场景
- Lambda@Edge：在边缘节点运行的 Lambda（Node.js / Python），功能更强、可访问网络与外部服务，适合复杂逻辑与第三方集成
- 两者均将逻辑下沉到边缘以降低回源延迟，但在性能、运行时与用例上有清晰区别

**详细内容**
边缘函数用于将部分请求或响应处理移到 CloudFront 边缘位置，从而减少往返延迟。典型使用场景包括：缓存键规范化、URL 重写/重定向、响应头操作、A/B 测试、边缘鉴权与 Bot 缓解等。

差异要点：
- 运行时与能力：CloudFront Functions 只支持轻量 JavaScript，执行时间极短（亚毫秒级）；Lambda@Edge 支持 Node.js/Python，允许更长执行时间（数秒）、加载第三方库并访问外部网络或 AWS SDK。
- 性能与规模：CloudFront Functions 面向每秒数百万请求的高 QPS；Lambda@Edge 适用于需要更多计算或集成的场景。
- 部署与传播：边缘部署会将代码分发到多个边缘位置，发布时需注意版本传播延迟与回滚策略。

**自测问题**
- CloudFront Functions 与 Lambda@Edge 在可用运行时与典型用例上有何不同？
- 在边缘实现鉴权或缓存键优化时，如何选择两者？
- 边缘部署有哪些运维或发布时注意点？

我们知道我们在特定区域部署我们的功能和应用程序,

但有时使用CloudFront等工具, 我们会让Edge位置分发我们的内容｡

有时, 现代应用程序需要在到达应用程序本身之前在边缘执行某种形式的逻辑｡

这些被称为边缘函数, 这是你写的一段代码,

你会把它附加到你的CloudFront发行版中｡

这样做的目的是为了在某些情况下最大限度地减少延迟,

您希望在用户附近运行这些函数｡

所以CloudFront有两种函数, 你有CloudFront函数和Lambda@Edge｡

我们的想法是, 能够理解何时需要它们,

以及它们之间的差异, 在这节课中我们会做到这一点｡

但使用边缘功能, 您不必管理任何服务器,

这些边缘功能是全球部署的｡

例如, 它们的使用案例是自定义来自CloudFront的CDN内容｡

此外, 你只支付你所使用的,

它是完全无服务器｡

现在让我们更深入地了解一下这些使用情形｡

第一个是关于网站安全和隐私, 然后我们在边缘有动态Web应用程序,

我们可以进行搜索引擎优化､ SEO, 我们可以进行跨源和数据中心的智能路由､ 边缘的Bot缓解､ 边缘的实时图像转换､ A/B测试､ 用户身份验证和授权､ 用户优先级划分､

用户跟踪和分析, 等等｡

因此, 我们可以使用CloudFront函数和Lambda@Edge进行许多不同的自定义｡

现在, 我们来讨论CloudFront函数的用途及其工作原理｡

这是一个典型的CloudFront请求｡

因此, 客户端将向CloudFront发出请求,

这称为查看器请求, 因为客户端会查看它｡

然后CloudFront会向源服务器发出源请求,

服务器会回复CloudFront,

这样我们就有了源响应,

最后CloudFront会将该响应发送给客户端, 这样我们就有了查看器响应｡

现在CloudFront函数是用JavaScript编写的轻量级函数,

它们修改了查看器请求和响应｡

它们用于大规模､

对延迟敏感的CDN定制, 可为您提供亚毫秒级启动时间和每秒数百万次请求的规模｡

正如我所说的, 它们仅用于更改查看器请求和响应,

因此查看器请求是在CloudFront收到查看器请求之后,

我们可以对此进行修改, 或者查看器响应是在CloudFront将响应转发回查看器之前｡

这是CloudFront的一个原生特性,

整个代码直接从CloudFront内部进行管理｡

请记住, CloudFront函数的高性能､

高规模仅针对查看器请求和响应｡

现在, Lambda@Edge的数量增加了一些,

因此您可以修改所有这些参数｡

这些是在NodeJS或Python中返回的函数,

您可以扩展到每秒1000个请求, 它用于更改CloudFront请求和响应,

多个请求, 实际上是所有请求, 查看器请求和源请求, 这是在CloudFront将请求转发到源之前｡

还有源响应（在CloudFront从源接收到响应之后）和查看器响应（在CloudFront将响应转发回查看器之前）｡

您在一个区域（us-east-1）中编写函数,

该区域与您管理CloudFront分发的区域相同, 然后CloudFront会将此函数复制到其所有位置｡

这里我们有一个表来区分CloudFront函数和Lambda@Edge｡

因此, 一个显著的区别是运行时支持, 当然JavaScript仅适用于CloudFront函数,

NodeJS和Python则适用于Lambda@Edge｡

CloudFront功能的规模非常非常大,

我们讨论的是每秒数百万个请求,

而Lambda@Edge的请求数为数千个｡

现在, 触发器发生在哪里是一个很大的区别｡ 

因此, Lambda@Edge对查看器请求和源都有影响,

而CloudFront函数仅对查看器有影响｡

非常重要的是, CloudFront函数的最大执行时间不到一毫秒,

因此它们是非常､ 非常快速和简单的函数｡

而对于Lambda@Edge,

您可以获得最多5到10秒的时间,

因此您可以在这些函数中执行大量逻辑｡

剩下的, 你可以看看, 好吗？

现在, 就用例而言, CloudFront函数将用于缓存键规范化,

例如, 转换请求属性以创建最佳缓存键｡

标头操作, 用于在请求或响应中插入､

修改或删除HTTP标头, 或者执行URL重写或重定向,

或者请求授权以创建和验证JWT标记,

从而允许或拒绝请求｡

因此, 所有这些操作都可以在不到1毫秒的时间内执行,

而Lambda@Edge的执行时间更长,

例如, 可能长达10秒｡

您拥有可调节的CPU和内存,

因此您可以加载大量库,

因此您的代码可以依赖于第三方库,

例如SDK（如果您希望访问其他AWS服务）｡

您还可以通过网络访问用于处理数据的外部服务,

因此您可以真正执行一些大型集成｡

Lambd@Edge允许您访问文件系统,

或者访问HTTP请求的主体本身, 因此您可以进行更多的定制｡

希望这对你有帮助｡ 

我希望你们喜欢这节课,

下节课再见｡

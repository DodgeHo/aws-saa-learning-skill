---
source: 20 - Serverless Solution Architecture Discussions\002 Serverless Website MyBlog.com_zh.srt
---

教师：好的, 让我们来谈谈一个无服务器托管的网站,

也许叫做MyBlog｡

com公司｡ 

所以我们的网站应该在全球范围内扩展,

我们很少写博客, 我们经常阅读博客｡

所以我们的博客被成千上万的人在网上看到,

我们真的增加博客, 也许一天一个,

一周一个｡

但是, 大多数时候, 这些博客正在阅读｡ 

因此, 我的大多数网站都将是纯静态文件,

也许我的网站中有一小部分将是动态REST

API｡

我想在可能的情况下实现缓存, 以真正节省成本和延迟,

并获得出色的用户体验｡

任何订阅我的网站和博客的新用户, 我都希望他们能收到一封热情的欢迎邮件｡

这应该是无服务器的｡ 

任何上传到博客的照片, 我也想有一个缩略图正在生成,

也是无服务器的, 因为我真的很喜欢无服务器｡

那么, 我们如何实现所有这些要求呢？

第一, 我们想要提供内容, 它是静态的,

是全球性的｡

如果您还记得, 我们有客户端,

静态内容可能存储在Amazon S3中｡

那我们怎么暴露那个桶

请记住, Amazon S3存储桶位于特定区域｡ 

我们如何在全球范围内揭露这一点？

我们可以使用Amazon CloudFront｡ 

Amazon CloudFront是一个全球分发CDN,

因此基本上我们的客户端将与Amazon

CloudFront的边缘位置进行交互,

并将缓存直接来自Amazon S3的数据｡

好的｡  超级简单｡ 

我们已经看到CloudFront,

我们已经看到S3是一个经典的架构｡

现在我们如何安全地做到这一点？

这也是一个很常见的问题｡ 

所以我们有客户, 它与CloudFront交互,

它仍然是一个全球分布｡

但现在我们将添加一个Origin访问控制,

这将确保我们的Amazon S3存储桶只能由CloudFront访问｡

为此, 我们将添加一个存储桶策略,

以仅授权CloudFront分发｡

因此, 尝试直接访问我们的Amazon

S3存储桶的用户将不会获得授权, 并且我们已经保护了我们的Amazon

S3存储桶｡

好了, 现在我们有了这个, 这个真的很好｡ 

如何添加公共无服务器REST API？

好吧, 为此, 我们将有一个REST HTTPS,

与Amazon API网关对话,

调用Lambda函数, 可能从DynamoDB查询和读取｡

因为我们有这么多的读取, 也许DAX是一个很好的缓存层,

我们可以使用｡

好吗？ 到目前为止很容易｡ 

如果我们要走向全球,

也许我们可以利用DynamoDB全局数据库来减少世界部分地区的延迟｡

这也可能是一个很好的方式,

也许加快我们的基础设施和我们的架构｡

好吧, 这没什么｡ 

我们有我们需要的一切｡ 

现在让我们来谈谈用户欢迎电子邮件流｡ 

这里, 当用户订阅时, 我希望他们收到一封电子邮件,

说, 你好, 你好吗？

因此, 在DynamoDB中,

我们希望启用更改流｡

我们将创建一个DynamoDB流, 这个DynamoDB流将调用一个Lambda函数｡

这个Lambda函数非常特别｡ 

它将有一个IAM角色,

允许我们使用Amazon SES｡

我们还没有看到Amazon SES是什么,

但它真的很简单｡

Amazon Simple Email服务

SES基本上允许我们发送电子邮件｡ 

因此, 我们的Amazon Lambda函数可以使用AWS SDK从Amazon

SES发送电子邮件｡

开始了

我们有一个基本上无服务器的用户欢迎电子邮件流,

非常简单, 没有基础设施来管理, 它只是工作和扩展真的,

真的很好｡

好的, 现在我们说,

好的, 如果用户上传图像,

我们希望创建缩略图｡

因此, 我们的客户端可能会直接上传到我们的S3存储桶,

或者我们可能会再次使用OAC和CloudFront分发,

在这种情况下, 我们的客户端将上传照片到CloudFront,

CloudFront将转发到Amazon S3存储桶｡

这被称为S3传输加速｡ 

因此, 要么直接到S3, 要么使用传输加速｡ 

然后我们要做的是,

每当一个文件被添加到S3时, 它都会触发一个Lambda函数,

所以Lambda可以由S3触发, Lambda将创建一个缩略图, 并将该缩略图放入S3桶中, 例如, 可以是一个不同的桶｡

为了向您展示这是可能的, Amazon

S3还可以触发SQS和SNS｡

现在这是可选的, 从SQS SNS你可以做任何你想做的事情,

但它只是向你展示, 你可以非常自由地进入你想要的东西如何工作｡

因此, Amazon S3可以调用Lambda､ SQS或SNS,

您可以自由地考虑您的解决方案架构, 以及如何在您的终端上实现无服务器和轻松｡

这是我们刚刚完成的一个相当完整的架构,

但它都是无服务器的, 都是全球性的, 我认为这是最重要的｡

因此, 我们已经看到使用CloudFront和S3分发静态内容｡

我们已经看到了无服务器的其余API｡ 

这次我们不需要Cognito,

因为它是一个公共REST API｡

我们利用全局DynamoDB表, 在全球范围内提供数据｡

我们也可以使用Aurora全球数据库,

但在这种情况下, 他不会是无服务器的, 它会被提供给Aurora｡

或者我们也可以启用DynamoDB流｡ 

基本上, 这些流将告诉我们用户表的更改,

然后触发Lambda函数｡

Lambda函数有一个IAM角色,

因此它可以使用SES或简单电子邮件服务｡

这只是以无服务器的方式发送电子邮件｡ 

而S3, 我们已经看到它可以触发SQS, SNS, Lambda来通知事件｡

所以学到了很多东西｡ 

所有这些我们都知道,

但现在我认为, 很高兴看到所有这些东西一起工作, 以及我们如何使用我们所知道的所有概念创建非常酷的应用程序｡

希望你们喜欢,

我们下节课再见｡

---
source: 08 - High Availability and Scalability ELB & ASG\018 Auto Scaling Groups - Scaling Policies Hands On_zh.srt
---

教师：好的, 现在我们来看看ASG的自动缩放｡

如您所见, 我们有三个类别：动态扩展策略､

预测性扩展策略和计划操作｡

所以让我们从最简单的开始｡ 

计划操作是指您希望在将来计划扩展操作的时间,

您可以创建一个扩展操作, 然后指定所需的容量､ 最小值或最大值, 然后是每周一次还是每小时一次,

是否基于特定的计划等？

然后是开始时间和结束时间,

如果你想完成的话｡

所以这很酷, 它允许你根据你可以预测的事件来安排时间,

你可以提前知道｡

因为你知道, 比如说,

你下周六要进行一个大的促销活动｡

接下来, 预测性扩展策略将由机器学习驱动｡

因此, 您需要根据预测进行扩展｡ 

因此, 您需要查看实际策略和基于过去的实际扩展,

然后再查看要查看的指标｡

例如, CPU利用率或网络输入､ 网络输出､

应用程序负载平衡器请求计数或所需的自定义指标｡

例如, 您希望将CPU利用率设为50%,

然后您可以设置一些其他设置, 但在此基础上, 例如, 根据上周的实际计划利用率, 将创建一个预测, 然后您的ASG将根据该预测进行扩展｡

我无法向您演示, 因为我需要在一周内很长一段时间内启用此功能,

然后确保在我的应用程序中使用此功能｡

但至少您可以看到, 预测性扩展策略的设置非常简单,

您只需指定所需的指标和目标利用率, 然后将应用一些机器学习来实现扩展｡

因此, 我可以向您演示的一个策略是动态扩展策略｡

现在, 我们来创建一个动态扩展策略｡ 

所以这里我们有三个选择｡ 

我们有目标跟踪､ 步进缩放和简单缩放｡ 

我们先来看看简单的扩展｡ 

因此, 这里我们必须指定一个名称, 而不是CloudWatch警报,

该警报可以在触发时扩展容量｡

因此, 我们需要事先创建一个警报, 稍后我们将看到这一点｡

因此, 如果触发警报并发生什么情况,

您可能希望添加两个容量单位, 或者您可能希望添加10%的组｡

然后以至少两个容量单位的增量添加容量单位｡

这是一个简单的扩展策略｡ 

因此, 我们可以有一个扩展策略,

在这里通过添加实例来退出,

或者通过删除实例来进入｡

或者你也可以有一套地动作｡ 

接下来是步进缩放｡ 

因此, 这允许您设置多个警报, 并根据警报值采取不同的步骤,

例如, 如果警报值非常高,

则添加10个容量单位｡

但如果它很高, 但不是太高, 加一个｡ 

这是逐步扩展背后的想法,

但我们将设置一个目标跟踪扩展策略, 因为这将为我们创建一个CloudWatch警报｡

这是目标跟踪策略名称,

它将跟踪目标值为40的平均CPU利用率, 然后我将继续创建策略｡

现在我们要说的是,

这个ASG的目标是将CPU利用率保持在40｡

还有以防万一, 然后你走过去,

然后请添加容量单位｡

因此, 要看到它的实际效果, 我们需要更改一些内容｡ 

因此, 现在所需的主端是一个好端,

但我们将最大容量设置为3或2, 无论发生什么情况｡

我们的想法是, 您要给它一个大于最小值的最大值,

以便容量可以从1增加到2, 然后再增加到3｡

因此, 现在的想法是, 我们希望自动扩展组的CPU利用率达到目标值40｡

如果您现在看到CPU利用率将为零,

这是显而易见的｡

让我们看一下EC2是否接近于零,

因为EC2实例没有执行任何操作｡

我想做的是转到我的EC2实例,

我将强调它, 使CPU利用率飙升到100%｡

我将使用EC2实例连接来连接到EC2实例,

然后连接到它, 然后我将在Google上安装Amazon

Linux 2｡

因为有几个命令, 这里是命令,

所以我将在这里复制第一个命令,

然后复制第二个命令来安装压力｡

我们走吧｡ 

所以压力是装出来的｡ 

然后, 我只需运行命令stress -C 4, 通过同时使用四个VCPU来利用四个CPU单元,

从而使CPU达到100%｡

这应该会使我的CPU达到100%,

因此, 在我对ASG的监视中,

我希望看到CPU传统达到非常､ 非常､ 非常高的水平｡

然后在活动中, 我想看到一个缩放动作｡ 

这就意味着我将从一个实例变成两个实例｡

我将暂停视频, 直到捕获到足够多的指标,

并且CPU利用率达到非常高的值, 然后我们将看到目标跟踪策略的工作原理｡

现在, 我进入“Activity”（活动）, 在“Activity

history”（活动历史记录）下, 显示已触发警报, 由于目标驱动策略,

容量从一个实例变为两个实例｡

因此, 如果我进入实例管理,

您可以看到, 由于扩展, 现在我有两个EC2实例｡

如果我进入监控, 查看EC2级别的监控,

我们可以看到CPU利用率达到了非常高的值,

然后发生了四次扩展｡

那么, 我们如何知道缩放发生了呢？

因此, 如果您选择“自动扩展”,

如您所见, 这里有一个目标跟踪策略｡

我想给你们看的是后端｡ 

因此, 如果我们在这里进入CloudWatch服务, 然后进入CloudWatch,

在左手边, 我想进入Alarms｡

所以我们需要启动警报｡ 

如您所见, 目标跟踪策略直接创建了两个警报｡

其中一个称为AlarmHigh, 用于横向扩展,

因此需要添加实例｡

其中一个称为AlarmLow,

它可以在更少的实例中扩展｡

因此, 这是一个检查, 如果CPU利用率在三分钟内超过40%,

则进入警报状态｡

这一步是查看15个数据点的CPU利用率是否低于20个8,

然后进行扩展｡

这就是我的想法｡ 

这个实例处于警报状态,

由于指标本身进入警报状态, CPU利用率超过了此处的限制, 它被触发了, 这使我的自动扩展组发生了扩展活动,

进而使一个新实例投入使用｡

现在, 如果我转到这里并停止此命令, 我甚至不确定是否可以停止它,

但如果我停止此命令或让我完成它并停止此命令,

我可能可以转到我的EC2实例并重新启动它｡

所以我会看一下这个, 我相信, 我会重新启动它｡

因此, 重新启动这个实例,

我也将重新启动那个实例, 以防万一｡

这应该会使CPU利用率回到零,

并在15分钟内触发一个秤｡

我将再次暂停ASG中的视频, 看看是否有机会在活动中看到正在进行的规模｡

我现在暂停一下, 实际上只是因为我的速度不够快,

因为CPU仍然很高, 所以所需的容量从两个变成了三个｡

因此, 我们可以看到又添加了一个实例｡ 

这确实显示了自动扩展组的强大功能｡

现在, 如果我进入实例管理,

我们将有三个EC2实例, 我将不得不等待一段时间, 直到它们被终止｡

现在让我们回到活动中来, 正如您所看到的,

更多的活动正在进行｡

因此, 某些实例已终止｡ 

因为警报来自较低的CPU, 然后容量从3设置为2,

然后再一次从2设置为1｡

如果进入实例管理,

您会看到, 一个实例已终止,

另一个实例处于终止阶段, 因为这意味着您的目标跟踪策略正在工作｡

你可以通过这里的警报器看到｡ 

正如您所看到的, CPU利用率先是上升,

然后下降, 一旦超过28%的阈值, 就会进入警报状态, 这意味着您的ASG将开始删除实例｡

这就显示了目标跟踪策略的威力｡ 

完成后, 请确保删除此策略, 这样您就可以进行清理了｡

就这样, 我们下节课再见｡

---
source: 08 - High Availability and Scalability ELB & ASG\008 Network Load Balancer (NLB) - Hands On_zh.srt
---

教师：好的, 让我们继续练习创建网络负载平衡器｡

因此, 让我们在这里创建一个网络负载均衡器,

我们将其称为DemoNLB｡

因此, 我们将选择一个面向互联网的IPv4负载均衡器｡

在网络映射方面, 我将使用我拥有的VPC,

并且我将使用每个可用区, 因此我有三个可用区｡

如您所见, 每个AZ都有一个子网｡ 

然后是AWS分配的IPv4地址｡ 

因此, 这意味着对于您为网络负载均衡器启用的每个AZ,

您将获得一个固定的IPv4地址｡

在这种情况下, 这将由AWS分配,

但如果您有弹性IP,

则可以为每个特定的可用性区域使用弹性IP地址｡

好的, 接下来我们可以将安全组附加到我们的网络负载均衡器,

这是推荐的｡

所以这是新的｡ 

我们可以创建一个安全组｡

我称之为demo-sg-nlb｡ 

对于入站规则,

我们将允许端口80上的任何人｡

所以我们可以从任何地方使用HTTP,

出站规则也很好｡

因此, 让我们创建安全组,

并为NLB演示SG, 我们有描述｡

所以我们没事了

我们现在要使用这个演示安全组｡ 

所以我将刷新它, 选择我的demo-sg-nlb, 并删除默认值,

好吗？

因此, 与应用程序负载均衡器类似, 对于网络负载均衡器,

您也可以附加一个安全组, 然后控制网络负载均衡器的流量｡

在监听器和路由方面, 我们将有一个协议｡

因此, 您可以使用TCP､ TCP_UDP､ TLS或UDP｡ 

我们将通过端口80使用TCP｡ 

然后我们有一个目标群体, 我们应该发送它｡ 

让我们创建一个目标群体｡ 

而这一个将是专门为网络负载平衡器｡

因此, 我将在这里选择实例, 目标名称将被称为demo-tg-nlb｡

在端口80上的协议将是TCP, 因为我们正在使用网络负载平衡器｡

我们将像以前一样使用VPC｡ 

对于健康检查, 我们有不同的选择｡ 

TCP､ HTTP或HTTPS｡ 

但是因为我们在EC2实例上运行了一个HTTP应用程序,

所以我们将使用HTTP｡

对于高级健康检查设置,

我们将健康阈值定义为2,

超时为2秒, 间隔为5秒｡

因此, 让我们单击Next,

然后我们将注册目标｡

因此, 我的两个可用实例,

我将单击此处将其包含为下面的待定实例,

并创建目标组｡

现在我们已经创建了demo-tg-nlb, 我们可以继续,

单击它, 将其放在不同的页面中｡

我将进入我的网络平衡器,

刷新它, 然后选择我的demo-tg-nlb｡

完美了

现在让我们向下滚动,

我们已经完成了网络负载均衡器的配置｡

因此, 让我们创建这个网络负载平衡器并立即切换到它的页面｡

现在让我们等待它被配置,

我们就可以开始了｡

好了, 我的网络负载平衡器现在是活动的｡ 

所以如果我在我的网页浏览器中输入URL, 正如我们现在所看到的,

它似乎不起作用｡

因此, 让我们观察一下负载均衡器可能会遇到的问题｡

因此, 如果您现在查看目标组,

并刷新此页面, 看起来我的实例仍处于检查的初始阶段｡

所以让我回来看看他们是健康的还是不健康的｡ 

所以他们是不健康的,

因为他们的检查失败了｡

因此, 我们的想法是, 如果我们查看这些实例, 并查看这些实例的安全组,

我们将转到Security, 然后是Security

groups｡

所以让我们点击它,

并打开安全组｡

我们可以从入站规则中看到, 我们允许来自任何地方的SSH,

并且我们允许来自此安全组的HTTP,

如果您还记得的话, 这是我们的应用程序负载均衡器的安全组｡

但我们实际上还需要允许来自网络负载平衡器的HTTP流量｡

所以我们需要点击demo-sg-nlb｡ 

所以允许来自NLB的流量｡ 

这是来自ALB的允许流量｡ 

因此, 我们的想法是, 现在有了这个安全组规则,

我们允许NLB与我们目标组中的EC2实例通信, 因此, 它们应该有助于通过健康检查｡

现在让我们在这里稍等一下, 看看这是否能解决我们的问题｡

是的, 正如你所看到的, 现在我的实例是健康的｡ 

这意味着如果我现在进入我的网络负载均衡器,

它已经自动解析, 我们刷新, 我们得到一个事实, 我们从一个特定的IP, 这是我们的实例, 得到一个Hello World｡

因此, 经过一段时间的刷新, IP发生了变化,

这证明我们正在对两个实例进行负载平衡｡

就是这样

我们已经看到了网络负载均衡器的安全组｡

它的工作原理与应用程序负载均衡器类似,

以及如何更改EC2安全组, 以确保我们还允许来自NLB的流量,

而不仅仅是ALB, 这就在这里｡

好了, 这就是这次实践的内容｡ 

现在, 您可以做的就是删除负载平衡器,

即DemoNLB, 如果您愿意,

您可以选择删除演示目标组,

就在这里, 为NLB｡

如果您愿意,

还可以删除NLB的安全组｡

但我不认为这是必要的,

但它是很好的做法, 如果你想尝试一下｡

好了, 这节课就到这里了｡ 

我希望你们喜欢,

我们下次课再见｡

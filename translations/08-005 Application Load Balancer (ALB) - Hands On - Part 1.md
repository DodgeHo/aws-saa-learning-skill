---
source: 08 - High Availability and Scalability ELB & ASG\005 Application Load Balancer (ALB) - Hands On - Part 1_zh.srt
---

讲师：我们将练习启动负载均衡器,

但首先, 我们需要将流量发送到某个对象｡

首先, 我们要启动EC2｡ 

我将进入启动实例, 我将启动两个实例｡

所以在右边我可以说两个实例, 名字是我的第一个实例｡

到时候我们会重新命名第二个｡ 

我们将在此架构上使用Amazon Linux 2｡ 

我们将使用T2｡  micro, 然后我们将在没有密钥对的情况下继续,

因为我们不需要SSH功能｡

如果需要, 我们可以使用EC2实例连接｡ 

然后, 对于网络设置,

我们可以选择一个现有的安全组, 我们将使用启动向导1安全组, 它允许我们将HTTP流量和SSH流量发送到我们的EC2实例｡

所以这是完美的｡ 

我们将使用基本存储,

对于高级细节, 我将向下滚动并添加一些EC2用户数据,

为此, 我将复制这里的内容并将其粘贴在这里｡

因此, 这将启动EC2实例, 与我们在使用此EC2用户数据脚本之前启动它们的方式相同｡

现在, 让我们启动两个实例,

然后查看所有实例｡

所以我要把第二个重命名为我的第二个实例并保存｡

所以让我们等待这些实例准备好｡ 

所以我的EC2实例现在已经准备好了｡ 

我将复制第一个IPv4地址并粘贴它, 然后我将访问该URL,

正如您所看到的, 我从我的实例中获得了一个hello

world, 所以这很棒｡

然后我就在这里进行第二次庭审

我将再次复制IPv4, 然后粘贴它, 按回车键, 我再次得到一个Hello

World｡

正如你所看到的, 两个实例给了我们两个hello worlds,

最后一部分是变化的｡

所以我们想要做的是只有一个URL来访问这两个EC2实例并平衡它们之间的负载｡

因此, 当然, 我们将使用负载均衡器｡ 

让我们向下滚动, 看看负载均衡器｡ 

在这里, 您可以创建一个负载均衡器｡ 

因此, 我们有不同的负载均衡器类型,

在此演示中, 我们将只关注应用均衡器,

但您需要了解ALB､ 网络负载均衡器和网关负载均衡器之间的区别｡

因此, 对于平衡器的应用程序,

您可以在这里看到它用于HTTP和HTTPS类型的流量｡

对于网络负载均衡器, 它将基于TCP和UDP协议或TCP上的TLS｡

当你需要超高性能时,

你会用到它｡

这意味着每秒数百万个请求, 同时保持超低延迟｡

这是一个非常高性能的负载均衡器｡ 

最后是这里的网关负载均衡器,

如您所见, 它用于安全性､ 入侵检测､

防火墙等｡

所以是分析网络流量｡ 

当它转到经典负载均衡器时,

当您观看此视频时, 它可能已经消失,

因为经典负载均衡器正在消失, 因此我不打算讨论它并触摸它｡

好了, 现在让我们集中精力创建应用程序负载平衡器｡

所以我把它叫做DemoALB｡ 

如果你想了解负载平衡是如何工作的, 你可以在这里阅读,

但希望前面的讲座对你来说已经足够了｡

因此, 该方案是面向互联网的,

地址类型为IPv4｡

对于网络映射, 我们需要决定在哪里部署负载均衡器以及有多少个可用区｡

所以让我们把它部署到所有的地方｡ 

很好, 然后我们需要为负载均衡器分配一个安全组｡

因此, 事实证明, 我要为它创建一个新的安全组,

我们需要只允许HTTP流量｡

所以我称之为demo-sg-load-balancer｡ 

允许HTTP进入负载均衡器, 进入ALB,

入站规则将允许来自任何地方的所有HTTP｡

好吧, 出境规则也没问题｡ 

让我们创建这个安全组｡ 

所以现在它已经创建好了,

我可以回到这里, 刷新这个页面, 选择我的demo-sg-load-balancer并删除默认的安全组,

这样我就只剩下一个安全组了｡

我们往下看｡ 

我们在监听器和路由下｡ 

因此, 我们需要将流量从端口80上的SHTTP路由到目标组｡

目标组只不过是创建的一组EC2实例｡

因此, 我们需要创建一个目标群体｡ 

所以让我们点击这里创建一个｡ 

基本配置告诉我们, 我们希望将实例分组在一起,

但您可以看到您有其他选项｡

所以我们想把实例分组在一起,

我把它叫做demo-tg-alb｡

协议是HTTP端口80｡ 

您有不同的选项, 但根据您选择的选项,

它将成为不同类型的负载均衡器的目标组｡

因此, 我们将在端口80上将其保持为HTTP, HTTP的版本为1,

因此我们将其保持为1｡

健康检查很好｡ 

然后让我们点击下一步｡ 

然后我们需要登记目标

因此, 我们将在端口80上注册两个EC2实例,

并将它们包含在下面的支出中｡

现在我的实例已经注册,

让我们创建这个目标组｡

它已经创建好了, 现在我需要刷新我的页面, 实际上我之前已经创建了一个,

所以我想用的是demo-tg-alb｡

这样就创建了这个目标组, 并将其链接到我的负载均衡器上端口80上的侦听器｡

所以现在我可以开始了,

我可以继续创建我的负载均衡器了｡

所以我要点击查看负载均衡器,

我回到这个页面, 我可以看看我的负载均衡器｡

现在它在配置空间中,

所以我们需要等待它被配置｡

所以我的ALB现在是活跃的, 它准备好了｡ 

正如你所看到的, 这里有一个DNS名称｡ 

所以我将复制它, 将其粘贴到一个新的选项卡中,

通过应用程序负载均衡器, 我可以得到一个hello

world｡

但最酷的是,

如果我刷新这个页面,

并继续刷新它, 那么你可以看到目标正在改变｡

这是因为我的应用程序负载均衡器实际上在两个EC2实例之间重定向,

这非常酷｡

这证明了负载平衡确实在发生｡

我们怎么知道？

好吧, 如果我们去我们的目标群体,

这一个, 我们看看我的目标群体的目标, 你可以看到他们都是健康的｡

这意味着应用程序负载均衡器将通过目标组向它们发送流量,

一个接一个｡

目标群体非常聪明, 因为如果我以我的第一个实例为例,

我停止了它, 通过这个, 我们正在做的是, 我们停止了我们的两个实例, 因此它将是不健康的, 因为它不能再响应进来的流量｡

所以如果我进入我的目标群体,

也许我太快了, 让我们看看,

刷新, 所以我会等大约30秒｡

现在可以看到, 第一个实例未使用,

因为它处于停止状态｡

因此, 如果我返回到应用程序平衡器并刷新,

我得到的这个实例的唯一响应是一个仍在运行的实例｡

这就是使用负载均衡器的强大之处,

因为它们知道目标何时健康或不健康｡

所以这个实例被停止了,

但是当然, 如果我恢复它, 如果我再次启动它, 它就会启动,

并在后台创建服务｡

所以让我们等待实例启动, 希望我们能再次看到它在我们的目标组中是健康的｡

实例现在已经启动,

我们处于初始健康状态, 如您所见, 现在我们处于健康状态｡

所以这个实例被认为是健康的,

所以如果我回到我的应用程序平衡器并刷新,

正如你现在所看到的, hello world来自两个实例｡

就这样, 我们已经练习了负载均衡器,

我们在目标组中创建了一个和两个目标｡

希望你们喜欢, 下次课再见｡
